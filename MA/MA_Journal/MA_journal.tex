\documentclass[11pt,letterpaper]{article}

\usepackage[utf8]{inputenc} % für Umlaute etc
\usepackage[ngerman]{babel} % nur damit funktionieren "` Anführungszeichen "'
\usepackage{hyperref} % für Links
\usepackage{enumitem} %for customising itemize, enumerate etc.
\usepackage{tikz} % for the date lines
\usetikzlibrary{calc} % for coordinate calculations of date lines

\usepackage[textsize=footnotesize]{todonotes} % selbsterklärend

\setlength{\marginparwidth}{3.5cm} % größerer Seitenrand für Todo-Notes


\newcommand{\heute}[3][April]{\textbf{#2 -- #3. #1}}

\newcommand{\DayInApril}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\heute{#2}{#3}};
}


\newcommand{\DayInMay}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Mai}};
}

\newcommand{\DayInJune}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Juni}};
}

\newcommand{\DayInJuly}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Juli}};
}

\newcommand{\DayInAug}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. August}};
}

\newcommand{\DayInSep}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. September}};
}


%opening
\title{Master Journal}
\date{}
 
\begin{document}

\maketitle



\DayInApril{Di}{2}


Nur rumgebastelt:
\begin{itemize}
	\item Versehentlich Swics-Ordner gelöscht, wiederhergestellt.
	\item SVN durchsucht nach fehlendem libacepy.ancil:\\ \textit{svn+ssh://asterix/data/subversion/etph/swics/trunk/ionpositions/libacepy}\\
	Softlink gesetzt in Hauptverzeichnis: \textit{ln -s [path]}
	\item Numpy und Scipy aktualisiert: \textit{sudo pip install numpy upgrade}\\$\rightarrow$ Fehlermeldungen endlich weg
	\item Journal 'Osmo' runtergeladen, wieder verworfen, LibreOffice ausprobiert, verworfen, für Latex entschieden: An \href{https://www.overleaf.com/project/5ca382231c72a24e9afbfe17}{Diary-Template} orientiert
	\item Dazu: in \textit{newcommand} eingelesen, versucht aktuelles Datum ohne Update einzubauen, guten \href{https://tex.stackexchange.com/questions/156237/print-current-date-without-updating}{Beitrag} mit \href{https://cremeronline.com/LaTeX/minimaltikz.pdf}{tikz}-Package gefunden, 
\end{itemize}



\DayInApril{Mi}{03}
\begin{itemize}
	\item Versucht, \textit{itemize}-Listen anzupassen mit \href{ftp://ftp.fu-berlin.de/tex/CTAN/macros/latex/contrib/enumitem/enumitem.pdf}{\textit{enumitem}}-Package $\rightarrow$ zu zeitaufwändig, mach ich später. TODO
	\item außerdem TODO: Todo-command von Stefan/Finn raussuchen
	\item Jetzt weiß ich, warum ich Dist3D nicht weiter gecheckt habe: Funktioniert nicht ohne AspectAngle-Phi und -Theta und ohne Testen versteh ich nicht, was passiert. Ich muss also erstmal die Winkel einpflegen.
	\item TODO: Git aufsetzen (!!) und nochmal PyCharm checken
	\item Programmstruktur auf Papier gefunden. Yay, sehr hilfreich! \textit{ulysses\_traj.py} angefangen anzupassen an zusammengefasste Trajektoriendatei (traj\_data\_pool.dat).
	\item NEXT: Methode sync\_traj() in uswipha.py anpassen, am besten alte M. einfach umbenennen (als Backup) und eine neue schreiben.
\end{itemize}


\DayInApril{Do}{04}
\begin{itemize}
	\item Wollte schnell AA-Phi und AA-Theta einpflegen, da fällt mir auf: Die müssen ja noch brechnet werden aus den HG-Koordinaten. Die Funktion dafür gibts schon: \verb|calc_asp_angles()| aus \verb|ul_calc_traj.py|. Die braucht aber Erd-Koordinaten in HG-Koordinaten und die gibts noch nicht. Ich könnte die von der NASA-Seite holen, würde die aber lieber rechnerisch rausbekommen. Altes Problem rekapituliert: Erd-K. bekannt in HC: LAT immer Null, LONG unbekannt. In HG: LAT unbekannt, LONG berechenbar aus Ulysses-Datenprodukt.
	Ich brauche eine der unbekannten Größen! (Über Drehmatrix rückwärts rausrechnen: Geht nicht, weil ich keine kartesischen Koordinaten habe(?))
	Nächster Versuch: Über SPE, SEP, ESP. $\rightarrow$ Hilft nicht.
	Jetzt pflege ich Erddaten von der \href{https://omniweb.gsfc.nasa.gov/coho/helios/planet.html}{NASA} halt in \textit{ulysses\_traj} ein. Mal gucken, ob ichs rückwärts berechnen und damit verifizieren kann...
\end{itemize}

\DayInApril{Sa}{06}
\begin{itemize}
	\item Begonnen, die NASA-Daten einzuladen und die Winkel in RTN auszurechnen. Mit Testfunktion kommt leider nicht das Richtige raus. Fehlersuche.
	\item Fehlersuche ergab: Ich hatte den Long-Shift übermutig aus der Koord.-Trafo für die Erde rausgenommen. Muss aber natürlich drin bleiben, weil 
	ja auf RTN-Koord. des SC (dessen Daten mit dem Shift belastet sind) transformiert wird.
\end{itemize}

\DayInApril{So}{07}
\begin{itemize}
	\item Was für Daten sollen jetzt eigentlich synchronisiert werden mit sync\_traj()? RTN-Koordinates fürs SC sind ja nicht besonders aussagekräftig (weil Null in T und N). Ich nehme wahrscheinlich die verschiedenen AA's und HG-Koordinaten. Kann man ja schnell anpassen.
	\item Next: Das machen (Anpassung in \textit{ulysses\_traj}), dann \textit{Dist3D} damit aufrufen und gucken, was als nächstes fehlt.
\end{itemize}

\DayInApril{Di}{09}
\begin{itemize}
	\item AspectAngles werden geschluckt von \textit{Dist3D}. Nächstes Problem: Detektor-ID! $\rightarrow$ Achja. Ist ja schon drin in den Datenprodukten, als \textit{det}.
	Ich setze jetzt neues Dist3D speziell für Ulysses SWICS auf (Skript aus \textit{SWICS/trunk/ace\_dbd/} nach \textit{Ulysses/swics/software} kopieren).
	\item Next: Brauche passende getvelovity-Methode, dafür muss ich rausfinden, ob Ulysses/SWICS dieselben EpQ-Spannungssteps hat wie ACE/SWICS
\end{itemize}	

\DayInApril{Mi}{10}
\begin{itemize}
	\item Rausgefunden, in welcher Einheit Werte in \textit{getvelocity} sind: $\frac{keV}{e} = kV$!
	\item Entsprechendes Werteintervall nicht im SWICS-Paper gefunden. Im ACE-SWICS-Paper geguckt: Da steht zumindest der obere Wert von $100\,\mathrm{\frac{keV}{e}}$ (Main Channel). Die untere Grenze ist allerdings $0.49$ anstatt $0.61$ (in \textit{ancil.py}). Habe die Werte mal geplottet und in der logarithmierten Darstellung ist ein deutlicher Knick in der Geraden! Interessanterweise sind in dem Paper (TABLE1) auch zwei Werte für Step Size angegeben. Erstens macht eine Step Size ja nicht so viel Sinn, wenn die Steps logarithmisch verteilt sind. Also habe ich mir \textit{exp()} von den Differenzen angeguckt: Tatsächlich zwei konstante Werte! Aber statt $1.0744/1.0365$ bekomme ich $0.071$ und $0.144$. Hm...
\end{itemize}


\DayInApril{Mo}{15}
\begin{itemize}
	\item Mit Lars gesprochen. Die EpQ-Steps wurden aus den Housekeepingdaten von ACE ausgelesen. Und bei Ace sind sie in der Tat auf zwei verschiedenen Steigungen. Das ist bei Ulysses wahrscheinlich nicht so. Für U. (64 statt 60, aber kleinere Range) hat Thies schon damit gearbeitet, die muss es also irgendwo geben, Lars schaut mal nach. In den Raw- oder PHA-Daten haben wir sie nicht gefunden. Bis dahin nehme ich die Funktion von ACE als Dummywerte.
\end{itemize}

\DayInApril{Mi}{17}
\begin{itemize}
	\item Neuen Softlink (libacepy) gesetzt für Dist3D. Jetzt muss ich mit Dummy-GetVelocity() das Skript verstehen.
	\item D.vspace gibt an: \textit{welche Geschwindigkeitseigenschaften(Richtung, Betrag) muss ein Teilchen gehabt haben, damit es hier gemessen wurde?}
	\item Ich mauschel mich da durch, passe alles entsprechend an. Problem: Es gibt in \textit{d}s Datenprodukten (uswipha-Instanz) vier(!) Detektor-ID-Werte: 0,1,2,3. Ich erinnere mich vage, dass ich früher mal wusste, was das war. Muss ich rausfinden und abfangen, weil dist3D natürlich nur was mit drei Werten anfangen kann. \\
	Achso, abfangen klingt kompliziert: Einfach Maske setzen!
	\item Unterwegs (in der Kladde) gelvelocity()-Funktion für Ulysses gefunden! Yay! (\textit{/home/asterix/fischer/PUI/Ulysses/swics/software/libulpy/uswiuitils.py}) (Lars: Eigentlich noch ein Step mehr: 85 oder so. Aber der ist kaputt)
	\item Zum Detektor-ID-Problem habe ich nur was Knappes auf S.45/46 gefunden. Leider nicht das Endergebnis und Lars' Aussage zur damaligen Analyse. Ich suche jetzt das Skript, das die jeweiligen Plots erstellt, an denen wir damals was gesehen haben: 
	\item Angefangen, \textit{pui\_ulysses.py} durchzugehen. Polarplot() funktioniert nicht. Woher kommen die drei Masken? Muss ich nach Ostern weiter durchgucken...
\end{itemize}

\DayInApril{Mi}{24}
\begin{itemize}
	\item Aus Osterurlaub wieder da. Jetzt muss ich wirklich loslegen -- noch 3 Wochen bis zum Vortrag. 
	\item Einiges mal überflogen. Grobe Struktur: Alten Vortrag zusammenfassen: PUI $\rightarrow$ was erwarten wir für eine VDF? Echte VDF sieht aber anders aus. Erklärungen? Messfehler $\rightarrow$  Übergang SC-frame auf SW-frame bzw. (?) Übergang 1D auf 3D (diesen Zusammenhang muss ich mir klar machen!!). Dann fange ich an, Ulysses/SWICS zu erklären und was bisher mit der Trajektorie etc. gemacht wurde.
\end{itemize}

\DayInMay{Do}{02}
\begin{itemize}
	\item Rausgefunden, warum in polarplot() die Masken schon gesetzt waren: In diy$\rightarrow$ gibts das Skript load\_pui\_ulysses.py, das genau diese Masken setzt.
	\item Detektorproblem: Dort werden Detektoren 0,1,2 geladen, d.h. Nr. 3 ist evtl. der, der über ist?
	\item PATHPROB: Zum Ausführen von load\_pui\_ulysses.py muss ich uswipha.py laden, das füge ich dafür zum python-sys-Path hinzu. Dasselbe mit pui\_ulysses.py
	\item Habe jetzt endlich alle alten Sachen (AnimatePolarplot) zum Laufen bekommen. Evtl. könnte man die Animation auf Lars' Kollimator umbauen. Aber nur ganz evtl.
\end{itemize}

\DayInJune{Di}{04}
Dokument aufgesetzt, Bibdatei angelegt, Zusammenschrieb auch damit verbunden. Für Biblatex entschieden.
\begin{verbatim}
\usepackage[backend=biber,style=authoryear,maxbibnames=2,natbib=true]{biblatex}}
\end{verbatim} 
Dann mit citep (alles in Parenthesis) oder citet (im Fließtext) zitieren.\\ \\
Weiter: Infos von losen Zetteln in Zusammenschrieb schreiben.


\DayInJune{Mi}{12}
Python3 zusätzlich zu Python2 installiert (weil Max' Programm in Python3 geschrieben ist):
\begin{itemize}
	\item Python 2.7 und Python3 irgendwie vorhanden.
	\item \textit{sudo apt-get install python3-pip}
	\item Jetzt kann ich mit \textit{pip3} Python3 erreichen und mit \textit{pip2} Python2 (Nur \textit{pip} bezieht sich auch auf 3)
	\item Problem: \textit{ipython} öffnet immer ipython für Python2. \textit{pip3 install ipython
	} hat nicht geholfen.
	\item Sebastian hat geholfen: Ipython3 ganz normal installieren: \textit{sudo apt install ipython3
	}. Jetzt kann ich entweder \textit{ipython} oder \textit{ipython3} aufrufen! Jetzt noch alle Pakete mit \textit{pip3} installieren
\end{itemize}
Anderes:
\begin{itemize}
	\item pip immer nur lokal installieren, also ohne \textit{sudo}!
	\item TK: GUI-Programm in C++ geschrieben, für Python über Interface tkinter. Nicht über pip installierbar, denn pip soll nur pure Pyhton Pakete installieren. Also installieren mit \textit{sudo apt install python3-tk}
\end{itemize}


\DayInJuly{Fr}{12}
Bei Lars gemeldet. Er hat den Kollimator und Dist3D weiter eintwickelt.
\begin{itemize}
	\item Zeigt Ergebnisplot (das ist auch mein Ziel mit Ulysses), bei dem entlang der x-Richtung in die Verteilungskugel geguckt wird (schnittweise). Man erkennt innen was in der Mitte (Innere Quelle?) und außen die Schale!
	\item phasenraumgewichtet (wie oft habe ich überhaupt in eine Richtung geguckt, d.h., wie groß ist die Wahrscheinlichkeit, dass ich ein Teilchen hätte messen können?) und normiert (auf max)
	\item Das sind ACE-Daten, Langzeit, alle vsw. Ziel ist, wenn alles läuft, nach unterschiedlichen Magnetfeldkonfigurationen und vsw zu filtern und evtl. Unterschiede zu finden.
	\item Bsp: Bfeld einschränken auf theta: kP und phi: $-90\,^\circ$ bis $-70^\circ$ und $90\,^\circ$ bis $110^\circ$. Zeichnung s. Kladde S. 83. Erwartung wird irgendwie nicht richtig erfüllt. Filter auf kleine vsw: schon eher.
	\item Evtl. gibt es noch ein Problem mit dem Aspect Angle, denn die Population ist manchmal wohl auf der falschen Seite (nämlich links)
	\item das sind 12-min-Daten. Eigentlich müsste man Minutendaten nehmen, denn: Gyroperiode der Teilchen ist etwa eine Minute. Alle Änderungen des B-Feldes, die auf kürzeren Zeitskalen stattfinden: PA-Bestimmung nicht sinnvoll, weil keine volle Gyrobahn. Deutlich längere Zeitskalen: auch nicht sinnvoll, weil Verteilung mitdreht (?)
\end{itemize}
Zu den Daten:
\begin{itemize}
\item Etwas veränderte Ordnerstruktur. Ich muss neu auschecken: \\ \textit{svn+ssh://asterix/data/subversion/etph/ACE} (Instrumentelles, die Dist3D die hier liegt ist eine alte Version) bzw. \textit{.../etph/PUIs} (datenspezifisches, neuere Dist3D, die zu PUIs passt)
\item ACE-Datensatz zu Probieren auf \textit{data/etph/berger/mq...} \\ Dort liegen HE+-gefilterte Daten aus 12 Jahren. Ich muss zusätzlich wHE einschränken auf 0.9 bis 10 (das ist w ganz einfach in 1D, Lars hat auch gezeigt, wie das in 3D abgebildet wird, Todo: überlegen!) und eine Maske von Hand legen (s. Zeichnung Kladde S. 83)
\item Datensatz umfasst ca 800000 PHAs+. Nach Maskierung sollten etwa 400000 übrig bleiben.
\item Pi mal Daumen ist das eine Messung pro 12-Minuten-Zyklus! (120 Cycles pro Tag mal 365 Tage mal 10 Jahre = 400000 Cycles)
\item $\rightarrow$ Wir können nur nach Signaturen suchen, die sich langzeitmäßig oder regelmäßig ändern. Aussagen von Zyklus zu Zyklus sind überhaupt nicht sinnvoll!
\item Dist3D nimmt neue Parameter:
\begin{itemize}
	\item nrs\_perp ist Anzahl der Punkte an der kurzen Seite (da reicht eigentlich einer, denn die Breite ist klein gegen den Sektorsweep! Wäre nur praktisch, wenn man eine hübsche Abbildung vom Kollimator machen will)
	\item nrs\_perp: 3
	\item nrs\_sec: wie viele Steps in einem 45-Grad-Step
	\item nrs\_epq: wie viele Einzelsteps innerhalb der Breite eines EpQ-Steps (nominelles Geschwindigkeitintervall)
\end{itemize}
	\item Lars' Rechner kam mit nrs\_epq = 3 schon an seine Grenzen. Das liegt an calc\_w, weil da noch eine zusätzliche Dimension (Sonnenwindgeschwindigkeiten) dazu kommt. Das will er jetzt umbauen.
\end{itemize}
Weiter: Neu auschecken, Kopien anlegen und alles zum Laufen bekommen



\DayInJuly{Do}{18}
\begin{itemize}
	\item SWICS\_collimator durchgeschaut, alles verstanden
	\item Jetzt Dist3D durchgucken. Zum Laden von Lars' Probedatensatz: .../PUIs/ace\_swics\_3d.py
\end{itemize}

\DayInJuly{Do}{18}
\begin{itemize}
		\item Nachtrag zur Pip2-Installation (pycwt): \\ \textit{pip install --user pycwt}
\end{itemize}

\DayInJuly{Do}{25}
\begin{itemize}
	\item Nils: Schnell mal was plotten:\\
	\verb|figure(),plot(d.data["swt"])| \\
	Histogrammieren: \\
	\verb|figure(),hist(d.data["swt"],arange(0,300,1))|
	\item Bin bei Funktion \verb|def _calc_phspeff_wgt(self):|.\\ \todo{todo} Phasenraumvolumen nicht verstanden. Warum komme ich mit Integration nicht auf dasselbe Ergebnis, warum ist es nicht egal, welchen Winkel ich als welche Integrationsvariable nehme...?
	\item \todo{Geometriefaktor \ldots} Geometriefaktor auch nicht verstanden. Sullivan-Paper: woher kommt der Kosinus? 
\end{itemize}

\DayInJuly{Fr}{26}
\begin{itemize}
	\item \verb|_calc_sw_bulk_propoperties()| nicht gecheckt, warum passiert das da mit der Alfven-Geschwindigkeit und warum findet man das nirgendwo? \todo{Alfvengeschwindigkeit} Evtl. bei Marsch nachlesen...? \\
	Allerdings ist die Funktion auch nicht so wichtig atm, glaube ich, wird nicht benutzt?
\end{itemize}
\textbf{Lars:}
\begin{itemize}
	\item Datenprodukte ACE: \\ 
	\textit{dsw} -- Sonnenwinddichte \\
	\textit{tsw} -- Temperatur Sonnenwind \\
	\textit{swt} -- sector weight, ähnlich wie Base Weight Rate. Erklärung im Zusammenschrieb 
	\item Funktionenwald in \verb|dist3D_pui|: Die aktuelle, wichtige ist \verb|calc_w3dspecs|! Die funktioniert auch!
	\begin{itemize}
		\item Erklärung in 3 Schritten:
		\item Unten ganz normal histogrammieren mit diversen Weights
		\item twts: ? (wgts*swgt)
		\item Loops darüber: Wie oft habe ich in eine Richtung geguckt. Um den Dichtegang rauszunehmen, der daraus resultiert, dass man häufig entlang der Radialen guckt und zu zeigen, dass darunter ein ähnlicher Dichtegang liegt, der nichts damit zu tun hat
		\item zurückgegeben werden dann \verb|norm_arr| (proportional zur absoluten Messzeit, "`wie oft hat das Instrument in eine Richtung geguckt"'; Erwartung: häufig entlang der Spinachse, also radial) und Histogramm ungewichtet.
		\item Plot erzeugen: \\
		\verb|norm_arr[norm_arr==0]=1.| Null-Werte auf 1 setzen (warum?) \\
		\verb|H2 = H/norm_arr| Normierung durchführen \\
		\verb|wbins = arange(-2.-2.01.0.2)| \\
		\verb|pcolormesh(wbins,wbins,H2[10,:,:].T)| 10. Slice. Bei 11 geht man weiter nach vorne usw... (\todo[color=green!40]{Slices} rausfinden, in welche Richtung -- DONE s. Anfang September)
	\end{itemize}
	\item Die anderen eher sekundär (funktionieren auch nicht, weil die noch auf einem anderen Kollimator arbeiten?): Da hat L. nur mal schnell was ausprobiert oder der Versuch bzw. das auf 1D runterzubrechen (\verb|calc_wpecs2()|) oder für jedes w die PA-Verteilung zu zeigen (\verb|calc_muspec()|)
	\item Plan: Quick and Dirty für Ulysses umschreiben, solange Lars im Urlaub ist. Lars denkt, dass fast nur der Sec0-Versatz zum Sunpulse-Analyser geändert werden muss. Hiefür soll ich diesen Versatz als variabel lassen, sodass man den übergeben kann bei Funktionsaufruf und ein bisschen ausprobieren kann. Man erwartet den Protonen-Bulk (Bereich ziemlich starke Intensität) relativ radial. Auf dem Wege kann man schon einiges ausschließen. Das kann ich auch schon ohne die Gewichtung sehen.
\end{itemize}

\DayInJuly{Mi}{31}
\begin{itemize}
	\item Habe jetzt Dist3D für ACE durchgeguckt und das meiste gecheckt.
	\item Umbau für Ulysses. \todo{Ordnerstruktur} Neue Ordnerstruktur. Bisher liegt alles in \verb|old_stuff|.
	\item Muss ich an \verb|swics_collimator| was ändern?
\end{itemize}

\DayInAug{Do}{1}
\verb|swics_collimator| durchgeguckt. Liegt inzwischen als \verb|swics_collimator_ulysses.py| in \verb|./PUI/Ulysses|.
\begin{itemize}
	\item Rausgefunden, dass das Umbrechen der Zeilen \textit{Wrapping} heißt und es geschafft, das nachträglich in Pycharm für die Kommentare zu machen: File -- Settings -- Code Style -- \textit{Hard wrap} einstellen und \textit{Wrap on typing} ankreuzen. Außerdem unter Code Style -- Python -- Wrapping and Braces --\textit{Ensure right margin...} ankreuzen. Außerdem hat Edit -- Fill Paragraph geholfen. \\
	Danach reformatieren!
	\item In der Kollimatorklasse habe ich eigentlich nur die Dokumentation angepasst und ein paar Checks gemacht. Das KS ist bei ACE ja anders (GSE) als bei Ulysses (RTN), aber das ist ja schon bei der Berechnung des AA mit eingeflossen.
	\item
	\verb|offset_sp| ist jetzt der variable Versatz zwischen Sunpulse-Sensor-Guckrichtung und SWICS Z-Achse. (Bei ACE sind das 135 Grad.)
\end{itemize}
Jetzt geht es an \verb|Dist3D|.
\begin{itemize}
	\item Datenloader uswipha zum Laufen bringen: Daten wurden von \verb|/data/etph/...| nach \verb|/data/projects/...| verschoben. Die Lösung kann so einfach sein.
	\item \verb|swics_collimator_ulysses| muss schon ein FieldOfView zum Kollimator zufügen!
	\item Changes:
	\begin{itemize}
		\item \textit{did} $\rightarrow$ \textit{det}. \todo{Det-ID} Welchen Detektor muss ich jetzt nochmal rausschmeißen? Beobachtungen auf 3 Jahren Daten (1993,94,95):
		\begin{itemize}
			\item Det3 wird kaum angesprochen! (von 43 Mio PHAs nur 1225 auf Det3)
			\item Wenn ich nur Ech unter Threshold nehme (26 Mio; = Doubles), landen fast alle in Det0. (Det1: 26, Det2: 88, Det3: 164)
			\item $\rightarrow$ Ich würde denken, dass Det3 einfach Müll ist.
			\item Das passt auch zum Kommentar vom 2.Mai. D.h., ich muss eine Maske setzen, bevor ich in Dist2D reingehe. \todo[color=green!40]{Doubles} Soll ich eigentlich auch Doubles benutzen, macht das Sinn? DONE: Lars: Nein, die bringen uns nichts, weil die keine Detektorinfo tragen (natürlich...)
		\end{itemize}
	\end{itemize}
\end{itemize}
Morgen: Schauen, ob ich \verb|pui_ulysses| benutzen kann. Sonst anderes Main-Programm bauen (Daten laden, Masken setzen, ...).


\DayInAug{Fr}{2}
\begin{itemize}
	\item Pycharm-Problem vorab: Ich kann den Debugger irgendwie nicht bei meiner momentanen Datenstruktur verwende. Er findet die ganzen Pakete nicht...
	\item Weiter Veränderungen in Dist3D:
	\begin{itemize}
		\item Das Skript heißt \verb|load_pui_ulysses|. Benutze ich jetzt.
		\item Funktion \verb|getvelocity_allsteps| zum Umrechnen von EpQ-Steps in echte Energien pro Ladung bzw. in Geschwindigkeiten: s. Kommentar vom 15.04. Ist bei Ulysses SW eine andere als bei ACE. \todo[color=green!40]{getvelocity} Die richtigen Werte müssen wir noch raussuchen. Ich benutze jetzt erstmal die ACE-Funktion. Später muss dann auch die Anzahl der Steps angepasst werden! DONE: s. 28.8.
		\item \todo[color=green!40]{Delta EpQ} Ist Delta EpQ dasselbe, 3\%? DONE: Ist 5\%, s. Gloeckler. $\Delta v$ sind dann 2.5\%, s. Kladde S. 84.
		\item \todo[color=green!40]{Geomfak}Geometriefaktor ist wahrscheinlich derselbe, oder? DONE: Joa
		\item \todo[color=green!40]{Eigengeschwindigkeit} In \verb|_calc_vspace_| wird bei ACE die Eigengeschwindigkeit nur in der y-Komponente abgezogen. Das muss bei Ulysses aber ja nicht so sein (?). DONE: Nein, geregelt.
		\item Ich bin gerade verwirrt von den Koordinatensystemen. GSE hat x-Achse ja vom SC zur Sonne positiv und später wird das umgedreht, damit der SW grob aus positiver Richtung kommt. RTN eigentlich andersrum. Soll ich das so beibehalten? Dann muss ich nochmal zurück zum Kollimator. Denn das FOV ist dann ja in negativer R-Richtung. \\ Ich hab jetzt erst einmal das RTN umgedreht (also eigentlich nur die Konvention in die Kommentare geschrieben), jetzt ist alles so wie beim GSE. Es ist ein bisschen inkonsistent, dass ich den AA ab der negativen R-Achse berechne (aber das habe ich irgendwie ja immer schon so gemacht. Jetzt auch in der \verb|calc_asp_angles|-Funktion deutlich kommentiert). Jetzt tue ich halt so, als wär das die positive Achse, dann muss ich nichts ändern bei FoV. \todo[color=green!40]{Koordinatensystem} Aber vielleicht wird das problematisch, wenn ich die Eigengeschwindigkeit einrechne, die ja evtl. in normalen RTN-Komponenten angegeben wird? DONE: Hoffentlich richtig gemacht
		\item In \verb|_add_3Dv| musste ich nochmal Datenproduktnamen ändern, außerdem \textit{det DCR to det 0} rausnehmen. Bei ACE gibts es offensichtlich $det = 7 $- Zuweisungen. \\
		Außerdem geht der EpQ-Step über 60 hinaus. Das crasht, weil ja die getvelocity von ACE mit 60 Steps benutzt wird. Ich wollte Daten erstmal einfach vormaskieren, bekomme das aber nicht hin. Bei der Übergabe von \verb|d| wird die Mastermaske ignoriert! Ich suche quasi die subset-Funktion aus dbData -- nur "`live"', also ohne Wegschreiben.
	\end{itemize}
\end{itemize}

\DayInAug{Di}{6}
\begin{itemize}
	\item Bin jetzt den Umweg gegangen über \verb|save_subset| und \verb|load_subset|. Damit schreibe ich ein Subset von den gefilterten Daten (Det von 0 bis 2 und epq von 0 bis 59) in eine Binärdatei und lese sie wieder ein...
	\todo{Subset} Da muss es aber doch noch einen anderen Weg geben? \\
	Nachtrag: Ich habe EpQ schließlich von 1 bis 58 gefiltert, weil die ACE-Daten auch so vorliegen. 0-59 hat für \verb|get_velocities| funktioniert, aber nicht fürs Synchronisieren der Efficiencies.
	\item \todo[color=green!40]{Efficiencies} Efficiencies soll ich ja erstmal von ACE nehmen. Da die nur für die Triples gelten (?) filtere ich die Doubles jetzt auch mal raus: \\ \verb|d.set_mask('Master','ech',12,120,reset=True)| \\ DONE: 05.09.
	\item Für Ulysses gibt es das Datenprodukt \textit{swt}, das Sectorweight, nicht. \todo[color=green!40]{Sectorweight} Lars fragen bzw. selbst nachgucken, evtl. wird das nur über uswipha nicht eingeladen. Bis dahin setzte ich alle Gewichte auf 1 (in \verb|calc_w3dspecs)|). DONE
	\item Es läuft durch!! Ich kann das Spektrum erzeugen!! Jetzt mal mehr Daten einladen...
	\item Ständig Memory Error... \\ 200 Tage sind das Maximum.
	\item Überlegung, warum jedes PHA-Wort überhaupt 9 FoV-Punkte hat: Weil man nicht weiß, wo der Sektor getroffen wurde. Punkt 0 hat z.B. eine ganz andere w-Signatur als Punkt 5. Alle Möglichkeiten müssen betrachtet werden.\\
	Aber: Macht eine w-Auflösung von 0.2 überhaupt Sinn?\\
	Die größte Differenz im Betrag von w haben immer der erste und der letzte Eintrag. \\
	Differenzen werden kleiner für größere EpQ-Steps. Stimmt nicht ganz: Peaken bei einem mittleren EpQ-Step (abh. von vsw)\\
	WARUM verändern sich die Differenzen für verschiedene Sektoren bei keinem AA?? $\rightarrow$ Weil irgendwie der AA doch nicht Null ist. Was geht da schief?\\
	ToDo für morgen: \begin{itemize}
		\item Methode basteln, um schnell irgendwelche Sachen zu plotten, z.B. wSpace. Das ist ja nicht mehr wirklich eine Sache in SwicsCollimator, weil ich mir ja mehrere Kollimatoren angucke.
		\item Methode schreiben, mit der ich durch die pcolormesh-Dinger loopen kann, um mir ein besseres Bild zu machen.
		\item Variablen SP-Offset durchführen und das verstehen.
		\item Oben weiter machen: Wollte eig. nur sicher gehen, dass sich die Diff mit den Sektoren nicht ändern und mit den Detektoren schon! (Tut es das dann?)
	\end{itemize}
\end{itemize}


\DayInAug{Di}{26}
Habe jetzt nach langer Pause nochmal neu angefangen, Dist3D durchzugucken.
\begin{itemize}
	\item \verb|calc_w3dspecs()|: 
	\begin{itemize}
		\item Was ist mit \textit{d00}? Ich habe nur \textit{d90}. \todo[color=green!40]{d90, d00} Ist das egal? Hab das jetzt erstmal einfach auf \textit{d90} geändert. Ich frage mich, wie das vorher durchlief...? DONE: Wird weiter oben erzeugt
		
		\item Warum suche ich eigentlich nur eine Kombi pro Tag? Warum histogrammiere ich nicht alle vorkommenden Kombis? \\ $\Rightarrow$ Verstanden: Das sind nur die Bingrenzen. Warum die gerade so gewählt werden, ist aber irgendwie trotzdem random? (Anne, das stimmte nicht)\\
		AH! Alles falsch! Ich nehme die Uniquewerte, weil ich zum selben Zeitpunkt mehrere Messwerte habe. Ich will aber nur jeden Zeitpunkt einmal! Die Bingrenzen habe ich als Argument mitgegeben.
		
		\item \todo{ivoffset} Wozu ivoffset?
	\end{itemize}
\item Ich verstehe immer noch nicht so ganz, was ich da oben genau verstehen wollte -- warum soll sich die w-Diff. wann ändern?\\
Aber kann es sein, dass ich die ersten Einträge beim AA genommen habe und das gar nicht 0 war, sondern eben der kleinste in diesem Zeitraum gemessene...?
\end{itemize}


\DayInAug{Mi}{27}
\begin{itemize}
	\item \textit{d00} wird oben berechnet! (in der \verb|init| von Dist3D)
	\item Verwirrung: Warum sind die Werte des wspace (Betrag) \textit{immer} unterschiedlich? Bei der Konstruktion werden die doch auf 1 normiert und dann mit \textit{einer} Akzeptanzgeschwindigkeit malgenommen...(alle Sektoren, alle Detektoren)? \\
	Gecheckt: FoV vom Collimator hat immer den Betrag 1 im Betrag. \\
	Gecheckt: Bleibt auch so für verschiedene AA (in Dist3D) \\
	Lösung gefunden: Die Unterschiede kommen rein, wenn man die Eigengeschwindigkeit betrachtet! \\
	...Und natürlich, wenn man beim Umwandeln in w die SW-Geschwindigkeit nur in x-Richtung abzieht. Das ist ja dasselbe Problem, die Beträge SIND dann halt nicht mehr gleich. (Und das ist auch der Fall, wenn keine Eigengeschwindigkeit mit reinkommt!)	
\end{itemize}
Abschließend habe ich festgestellt, haha, dass die w-Werte für Detektorpunkte innerhalb einer Det-Sek-Kombi in allen(?) Fällen eine maximale Differenz unter 0.5 haben (Details: Die max. Differenz liegt bei mittleren EpQ, rutscht mit größeren vsw etwas weiter zu kleineren EpQ-Steps (evtl. mal überlegen, warum...), ändert sich vom Wert aber kaum).\\
Damit schließe ich das Thema erstmal ab, wird bestimmt bei der Fehlerbetrachtung interessant... (Da muss man dann auch die Breite im EpQ-Step und die Variabilität ineinem einzigen Step betrachten)\\ Jetzt erst gesehen: Lars' w-Bins sind aber nur 0.2 breit... (\verb|nrs_sec|))\\ \\
Jetzt: Sunpulser-Angle variabel übergebbar einbauen. hatte ich schon gemacht. \\
Morgen: prüfen, warum das w-Spektrum nicht einfach gedreht ist, sondern komplett anders aussieht mit unterschiedlichen SP-Offset-Angles.

\DayInAug{Do}{29}
Kurze Funktion geschrieben, um das Plotten des w-Spektrums zu automatisieren. \\ \\
To Do: \\
\todo[color=green!40]{colorbar} Colorbar und passende Range. Wie beim Polarplot muss ich überlegen, ob ich auf einzelnen Steps oder auf alle Werte normieren möchte. \\
\todo[color=green!40]{Durchklicken} Animierte Funktion schreiben, mit der ich durch die Slices klicken kann. Duncan gefragt: Stichwort \textit{ClickEvent}, Figure damit verbinden. Minimalbeispiel suchen: \textit{mpl.canvas.connect}. Nur machen, wenn das einigermaßen schnell geht...
\\ \\
Fehlersuche, warum offsetSP das Spektrum nicht nur dreht, sondern insgesamt verändert (habe einheitliche viridis-colormap. Die Range ist auch ganz unterschiedlich...):
\begin{itemize}
	\item Test mit offset 135 Grad und 45 Grad (90 Grad Versatz)
	\item v-Space ist einfach gedreht um 2 Sektoren. W-Space auch.
	\item Die den PHA-Worten zugeordneten v- und w-Werte unterscheiden sich, auch wenn man ein Wort mit dem entsprechenden sektor sucht: Denn dann ist ja der EpQ-Step, Detektor etc. anders.
	\item Überlegung: Sollte sich das über viele Daten nicht trotzdem ausgleichen und in etwa ähnlich aussehen? (Ich glaube bei 200 Tagen sieht man es scho etwas!)
	\item Und wie beeinflussen die Anzahlen der verschiedenen Steps (para,perp,epq,sec) das ganze? Test:
	\begin{itemize}
		\item Nur wenige (20) Tage einladen, damit ich mit der Anzahl hochgehen kann
		\item Am meisten Einfluss haben nrs\_perp und nrs\_para, die \textit{weichen} das Spektrum etwas auf.
	\end{itemize}
\end{itemize}

Wollte mir überlegen, wie das Spekturm bei einem falschen Offset aussähe, keine Ahnung. Wollte mir das angucken für verschiedene Offsets. Dafür die Maske wegnehmen, die auf He+ einschränkt. Das funktioniert irgendwie nicht. Das Quadmesh aus der Plotfunkton sieht immer gleich aus. Morgen untersuchen. \\
Außerdem: Kann es sein, dass ich das falsche w\_He einschränke?


\DayInAug{Fr}{28}
\begin{itemize}
	\item w\_He1+2 ist ein Datenprodukt, das in Dist3D zugefügt wird. Das sollte gleich sein mit dem wHe, das sowieso schon in den Ulysses-Daten ist -- allerdings erst dann, wenn die richtigen EpQ-Umsetzungen da sind. D.h., man könnte die evtl. finden, wenn man guckt, womit wHe auf der uswipha-Ebene berechnet wurde.
	\item Habs gefunden, in uswiutils. \verb|getvelocity|-Funktion angepasst, Steps angepasst (64 bei Ulysses), aber EpQ-Filter muss trotzdem auf 58 Steps bleiben, \todo[color=green!40]{efficiencies} weil immer noch die Efficiencies und die Sektorgewichte fehlen. Delta v / self.vels auch angepasst. Alles DONE
	\item Jetzt: Loopfunktion schreiben
	\item Schon fertig, das hat super geklappt! Ich habe das Spektrum zum Plotten in eine Klasse (WSpec) ausgelagert. Man kann jetzt durchslicen und auch drehen (auf Tastendruck oder über Funktion). Als nächstes möchte ich eine gute Anzeige, die angibt, wo ich gerade bin -- vielleicht auch eine entsprechende Skizze...? Die Colorbar vielleicht auch noch anpassen, damit man mehr sieht und Funktion, auf einzelnen Slice zu normieren...?
\end{itemize}

\DayInSep{Mo}{2}
\todo[color=green!40]{Trafo w-Spec} Irgendwie scheinen mir die Schnitte komisch. Nochmal checken, wie ich transformieren muss.\\
DONE:
\begin{itemize}
	\item Wenn z mit in der Ebene: transformieren (weil die \textit{letzte} Dimension von pcolormesh standardmäßig auf die x-Achse geplottet wird. Das liegt einfach daran, in welchem Format der geslicte Arary vorliegt.)
	\item Wenn y mit in der Ebene: x-Achse umdrehen (damit wir in positiver x-Richtung gucken)
	\item Die Ebenen sind jetzt:
	\begin{itemize}
		\item x-Schnitt: oben pos. z, rechts neg. y, Blickrichtung von Sonne zu SC
		\item y-Schnitt: oben pos. z, rechts pos. x. Blickrichtung: rechts geht zum CS, links zur Sonne
		\item x-Schnitt: oben pos. x, rechts neg. y, Blick von oben auf die Ekliptik
	\end{itemize} 
\end{itemize}
Textfeld/Annotation unabhänhig von Axes (relevant, wenn man Axes z.B. umdreht): \verb|ax.text(..., transform = self.ax.transAxes)| \\
Colorbar-Range updaten: Mit \verb|update_bruteforce|.\\
Aha.haha. Habe in sämtlichen Funktionen vergessen, durch den norm-Array zu teilen.\\
Ändert das was? Sind da immer noch komische Signaturen? He ausschneiden, Offset testen, Lars dazu holen. SW rausfiltern, Unterschied min\_wHe angucken


\DayInSep{Di}{3}
Range weiter angepasst: Jetzt immer scientific Notation. \\ Color\_norm 'all' macht echt nur Sinn, wenn man gaaanz wenige Tage einlädt, sonst ist die Range zu groß und man sieht nichts.

\DayInSep{Mi}{4}
Hatte ein Problem, auf dbData ein Histogramm zu erstellen. Problem gelöst: Colormap \textit{spectral} wurde in meiner Matplotlib-Version abgeschafft. Ich glaube, \textit{nipy\_spectral} sieht ähnlich aus. \textit{Spectral} ist pastelliger und mit weniger Range. Sollte Lars davon berichten. Habe im Skript \verb|_dbData.py| in der Klasse \verb|plot_properties| die \textit{contourcolor} geändert. Jetzt läufts.
\\ \\
Besprechung Lars:
\begin{itemize}
	\item Problem Subset: Eigentlich arbeitet Dist3D ja nur auf d, d.h. die Masken sollte alle bleiben. Wird wahrscheinlich nur überschrieben/resettet in Dist3D. \\ \todo{Masken anpassen} checken $\Rightarrow$ verstanden, s. nächster Tag. Ist erstmal egal.
	\item \todo[color=green!40]{efficiencies} Efficiencies: Gibt es nicht direkt für Ulysses. Da kann ich mit den ACE-Werten vergleichen und dazwischen interpolieren -- denn es geht nur um den groben Gang, wenn man EpQ-Steps an verschiedenen Enden vergleichen will
	\item \todo[color=green!40]{sector weights} Sektorgewichte: Gibt es wahrscheinlich nicht in den Ulysses-Daten. Base Rate Weights nehmen, die sind halt dasselbe, nur über einen gesamten Spin gemittelt. ($\Rightarrow$ Informationsverlust, denn es ist ja schon interessant zu wissen, ob in Sektor 1 20 Teilchen gemessen wurden oder über alle verteilt...(?)) \\ BRW sind wahrscheinlich bei meinem He-Subset immer 1, weil da eh nicht viel gemessen wurde... \\
	DONE: einfaches BRW als Sectorweight übergeben. \todo{brw} Später aber nochmal gucken, wie oft das nicht 1 ist.
	\item \todo[color=green!40]{w statt Slice} Im 3D-Schnitt w in der Ecke angeben statt dem Slice\\DONE: vmin ist jetzt der kleinste Wert nach 0, sowohl für \textit{color\_norm = all} als auch \textit{color\_norm = sg} fürs gesamte H-Array.
	\item \todo[color=green!40]{Colormap Range} Wo kein Count ist weiß machen: \textit{v\_under}, white, vmin... DONE
	\item Sunpulse-Offset: \\ \\Zum Backward-Engineering: SW ausschneiden in 5-min-Intervallen und dann det-sec Histogramm erstellen. Da sollte man gut erkennen, was aufleuchtet.\\ \\ Robert Frage für Rudi (?) schicken.\\ \\
	Lars hat was im DPU gefunden. \todo{Testen Offset} 180 Grad $\pm$ 45 Grad...?
	\item \todo[color=green!40]{Eigengeschwindigkeit} Bestimmung, indem ich Ableitung zwischen zwei Koordinatenangaben bestimme ($\Delta V$ // $\Delta t$) $\Rightarrow$ Gibt dann vx,vy und vz grob an. Mit in die Trajektoriendateien schreiben. Done, ewig am Einarbeiten in die PHAs gebastelt.
	\item Leider läuft He schnell in den Threshold mit höheren ESA-Steps (dann nur noch als Doubles). Robert: Da wurden andere, ältere SSDs verwendet als bei ACE oder bei PLASTIC: Goldschicht mit ziemlich hoher Totschicht. \todo[color=green!40]{ECH-Grenze} Diesen Threshold nochmal prüfen! Denn He liegt weit unten, nicht versehentlich wichtige PHAs wegschneiden. \\	 
	D.h., dass wir uns nur die äußeren Schalen und nur den schnellen SW angucken können (bzw. die Schnitte, die mittig zu entsprechend großen ws gehören...?) $\Rightarrow$ Klar, denn kleinere Geschwindigkeit heißt kleinere Energie und He hat kleine Masse. \todo{warum?} Dafür haben wir da auch keinen störenden Hintergrund.
	\item He+ rausfiltern:
	\begin{itemize}
		\item erste Überlegung: Mit mpq-Algorithmus He sauber auf 4 abbilden (?). Dann liegen da noch ein paar andere drüber (oben rechts in EpQ vs ToF), die man über E vs ToF rausfiltern kann\\
		Drüber nachdenken, aber es geht viel einfacher:
		\\ \todo{He ausschneiden und wegschreiben} (Wie schreibe ich PHA-Worte weg? Wie liegen die eigentlich vor...?)
		\item Range: In RNG0 sind He und Protonen, in RNG1 schwerere Ionen. Die Boxen sind einfache Rechtecke in m, mpq und dann in ToF vs EpQ Dreieck/Schlauch. D.h. als erstes nur RNG0 maskieren.
		\item Dann eine \textit{wandernde Box} in E-vs-ToF-Darstellung (animate) legen: Evtl. per Mouseclick-Tracker: Bei welcher ToF ist der He-Bulk beim jeweiligen EpQ-Step? Wenn das PHA in einer Box innerhalb $\pm$ Kanäle liegt: PHA wegschreiben, dann habe ich mein Set, auf dem ich arbeiten kann und man braucht keinen komplizierten mpq-Algorithmus. In der senkrechten kann ich das genauso mitfiltern, aber bei unseren 50 Tagen lag da bei rng0 eigentlich auch nichts. \\ Super, dass das so sauber ist!
	\end{itemize}
	\item Doubles sind für uns nicht interessant, weil es für die keine Detektorinfo gibt $\rightarrow$ keine 3D-Auflösung
	\item Geometriefaktor ist im Prinzip nur vom Instrument abhängig, soll ich also von ACE übernehmen
	\item Robert hat DPU geschickt. \todo{DPU} Mal reingucken
\end{itemize}

\DayInSep{Do}{5}
Heute: Nach und nach die Todos von gestern abarbeiten:
\begin{itemize}
	\item Für die Effizienzen kurzes Skript geschrieben (\verb|guess_ul_eff.py|), das eine Funktion an die ACE-Effizienzen fittet und den Ulysses-EpQ-Werten passende Werte zuordnet, weggeschrieben in \verb|He1+.eff|, z.Zt. im Hauptskriptordner
	\item Subset-Mastermaskenproblem verstanden: An vielen Stellen werden die Daten aus d geholt ohne die Mastermaske aufzurufen. Das sind dann \textit{alle} Daten. Mit dem Subset bin ich das umgangen, weil \textit{alle} Daten dann das Subset waren. Vielleicht frage ich Lars nochmal. Ich ändere das jetzt erstmal nicht alles um, sodass die Daten der Mastermaske genommen werden, weil das ganz schön viel ist. Vielleicht brauche ich das eh nicht mehr, wenn ich mir mein He-Subset weggeschrieben habe. Bis dahin mache ich das weiter mit dem künstlichen Subset.
\end{itemize}

\DayInSep{Fr}{6}
Probleme beim BRW gelöst: Nuller wegmaskiert.\\Probleme bei den Efficiencies: angehängte 0 für ACE übersehen, jetzt passts. \\ \\
Eigengeschwindigkeit: Lars meinte, ich soll die Differenzenquotienten zwischen zwei Trajektorienpunkten bilden und das mit in die Trajektorienfiles schreiben. Ich brauche die Geschwindigkeit ja in RTN-Koordinaten. Die Trajektorienfiles liegen ja aber gar nicht in RTN vor. Könnte ich v in HG-Koord. berechnen und dann genauso transformieren?


\DayInSep{Mo}{9}
Ich wandele jetzt beide Positionen von HG sphärisch in RTN kartesisch um und subtrahiere 2-1. In die Liste schreibe ich dann vx, vy, vz und den Betrag. \\ \\Habe den Betrag mit v aus \textit{ulysses\_daily\_heliocentric...dat} verglichen: Immer leichte Abweichung. Lars meint, da soll ich mir keine Gedanken drüber machen -- Rundung etc... \\ Hauptsachen, das SC durchläuft dieselbe Geschwindigkeit wieder im nächsten Orbit. \\
Komische Werte Ende 2001 gefunden: Da stehen für ca. 20 Tage nur Nullen in \textit{helio.dat}. \todo[color=green!40]{Werte helio.dat} Die sollte ich mal interpolieren, vielleicht kann ich die auch exakt berechnen aus HC...? \\
Done: Dafür habe ich ja eine Funktion, klappt super. Habe jetzt \verb|fill_up_gap()| und \verb|calc_velocities()| in \verb|traj_pooled| geschrieben -- dort wird die neue kompakte Trajektorienliste geschrieben. Die tatsächlichen etwas komplexeren Funktionen dazu stehe jetzt alle in \verb|ul_calc_traj|.\\ \\
Jetzt muss ich \verb|Dist3D| damit verknüpfen.\\
Datenprodukte zugefügt und Ordnerstruktur etwas aufgeräumt. \\

\DayInSep{Di}{10}
Jetzt Riesenproblem: Wie soll ich das in das V-Space-registern integrieren? Ich kann doch nicht noch 3 Dimensionen mehr anlegen... Ich schaue mir den Verlauf der einzelnen Geschwindigkeiten jetzt erstmal an. Plotfunktion \verb|plot_eigen_velocities()| in \verb|pui_ulysses.pui|. \\
Warum wackeln die Geschwindigkeiten so? Das kommt durch Rundungen und dadurch, dass ich von AU auf km gehe. Ich versuche jetzt, den Radius in km einzuladen, das ist in einer der Files gegeben. Etwas nervig, aber gut... Einen Versuch ist es Wert.\\
Krass, das hat es voll gebracht. Ich sollte den Radius in km auch in die anderen Funktionen füttern, wo es geht.\\ Macht es irgendwie nicht:
\begin{itemize}
	\item von HG zu HC gibt es in beiden Fällen eine Abweichung zum HC-Wert, km und AU unterscheiden sich nicht.
	\item von HC zu HG dito. Ich bräcuhte einfach genauere Winkelwerte. Egal. Ich nehme R\_km jetzt wieder aus der Pooled-Liste.\\
\end{itemize}
Ich bin SO verwirrt. Morgen weiter machen. In \verb|calc_v| Zwischenwerte umrechnen oder sogar zwei verschiedene Funktionen schreiben.

\DayInSep{Mi}{11}
Heute mit klarem Kopf nochmal angeguckt:
Verwendung der Radiusangabe in km macht einen Unterschied für v\_R, aber nicht für die anderen v-Komponenten, weil die Winkelangaben sowohl in HC als auch in HG zu ungenau sind. Umrechnen mit dem genauen Radius bringt nichts. Damit muss ich so leben. \\
Jetzt weiter mit dem echten Problem. Lars fragen...?\\
Nee, ich erweitere das Register jetzt einfach. Geht glaub ich eh kein Weg dran vorbei, nicht so schlimm, trägt zu meinem eigenen Verständnis bei -- hoffentlich.\\
Wie groß sollen die Steps sein? Wenn ich abschätze, dass wir w auf 0.2 auflösen, entspricht das einer Geschwindigkeit von ca. $500\,\mathrm{\frac{km}{s}}$ ?!\\ \\
Lars sagt, dass Translationen additiv sind, deshalb kann man auch beim Mappen der PHA-Worte mit den Geschwindigkeiten die Eigengeschwindigkeit dazuaddieren (so wie das mit w // der SW-Geschw. passiert). Ich probiere das kurz aus, ob dasselbe rauskommt (Eigengeschwindigkeit im Grid abziehen oder händisch verschieben). \\ \\
Frage nach der Auflösung:
\begin{itemize}
	\item Beispielzeichnung w-Space mit 600 km/s: 30 km/s in y-Richtung verschoben (wie bei ACE): Teilchen auf Schale w = 1 (eig. 600) landet oben bei 630, w = 1.05 und unten bei 570, w = 0.95.
	\item Ich kann die Bins auch mal anpassen und schauen, was passiert. eigentlich wären Bins wie bei PLASTIC besser, also welche, die sich an den Phasenraum anpassen (rund). Die momentanen Rechtecke haben ja immer unterschiedlich viel des Kreises überdeckt (Frage to self: \todo{Bin-Grid} Ist das nicht irgendwie beim Phasenraum mit eingerechnet?). Das wäre ein weit entferntes ToDo...
\end{itemize}
Kommentare zum Phasenraum:
\begin{itemize}
	\item Eigengeschwindigkeit dafür nicht mit rein, denn das ist rein instrumentenspezifisch (??).
	\item Beispiel Autos: in meiner Richtung Autos mit 95, aus der Gegenrichtung auch (gleichverteilt). Ich fahre mit 100. Weiter weiß ich nicht, nochmal drüber nachdenken, fragen.
\end{itemize}
Meinen Plot zur zeitaufgelösten Geschwindigkeit könnte ich mit in die MA nehmen. Zeigen, dass der Verlauf so ist, man den Fast-Latitude-Scan sieht, besonders in einer Komponente (wir schauen uns aber eher den Bereich an, wo das nicht so eine große Rolle spielt, da sind die Komponenten alle nicht so groß)
\\
Morgen: weiter vergleichen.

\DayInSep{Do}{12}
Fazit: Es passt, macht also keinen Unterschied, ob ich den V-Raum im Grid anpasse oder das eigentliche Datenprodukt beim Adden zu den PHA-Worten (außer dass ich beim Grid gerundet habe ich z.B. nicht 9.5, 9.67 und 9.88 zufüge, sondern immer 10).\\
Jetzt: Schauen, ob die Richtungen im RTN richtig sind, yay... \\
Hab mir den Kopf zerdacht, s. S. 85 in Kladde. Hoffe die Richtung passt jetzt, ich bin zu blöd das zu prüfen. Muss morgen gucken, dass das auf mehrere Detektorpunkte auch klappt.

\DayInSep{Fr}{13}
Habe das gelöst mit der Funktion \verb|numpy.tile|, \verb|.T| \\und die Anzahl ist \verb|self.col_dim|. \\ \\
Jetzt Threshold Ech-Detektor checken. Wollte mal mehr Daten einladen, gab Problem mit \verb|sync_traj|. Die Maske, die da gesetzt wird, ist glaube ich ziemlich sinnlos. Die war nur für \verb|sync_swoops|, weil da ggf. durch 0 geteilt wird. Das passiert hier nicht, weil ich keinen Mittlwert bilde, weil d90 gleich ist.\\
Ergebnis: Stimmt wirklich. Ganz ohne Filter ist erst E-Channel 15 belegt. Manchmal gaaanz wenig in 12 oder 14 (?!).


\DayInSep{Di}{17}
Jetzt He+ filtern: \\
Brauchte lange, um \verb|animate2d| aus \verb|dbData| zu erweitern, um die Mouseclickfunktion einzupflegen. Muss immer noch manuell die Fkt. zum Setzen der Masken aufrufen, will gern wissen, wie ich das in die \textit{init} bekomme. Musste \verb|animate2d| außerdem um ein Returnen der Figure erweitern. Die Funktion selbst ging dann aber gut.
Morgen:
\begin{itemize}
	\item Headline in gefilterte PHAs schreiben
	\item Überlegen, ob ich Epq noch runterzählen muss
	\item Lars Diverses fragen (s. Liste)
	\item jahrweise duchlaufen lassen
\end{itemize}

\DayInSep{Mi}{18}
Headlines und EpQ geregelt.\\
Lars gefragt:
\begin{itemize}
	\item Komische Signatur in ET-Matrix rechts von He+: Lars weiß auch nicht, was das ist. Ganz komisch, er forscht nach. Man kann das einigermaßen gut von He+ trennen, aber es besteht die Gefahr, dass das He+ selbst ist, was zeitweise falsch zugewiesen wurde und was man dann wegschneiden würde. Zeitlich ist das auch nicht einchränkbar.\\ Es gibt zwei seltsame Peaks: Einr ist ein Doublepeak, der andere ein Treblepeak
	\item Lars hat 2D-Maske gesetzt und dann die Zeiträume angeguckt bzw. sich die Daten zu diesen Zeiträumen angeguckt (bzw. die zur inversen Maske!). Es gibt aber nicht immer Parallelen zu den anderen komischen Signaturen und das He+-Signal gibts auch immer noch.\\
	Könnte auch ein seltsamer Bitfehler sein...? Alle 64 Kanäle in Tch?
	\item Lars hat mir \textit{mpq-Algorithmus}'erklärt: Todo
	\item \todo[color=green!40]{mpq-Alg} Versuchen, das formelmäßig nachzuvollziehen und evtl. auch an H+, He2+ und He+ durchführen (gut zu erkennen in EpQ vs. ToF).\\
	MpQ-Algorithmus:
	\begin{itemize}
		\item Wenn wir in EpQ vs. ToF Spezies identifizieren können, kennen wir die MpQ.
		\item Bei fester EpQ kennen wir dann auch die v vor dem Analysator
		\item Übr ToF kennen wir auch die v nach der Folie
		\item Was wir nicht kennen: Energieverlust in der Folie, der abhängig von der Geschwindigkeit (u.a.) ist (die Breite in Tch-Richtung entspricht dieser Verteilung des Energieverlustes)
		\item Aus dem Wissen, dass dieser Tch bei diesem EpQ-Step auf MpQ xy mappt, ergibt sich funktionaler Zusammenhang (Hyperbel?): Tch $\leftrightarrow$ MpQ (pro EpQ)
		\item Dann kann man über MpQ statt über Tch plotten (\textit{hochbiegen})
		\item Je mehr Spezies man mit rein nimmt, desto besser wird die Funktion. perfekt wird sie aber nie, weil der Energieverlust in der Folie sogar bei selber MpQ entartet ist (massenabhängig)
		\item Wenn man jetzt noch ET-Matrix (Ech vs. ToF) dazu nimmt, kann man zuordnen, welche Masse auf welcher E-Tch-Kombi landet. Dann kann man theoretisch PHA reingeben und m gegen mpq plotten und erhält solche Boxen wie in Glöcklers SWICS-Paper 
	\end{itemize}
	\item He+ ist in EpQvsToF fast noch besser zu tracken als in der EchvsToF über die \verb|animate2d|-Funktion. Ich kann da auch einfach die EpQs entlangklicken. Die Dreckbubble rechts weglassen.
	\item Erstmal genug Theorie. Jetzt Klickprogramm erweitern um Funktion, mit der ich einfach den Schlauch in EpQvsToF ausschneiden kann.
\end{itemize}
%
Habe ich fast fertig. Man kann jetzt auswählen, welches Datenprodukt man möchte. Achtung beim Klicken: in der unteren Hälfte des Bins klicken, damit abgerundet wird. Oder achnee, der Index wird ja angeben, welchen EpQ-Step ich habe. \\
Ich möchte morgen lieber zwei Grenzen angeben anstatt nur einen Tch-Wert, um den herum symmetrisch Kanäle genommen werden (weil die anderen Sachen teilweise sehr nah kommen un die Breite doch nicht so konstant ist)

\DayInSep{Mo}{23}
EpQ-Klicken läuft jetzt auf zwei Intervallgrenzen.\\
Momentan teste ich, ob es einen Gang zwischen den Jahren gibt.\\
Ergebnis: Nö, sieht immer ziemlich konstant aus. Aber ich bin beim Klicken manchmal sehr unsicher, ob ich was mit reinnehmen soll, oder ob das "'Rauschen"' ist. \\
Muss Rng0 und Doubles raus noch händisch machen, stört aber nicht. \\
Jetzt mache ich dasselbe auch noch für die Protonen, damit ich nur Sonnenwind habe und die Ausrichtung vom Kollimator prüfen kann.\\
Die Protonen maskiere ich jetzt über ESSD, He+ über EpQ. Der Code ist entsprechend angepasst.
\\ \\
Nochmal Besprechung Lars:
\begin{itemize}
	\item Frage: Soll ich Kanäle $\textgreater$ 16 mitnehmen, obwohl da ja theoretisch auch schwerere Ionen in die RNG0 gekommen sein können?\\ Ja, besser jetzt eine grobe Vorselektion und dann später, z.B. über $w$-Filter, weiter filtern. Kann auch ruhig erstmal die Doubles mitnehmen.
	\item Das Problem ist, dass man nicht weiß, welcher Anteil gerade unter den Threshold gewandert ist. Eine Möglichkeit wäre, sich Doubles und Trebles (bzw. alles und Trebles) nebeneinander anzugucken und zu schauen, welcher Anteil jeweils wo gelandet ist (pro EpQ-Slice). Das ergibt dann ein zusätzliches \textit{Gewicht}
	\item Es ist zu erwarten, dass Tof-Intervall breiter wird für größere ToF (wegen Folie)
	\item Die Protonen, die ich gerade versuche zu filtern, sind suprathermale! Denn die anderen sind nicht in den Trebles, sondern Doubles, weil auch unter Threshold. Bei den Suprathermalen ist nicht richtig bekannt, ob die wirklich im SW-Bulk sind. Wir brauchen was in den Doubles, weil wir ja an Sektor- und Detektorinfo wollen:
	\item Besser He2+ nehmen: Weil das 2-fach geladen ist, bekommt es durch die Nachbeschleunigung die doppelte Energie (vgl. zu He1+ und H+) und wandert nicht so schnell unter den Threshold (die SSD misst ja nur die komplette Energie nach der Nachbeschleunigung)!\\
	Sitzt schön im Bulk als schweres Ion; hat eine gute Statistik: auch wenn c6+ in die RNG0 rutscht, macht es nur ein Tausendstel oder so aus (sitzt außerdem wahrscheinlich auch im Bulk, allerdings weiß man nicht genau mit der Geschw...?)\\
	Mit dem He2+-Filter gucke ich mir dann den Kollimator an. Stelle AA ein, schaue, welcher Sektor/Detektor in Richtung Sonne steht. Passt das zu den Daten oder gibt es einen Versatz?
\end{itemize}

\DayInSep{Di}{24}
Habe gestern noch He2+ gefiltert, in EpQ-Matrix. \\
Jetzt mache ich He1+ nochmal. Ich soll nämlich doch in höhere Kanäle gehen, wenn es geht. (Der Rest wird dann später über w gefiltert)\\
Anzahl von einem Jahr (1995):
\begin{itemize}
	\item ungefiltert: 18861633 (ca. 18 Mio) Teilchen
	\item He1-Maske: 140500 (0.7\%)
	\item davon nur RNG0: 27291 (19\%)
	\item davon Doubles: fast nichts
\end{itemize}
Habe jetzt alle Jahre gefiltert. Probiere jetzt aus, ob das mit dem w-Spektrum noch geht. \\
Vielleicht sollte ich nochmal filtern, um die Doubles mitzubekommen (die sitzen in EpQ-Matrix in den höheren ESA-Kanälen, weil da die Energie so gering ist, dass sie unter den Threshold rutschen). Versucht, Systematik zu erkennen: Aber alle Jahre verschieden. Habe Halbjahresplots von 1993 bis 1997 in \verb|Ulysses/Plots/Halbjahre_EpQ_ToF|: Nur RNG0 und mit/ohne Maske auf Doubles.
\\
Habe jetzt nochmal großzügig Maske gesetzt: Kombi aus 93 und 96 ging weit hoch, aueßrdem alles etwas verbreitert. Jetzt lasse ich nochmal durchlaufen.\\
ACHTUNG: Die Doubles mit $mpq > 3.3$ (also auch He1+!) landen in RNG2.


\DayInSep{Do}{26}
Hab jetzt viel rumgebastelt und eine eine Auswahl mithilfe mask2D getroffen, das geht viel einfacher. Ist nicht perfekt, aber bleibt erstmal so, ich muss weiter machen. (Ich habe immer noch nicht viele Doubles, denn: die sind für He1+ ja im Allg. in RNG2 und nicht in RNG0. Für He2+ und H+ liegen die nicht im ausgeschnittenen Schlauch.)\\
Wollte das mit dem Subset-Wegschreiben reparieren, also in \verb|Dist3D| immer auf die Mastermaske zugreifen, aber das geht nicht: \verb|d.add_data| funktioniert nämlich nur auf dem gesamten d und z.B. \verb|d.vspace| hat nur die Größe des maskierten Datensatzes (aus (guten) Speichergründen). Was solls, ich behalte das mit dem Subset einfach bei. Dann ist der unmarkierte Datensatz genau gleich dem Master-Datensatz.

\DayInSep{So}{29}
Ich will rausfinden, welcher Offset-Winkel jetzt richtig ist.
\begin{itemize}
	\item Achtung, vx, wx, ... -Datenprodukte werden jedes Mal geändert, wenn ich eine neue Dist3D mit anderem Winkel instanziere.
	\item Falschzuordnung würde folgendermaßen aussehen: \\
	Weil der Winkel tatsächlich ca. 180 Grad ist, ist der angesprochene Sektor für den SW-Bulk fast immer 4, das steht in den PHA-Daten. Wenn ich jetzt denke, dass der Winkel nur 90 Grad ist, bin ich bei Sektor 4 schon 90 Grad über die SW-Richtung hinweg. Da gibt es dann einen recht großen Anteil in y- und z-Geschwindigkeitskomponente, wenn ein Teilchen von dort käme. Wenn der AA jetzt in die andere Richtung zeigt, zeigt dieser Winkel in einer ganz anderen Richtung am Bulk vorbei. Im W-Spektrum ordne ich die SW-Teilchen dann also auf ganz utnerschiedliche Richtungen aus, d.h. der Bulk wird verschmiert bzw. es ergibt sich ein Ring (abh. von der Variation des AA). Wenn der AA lange konstant ist, ist der Bulk zwar relativ scharf, aber verschoben.\\
	Ich muss das mit großem AA testen, denn:
	\begin{itemize}
		\item Bei kleinem AA ist jeder Sektor Sonnenrichtung (unabhängig von Rotation)
		\item Bei kleinem AA sind die Sektorgrenzen so nah beineinander, dass der Bulk eh irgendwie auf allen landet.
	\end{itemize}
	Gut wäre es also, Zeiten zu finden, in denen der mittlere Detektor angesprochen wird.
	
	\todo[color=green!40]{AA Plot} Ich bräuchte mal einen ordentlichen Plot für den Verlauf des AA. Done: Funktion in \verb|DataLoader/pui_ulysses.py|
\end{itemize}
\todo{w} W\_he in Dist2D checken: Das gibts auch für He2+, aber scheint etwa dasselbe zu sein...? \\
Ich gehe jetzt über die vz und vy- Geschwindigkeiten, histogrammiere die und schaue, wie sehr die von 0 abweichen. 180 Grad scheint am besten zu sein. Was in mit den fehlenden 22.5 Grad? Und warum verändert sich das wspec mit Schnitten in x-Richtung?

\end{document}