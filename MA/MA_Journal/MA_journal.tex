\documentclass[11pt,letterpaper]{article}

\usepackage[utf8]{inputenc} % für Umlaute etc
\usepackage[ngerman]{babel} % nur damit funktionieren "` Anführungszeichen "'
\usepackage{hyperref} % für Links
\usepackage{enumitem} %for customising itemize, enumerate etc.
\usepackage{tikz} % for the date lines
\usetikzlibrary{calc} % for coordinate calculations of date lines
\usepackage{amsmath}
\usepackage[textsize=footnotesize]{todonotes} % selbsterklärend

\setlength{\marginparwidth}{3.5cm} % größerer Seitenrand für Todo-Notes


\newcommand{\heute}[3][April]{\textbf{#2 -- #3. #1}}

\newcommand{\DayInFeb}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Februar}};
}

\newcommand{\DayInApril}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\heute{#2}{#3}};
}


\newcommand{\DayInMay}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Mai}};
}

\newcommand{\DayInJune}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Juni}};
}

\newcommand{\DayInJuly}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Juli}};
}

\newcommand{\DayInAug}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. August}};
}

\newcommand{\DayInSep}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. September}};
}

\newcommand{\DayInOkt}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. Oktober}};
}

\newcommand{\DayInNov}[3][]{\vspace{2cm}%
	\noindent \tikz \draw [draw=black, ultra thick, #1]
	($(current page.center)-(0.5\linewidth,0)$) -- 
	($(current page.center)+(0.5\linewidth,0)$)
	node [midway, fill=white] {\textbf{#2 -- #3. November}};
}


%opening
\title{Master Journal}
\date{}
 
\begin{document}

\maketitle



\DayInApril{Di}{2}


Nur rumgebastelt:
\begin{itemize}
	\item Versehentlich Swics-Ordner gelöscht, wiederhergestellt.
	\item SVN durchsucht nach fehlendem libacepy.ancil:\\ \textit{svn+ssh://asterix/data/subversion/etph/swics/trunk/ionpositions/libacepy}\\
	Softlink gesetzt in Hauptverzeichnis: \textit{ln -s [path]}
	\item Numpy und Scipy aktualisiert: \textit{sudo pip install numpy upgrade}\\$\rightarrow$ Fehlermeldungen endlich weg
	\item Journal 'Osmo' runtergeladen, wieder verworfen, LibreOffice ausprobiert, verworfen, für Latex entschieden: An \href{https://www.overleaf.com/project/5ca382231c72a24e9afbfe17}{Diary-Template} orientiert
	\item Dazu: in \textit{newcommand} eingelesen, versucht aktuelles Datum ohne Update einzubauen, guten \href{https://tex.stackexchange.com/questions/156237/print-current-date-without-updating}{Beitrag} mit \href{https://cremeronline.com/LaTeX/minimaltikz.pdf}{tikz}-Package gefunden, 
\end{itemize}



\DayInApril{Mi}{03}
\begin{itemize}
	\item Versucht, \textit{itemize}-Listen anzupassen mit \href{ftp://ftp.fu-berlin.de/tex/CTAN/macros/latex/contrib/enumitem/enumitem.pdf}{\textit{enumitem}}-Package $\rightarrow$ zu zeitaufwändig, mach ich später. TODO
	\item außerdem TODO: Todo-command von Stefan/Finn raussuchen
	\item Jetzt weiß ich, warum ich Dist3D nicht weiter gecheckt habe: Funktioniert nicht ohne AspectAngle-Phi und -Theta und ohne Testen versteh ich nicht, was passiert. Ich muss also erstmal die Winkel einpflegen.
	\item TODO: Git aufsetzen (!!) und nochmal PyCharm checken
	\item Programmstruktur auf Papier gefunden. Yay, sehr hilfreich! \textit{ulysses\_traj.py} angefangen anzupassen an zusammengefasste Trajektoriendatei (traj\_data\_pool.dat).
	\item NEXT: Methode sync\_traj() in uswipha.py anpassen, am besten alte M. einfach umbenennen (als Backup) und eine neue schreiben.
\end{itemize}


\DayInApril{Do}{04}
\begin{itemize}
	\item Wollte schnell AA-Phi und AA-Theta einpflegen, da fällt mir auf: Die müssen ja noch brechnet werden aus den HG-Koordinaten. Die Funktion dafür gibts schon: \verb|calc_asp_angles()| aus \verb|ul_calc_traj.py|. Die braucht aber Erd-Koordinaten in HG-Koordinaten und die gibts noch nicht. Ich könnte die von der NASA-Seite holen, würde die aber lieber rechnerisch rausbekommen. Altes Problem rekapituliert: Erd-K. bekannt in HC: LAT immer Null, LONG unbekannt. In HG: LAT unbekannt, LONG berechenbar aus Ulysses-Datenprodukt.
	Ich brauche eine der unbekannten Größen! (Über Drehmatrix rückwärts rausrechnen: Geht nicht, weil ich keine kartesischen Koordinaten habe(?))
	Nächster Versuch: Über SPE, SEP, ESP. $\rightarrow$ Hilft nicht.
	Jetzt pflege ich Erddaten von der \href{https://omniweb.gsfc.nasa.gov/coho/helios/planet.html}{NASA} halt in \textit{ulysses\_traj} ein. Mal gucken, ob ichs rückwärts berechnen und damit verifizieren kann...
\end{itemize}

\DayInApril{Sa}{06}
\begin{itemize}
	\item Begonnen, die NASA-Daten einzuladen und die Winkel in RTN auszurechnen. Mit Testfunktion kommt leider nicht das Richtige raus. Fehlersuche.
	\item Fehlersuche ergab: Ich hatte den Long-Shift übermutig aus der Koord.-Trafo für die Erde rausgenommen. Muss aber natürlich drin bleiben, weil 
	ja auf RTN-Koord. des SC (dessen Daten mit dem Shift belastet sind) transformiert wird.
\end{itemize}

\DayInApril{So}{07}
\begin{itemize}
	\item Was für Daten sollen jetzt eigentlich synchronisiert werden mit sync\_traj()? RTN-Koordinates fürs SC sind ja nicht besonders aussagekräftig (weil Null in T und N). Ich nehme wahrscheinlich die verschiedenen AA's und HG-Koordinaten. Kann man ja schnell anpassen.
	\item Next: Das machen (Anpassung in \textit{ulysses\_traj}), dann \textit{Dist3D} damit aufrufen und gucken, was als nächstes fehlt.
\end{itemize}

\DayInApril{Di}{09}
\begin{itemize}
	\item AspectAngles werden geschluckt von \textit{Dist3D}. Nächstes Problem: Detektor-ID! $\rightarrow$ Achja. Ist ja schon drin in den Datenprodukten, als \textit{det}.
	Ich setze jetzt neues Dist3D speziell für Ulysses SWICS auf (Skript aus \textit{SWICS/trunk/ace\_dbd/} nach \textit{Ulysses/swics/software} kopieren).
	\item Next: Brauche passende getvelovity-Methode, dafür muss ich rausfinden, ob Ulysses/SWICS dieselben EpQ-Spannungssteps hat wie ACE/SWICS
\end{itemize}	

\DayInApril{Mi}{10}
\begin{itemize}
	\item Rausgefunden, in welcher Einheit Werte in \textit{getvelocity} sind: $\frac{keV}{e} = kV$!
	\item Entsprechendes Werteintervall nicht im SWICS-Paper gefunden. Im ACE-SWICS-Paper geguckt: Da steht zumindest der obere Wert von $100\,\mathrm{\frac{keV}{e}}$ (Main Channel). Die untere Grenze ist allerdings $0.49$ anstatt $0.61$ (in \textit{ancil.py}). Habe die Werte mal geplottet und in der logarithmierten Darstellung ist ein deutlicher Knick in der Geraden! Interessanterweise sind in dem Paper (TABLE1) auch zwei Werte für Step Size angegeben. Erstens macht eine Step Size ja nicht so viel Sinn, wenn die Steps logarithmisch verteilt sind. Also habe ich mir \textit{exp()} von den Differenzen angeguckt: Tatsächlich zwei konstante Werte! Aber statt $1.0744/1.0365$ bekomme ich $0.071$ und $0.144$. Hm...
\end{itemize}


\DayInApril{Mo}{15}
\begin{itemize}
	\item Mit Lars gesprochen. Die EpQ-Steps wurden aus den Housekeepingdaten von ACE ausgelesen. Und bei Ace sind sie in der Tat auf zwei verschiedenen Steigungen. Das ist bei Ulysses wahrscheinlich nicht so. Für U. (64 statt 60, aber kleinere Range) hat Thies schon damit gearbeitet, die muss es also irgendwo geben, Lars schaut mal nach. In den Raw- oder PHA-Daten haben wir sie nicht gefunden. Bis dahin nehme ich die Funktion von ACE als Dummywerte.
\end{itemize}

\DayInApril{Mi}{17}
\begin{itemize}
	\item Neuen Softlink (libacepy) gesetzt für Dist3D. Jetzt muss ich mit Dummy-GetVelocity() das Skript verstehen.
	\item D.vspace gibt an: \textit{welche Geschwindigkeitseigenschaften(Richtung, Betrag) muss ein Teilchen gehabt haben, damit es hier gemessen wurde?}
	\item Ich mauschel mich da durch, passe alles entsprechend an. Problem: Es gibt in \textit{d}s Datenprodukten (uswipha-Instanz) vier(!) Detektor-ID-Werte: 0,1,2,3. Ich erinnere mich vage, dass ich früher mal wusste, was das war. Muss ich rausfinden und abfangen, weil dist3D natürlich nur was mit drei Werten anfangen kann. \\
	Achso, abfangen klingt kompliziert: Einfach Maske setzen!
	\item Unterwegs (in der Kladde) gelvelocity()-Funktion für Ulysses gefunden! Yay! (\textit{/home/asterix/fischer/PUI/Ulysses/swics/software/libulpy/uswiuitils.py}) (Lars: Eigentlich noch ein Step mehr: 85 oder so. Aber der ist kaputt)
	\item Zum Detektor-ID-Problem habe ich nur was Knappes auf S.45/46 gefunden. Leider nicht das Endergebnis und Lars' Aussage zur damaligen Analyse. Ich suche jetzt das Skript, das die jeweiligen Plots erstellt, an denen wir damals was gesehen haben: 
	\item Angefangen, \textit{pui\_ulysses.py} durchzugehen. Polarplot() funktioniert nicht. Woher kommen die drei Masken? Muss ich nach Ostern weiter durchgucken...
\end{itemize}

\DayInApril{Mi}{24}
\begin{itemize}
	\item Aus Osterurlaub wieder da. Jetzt muss ich wirklich loslegen -- noch 3 Wochen bis zum Vortrag. 
	\item Einiges mal überflogen. Grobe Struktur: Alten Vortrag zusammenfassen: PUI $\rightarrow$ was erwarten wir für eine VDF? Echte VDF sieht aber anders aus. Erklärungen? Messfehler $\rightarrow$  Übergang SC-frame auf SW-frame bzw. (?) Übergang 1D auf 3D (diesen Zusammenhang muss ich mir klar machen!!). Dann fange ich an, Ulysses/SWICS zu erklären und was bisher mit der Trajektorie etc. gemacht wurde.
\end{itemize}

\DayInMay{Do}{02}
\begin{itemize}
	\item Rausgefunden, warum in polarplot() die Masken schon gesetzt waren: In diy$\rightarrow$ gibts das Skript load\_pui\_ulysses.py, das genau diese Masken setzt.
	\item Detektorproblem: Dort werden Detektoren 0,1,2 geladen, d.h. Nr. 3 ist evtl. der, der über ist?
	\item PATHPROB: Zum Ausführen von load\_pui\_ulysses.py muss ich uswipha.py laden, das füge ich dafür zum python-sys-Path hinzu. Dasselbe mit pui\_ulysses.py
	\item Habe jetzt endlich alle alten Sachen (AnimatePolarplot) zum Laufen bekommen. Evtl. könnte man die Animation auf Lars' Kollimator umbauen. Aber nur ganz evtl.
\end{itemize}

\DayInJune{Di}{04}
Dokument aufgesetzt, Bibdatei angelegt, Zusammenschrieb auch damit verbunden. Für Biblatex entschieden.
\begin{verbatim}
\usepackage[backend=biber,style=authoryear,maxbibnames=2,natbib=true]{biblatex}}
\end{verbatim} 
Dann mit citep (alles in Parenthesis) oder citet (im Fließtext) zitieren.\\ \\
Weiter: Infos von losen Zetteln in Zusammenschrieb schreiben.


\DayInJune{Mi}{12}
Python3 zusätzlich zu Python2 installiert (weil Max' Programm in Python3 geschrieben ist):
\begin{itemize}
	\item Python 2.7 und Python3 irgendwie vorhanden.
	\item \textit{sudo apt-get install python3-pip}
	\item Jetzt kann ich mit \textit{pip3} Python3 erreichen und mit \textit{pip2} Python2 (Nur \textit{pip} bezieht sich auch auf 3)
	\item Problem: \textit{ipython} öffnet immer ipython für Python2. \textit{pip3 install ipython
	} hat nicht geholfen.
	\item Sebastian hat geholfen: Ipython3 ganz normal installieren: \textit{sudo apt install ipython3
	}. Jetzt kann ich entweder \textit{ipython} oder \textit{ipython3} aufrufen! Jetzt noch alle Pakete mit \textit{pip3} installieren
\end{itemize}
Anderes:
\begin{itemize}
	\item pip immer nur lokal installieren, also ohne \textit{sudo}!
	\item TK: GUI-Programm in C++ geschrieben, für Python über Interface tkinter. Nicht über pip installierbar, denn pip soll nur pure Pyhton Pakete installieren. Also installieren mit \textit{sudo apt install python3-tk}
\end{itemize}


\DayInJuly{Fr}{12}
Bei Lars gemeldet. Er hat den Kollimator und Dist3D weiter eintwickelt.
\begin{itemize}
	\item Zeigt Ergebnisplot (das ist auch mein Ziel mit Ulysses), bei dem entlang der x-Richtung in die Verteilungskugel geguckt wird (schnittweise). Man erkennt innen was in der Mitte (Innere Quelle?) und außen die Schale!
	\item phasenraumgewichtet (wie oft habe ich überhaupt in eine Richtung geguckt, d.h., wie groß ist die Wahrscheinlichkeit, dass ich ein Teilchen hätte messen können?) und normiert (auf max)
	\item Das sind ACE-Daten, Langzeit, alle vsw. Ziel ist, wenn alles läuft, nach unterschiedlichen Magnetfeldkonfigurationen und vsw zu filtern und evtl. Unterschiede zu finden.
	\item Bsp: Bfeld einschränken auf theta: kP und phi: $-90\,^\circ$ bis $-70^\circ$ und $90\,^\circ$ bis $110^\circ$. Zeichnung s. Kladde S. 83. Erwartung wird irgendwie nicht richtig erfüllt. Filter auf kleine vsw: schon eher.
	\item Evtl. gibt es noch ein Problem mit dem Aspect Angle, denn die Population ist manchmal wohl auf der falschen Seite (nämlich links)
	\item das sind 12-min-Daten. Eigentlich müsste man Minutendaten nehmen, denn: Gyroperiode der Teilchen ist etwa eine Minute. Alle Änderungen des B-Feldes, die auf kürzeren Zeitskalen stattfinden: PA-Bestimmung nicht sinnvoll, weil keine volle Gyrobahn. Deutlich längere Zeitskalen: auch nicht sinnvoll, weil Verteilung mitdreht (?)
\end{itemize}
Zu den Daten:
\begin{itemize}
\item Etwas veränderte Ordnerstruktur. Ich muss neu auschecken: \\ \textit{svn+ssh://asterix/data/subversion/etph/ACE} (Instrumentelles, die Dist3D die hier liegt ist eine alte Version) bzw. \textit{.../etph/PUIs} (datenspezifisches, neuere Dist3D, die zu PUIs passt)
\item ACE-Datensatz zu Probieren auf \textit{data/etph/berger/mq...} \\ Dort liegen HE+-gefilterte Daten aus 12 Jahren. Ich muss zusätzlich wHE einschränken auf 0.9 bis 10 (das ist w ganz einfach in 1D, Lars hat auch gezeigt, wie das in 3D abgebildet wird, Todo: überlegen!) und eine Maske von Hand legen (s. Zeichnung Kladde S. 83)
\item Datensatz umfasst ca 800000 PHAs+. Nach Maskierung sollten etwa 400000 übrig bleiben.
\item Pi mal Daumen ist das eine Messung pro 12-Minuten-Zyklus! (120 Cycles pro Tag mal 365 Tage mal 10 Jahre = 400000 Cycles)
\item $\rightarrow$ Wir können nur nach Signaturen suchen, die sich langzeitmäßig oder regelmäßig ändern. Aussagen von Zyklus zu Zyklus sind überhaupt nicht sinnvoll!
\item Dist3D nimmt neue Parameter:
\begin{itemize}
	\item nrs\_perp ist Anzahl der Punkte an der kurzen Seite (da reicht eigentlich einer, denn die Breite ist klein gegen den Sektorsweep! Wäre nur praktisch, wenn man eine hübsche Abbildung vom Kollimator machen will)
	\item nrs\_perp: 3
	\item nrs\_sec: wie viele Steps in einem 45-Grad-Step
	\item nrs\_epq: wie viele Einzelsteps innerhalb der Breite eines EpQ-Steps (nominelles Geschwindigkeitintervall)
\end{itemize}
	\item Lars' Rechner kam mit nrs\_epq = 3 schon an seine Grenzen. Das liegt an calc\_w, weil da noch eine zusätzliche Dimension (Sonnenwindgeschwindigkeiten) dazu kommt. Das will er jetzt umbauen.
\end{itemize}
Weiter: Neu auschecken, Kopien anlegen und alles zum Laufen bekommen



\DayInJuly{Do}{18}
\begin{itemize}
	\item SWICS\_collimator durchgeschaut, alles verstanden
	\item Jetzt Dist3D durchgucken. Zum Laden von Lars' Probedatensatz: .../PUIs/ace\_swics\_3d.py
\end{itemize}

\DayInJuly{Do}{18}
\begin{itemize}
		\item Nachtrag zur Pip2-Installation (pycwt): \\ \textit{pip install --user pycwt}
\end{itemize}

\DayInJuly{Do}{25}
\begin{itemize}
	\item Nils: Schnell mal was plotten:\\
	\verb|figure(),plot(d.data["swt"])| \\
	Histogrammieren: \\
	\verb|figure(),hist(d.data["swt"],arange(0,300,1))|
	\item Bin bei Funktion \verb|def _calc_phspeff_wgt(self):|.\\ \todo{todo} Phasenraumvolumen nicht verstanden. Warum komme ich mit Integration nicht auf dasselbe Ergebnis, warum ist es nicht egal, welchen Winkel ich als welche Integrationsvariable nehme...?
	\item \todo{Geometriefaktor \ldots} Geometriefaktor auch nicht verstanden. Sullivan-Paper: woher kommt der Kosinus? 
\end{itemize}

\DayInJuly{Fr}{26}
\begin{itemize}
	\item \verb|_calc_sw_bulk_propoperties()| nicht gecheckt, warum passiert das da mit der Alfven-Geschwindigkeit und warum findet man das nirgendwo? \todo{Alfvengeschwindigkeit} Evtl. bei Marsch nachlesen...? \\
	Allerdings ist die Funktion auch nicht so wichtig atm, glaube ich, wird nicht benutzt?
\end{itemize}
\textbf{Lars:}
\begin{itemize}
	\item Datenprodukte ACE: \\ 
	\textit{dsw} -- Sonnenwinddichte \\
	\textit{tsw} -- Temperatur Sonnenwind \\
	\textit{swt} -- sector weight, ähnlich wie Base Weight Rate. Erklärung im Zusammenschrieb 
	\item Funktionenwald in \verb|dist3D_pui|: Die aktuelle, wichtige ist \verb|calc_w3dspecs|! Die funktioniert auch!
	\begin{itemize}
		\item Erklärung in 3 Schritten:
		\item Unten ganz normal histogrammieren mit diversen Weights
		\item twts: ? (wgts*swgt)
		\item Loops darüber: Wie oft habe ich in eine Richtung geguckt. Um den Dichtegang rauszunehmen, der daraus resultiert, dass man häufig entlang der Radialen guckt und zu zeigen, dass darunter ein ähnlicher Dichtegang liegt, der nichts damit zu tun hat
		\item zurückgegeben werden dann \verb|norm_arr| (proportional zur absoluten Messzeit, "`wie oft hat das Instrument in eine Richtung geguckt"'; Erwartung: häufig entlang der Spinachse, also radial) und Histogramm ungewichtet.
		\item Plot erzeugen: \\
		\verb|norm_arr[norm_arr==0]=1.| Null-Werte auf 1 setzen (warum?) \\
		\verb|H2 = H/norm_arr| Normierung durchführen \\
		\verb|wbins = arange(-2.-2.01.0.2)| \\
		\verb|pcolormesh(wbins,wbins,H2[10,:,:].T)| 10. Slice. Bei 11 geht man weiter nach vorne usw... (\todo[color=green!40]{Slices} rausfinden, in welche Richtung -- DONE s. Anfang September)
	\end{itemize}
	\item Die anderen eher sekundär (funktionieren auch nicht, weil die noch auf einem anderen Kollimator arbeiten?): Da hat L. nur mal schnell was ausprobiert oder der Versuch bzw. das auf 1D runterzubrechen (\verb|calc_wpecs2()|) oder für jedes w die PA-Verteilung zu zeigen (\verb|calc_muspec()|)
	\item Plan: Quick and Dirty für Ulysses umschreiben, solange Lars im Urlaub ist. Lars denkt, dass fast nur der Sec0-Versatz zum Sunpulse-Analyser geändert werden muss. Hiefür soll ich diesen Versatz als variabel lassen, sodass man den übergeben kann bei Funktionsaufruf und ein bisschen ausprobieren kann. Man erwartet den Protonen-Bulk (Bereich ziemlich starke Intensität) relativ radial. Auf dem Wege kann man schon einiges ausschließen. Das kann ich auch schon ohne die Gewichtung sehen.
\end{itemize}

\DayInJuly{Mi}{31}
\begin{itemize}
	\item Habe jetzt Dist3D für ACE durchgeguckt und das meiste gecheckt.
	\item Umbau für Ulysses. \todo[color=green!40]{Ordnerstruktur} Neue Ordnerstruktur. Bisher liegt alles in \verb|old_stuff|.
	\item Muss ich an \verb|swics_collimator| was ändern?
\end{itemize}

\DayInAug{Do}{1}
\verb|swics_collimator| durchgeguckt. Liegt inzwischen als \verb|swics_collimator_ulysses.py| in \verb|./PUI/Ulysses|.
\begin{itemize}
	\item Rausgefunden, dass das Umbrechen der Zeilen \textit{Wrapping} heißt und es geschafft, das nachträglich in Pycharm für die Kommentare zu machen: File -- Settings -- Code Style -- \textit{Hard wrap} einstellen und \textit{Wrap on typing} ankreuzen. Außerdem unter Code Style -- Python -- Wrapping and Braces --\textit{Ensure right margin...} ankreuzen. Außerdem hat Edit -- Fill Paragraph geholfen. \\
	Danach reformatieren!
	\item In der Kollimatorklasse habe ich eigentlich nur die Dokumentation angepasst und ein paar Checks gemacht. Das KS ist bei ACE ja anders (GSE) als bei Ulysses (RTN), aber das ist ja schon bei der Berechnung des AA mit eingeflossen.
	\item
	\verb|offset_sp| ist jetzt der variable Versatz zwischen Sunpulse-Sensor-Guckrichtung und SWICS Z-Achse. (Bei ACE sind das 135 Grad.)
\end{itemize}
Jetzt geht es an \verb|Dist3D|.
\begin{itemize}
	\item Datenloader uswipha zum Laufen bringen: Daten wurden von \verb|/data/etph/...| nach \verb|/data/projects/...| verschoben. Die Lösung kann so einfach sein.
	\item \verb|swics_collimator_ulysses| muss schon ein FieldOfView zum Kollimator zufügen!
	\item Changes:
	\begin{itemize}
		\item \textit{did} $\rightarrow$ \textit{det}. \todo[color=green!40]{Det-ID} Welchen Detektor muss ich jetzt nochmal rausschmeißen? Beobachtungen auf 3 Jahren Daten (1993,94,95):
		\begin{itemize}
			\item Det3 wird kaum angesprochen! (von 43 Mio PHAs nur 1225 auf Det3)
			\item Wenn ich nur Ech unter Threshold nehme (26 Mio; = Doubles), landen fast alle in Det0. (Det1: 26, Det2: 88, Det3: 164)
			\item $\rightarrow$ Ich würde denken, dass Det3 einfach Müll ist.
			\item Das passt auch zum Kommentar vom 2.Mai. D.h., ich muss eine Maske setzen, bevor ich in Dist2D reingehe. \todo[color=green!40]{Doubles} Soll ich eigentlich auch Doubles benutzen, macht das Sinn? DONE: Lars: Nein, die bringen uns nichts, weil die keine Detektorinfo tragen (natürlich...)
		\end{itemize}
	\end{itemize}
\end{itemize}
Morgen: Schauen, ob ich \verb|pui_ulysses| benutzen kann. Sonst anderes Main-Programm bauen (Daten laden, Masken setzen, ...).


\DayInAug{Fr}{2}
\begin{itemize}
	\item Pycharm-Problem vorab: Ich kann den Debugger irgendwie nicht bei meiner momentanen Datenstruktur verwende. Er findet die ganzen Pakete nicht...
	\item Weiter Veränderungen in Dist3D:
	\begin{itemize}
		\item Das Skript heißt \verb|load_pui_ulysses|. Benutze ich jetzt.
		\item Funktion \verb|getvelocity_allsteps| zum Umrechnen von EpQ-Steps in echte Energien pro Ladung bzw. in Geschwindigkeiten: s. Kommentar vom 15.04. Ist bei Ulysses SW eine andere als bei ACE. \todo[color=green!40]{getvelocity} Die richtigen Werte müssen wir noch raussuchen. Ich benutze jetzt erstmal die ACE-Funktion. Später muss dann auch die Anzahl der Steps angepasst werden! DONE: s. 28.8.
		\item \todo[color=green!40]{Delta EpQ} Ist Delta EpQ dasselbe, 3\%? DONE: Ist 5\%, s. Gloeckler. $\Delta v$ sind dann 2.5\%, s. Kladde S. 84.
		\item \todo[color=green!40]{Geomfak}Geometriefaktor ist wahrscheinlich derselbe, oder? DONE: Joa
		\item \todo[color=green!40]{Eigengeschwindigkeit} In \verb|_calc_vspace_| wird bei ACE die Eigengeschwindigkeit nur in der y-Komponente abgezogen. Das muss bei Ulysses aber ja nicht so sein (?). DONE: Nein, geregelt.
		\item Ich bin gerade verwirrt von den Koordinatensystemen. GSE hat x-Achse ja vom SC zur Sonne positiv und später wird das umgedreht, damit der SW grob aus positiver Richtung kommt. RTN eigentlich andersrum. Soll ich das so beibehalten? Dann muss ich nochmal zurück zum Kollimator. Denn das FOV ist dann ja in negativer R-Richtung. \\ Ich hab jetzt erst einmal das RTN umgedreht (also eigentlich nur die Konvention in die Kommentare geschrieben), jetzt ist alles so wie beim GSE. Es ist ein bisschen inkonsistent, dass ich den AA ab der negativen R-Achse berechne (aber das habe ich irgendwie ja immer schon so gemacht. Jetzt auch in der \verb|calc_asp_angles|-Funktion deutlich kommentiert). Jetzt tue ich halt so, als wär das die positive Achse, dann muss ich nichts ändern bei FoV. \todo[color=green!40]{Koordinatensystem} Aber vielleicht wird das problematisch, wenn ich die Eigengeschwindigkeit einrechne, die ja evtl. in normalen RTN-Komponenten angegeben wird? DONE: Hoffentlich richtig gemacht
		\item In \verb|_add_3Dv| musste ich nochmal Datenproduktnamen ändern, außerdem \textit{det DCR to det 0} rausnehmen. Bei ACE gibts es offensichtlich $det = 7 $- Zuweisungen. \\
		Außerdem geht der EpQ-Step über 60 hinaus. Das crasht, weil ja die getvelocity von ACE mit 60 Steps benutzt wird. Ich wollte Daten erstmal einfach vormaskieren, bekomme das aber nicht hin. Bei der Übergabe von \verb|d| wird die Mastermaske ignoriert! Ich suche quasi die subset-Funktion aus dbData -- nur "`live"', also ohne Wegschreiben.
	\end{itemize}
\end{itemize}

\DayInAug{Di}{6}
\begin{itemize}
	\item Bin jetzt den Umweg gegangen über \verb|save_subset| und \verb|load_subset|. Damit schreibe ich ein Subset von den gefilterten Daten (Det von 0 bis 2 und epq von 0 bis 59) in eine Binärdatei und lese sie wieder ein...
	\todo[color=green!40]{Subset} Da muss es aber doch noch einen anderen Weg geben? \\
	Nachtrag: Ich habe EpQ schließlich von 1 bis 58 gefiltert, weil die ACE-Daten auch so vorliegen. 0-59 hat für \verb|get_velocities| funktioniert, aber nicht fürs Synchronisieren der Efficiencies.
	\item \todo[color=green!40]{Efficiencies} Efficiencies soll ich ja erstmal von ACE nehmen. Da die nur für die Triples gelten (?) filtere ich die Doubles jetzt auch mal raus: \\ \verb|d.set_mask('Master','ech',12,120,reset=True)| \\ DONE: 05.09.
	\item Für Ulysses gibt es das Datenprodukt \textit{swt}, das Sectorweight, nicht. \todo[color=green!40]{Sectorweight} Lars fragen bzw. selbst nachgucken, evtl. wird das nur über uswipha nicht eingeladen. Bis dahin setzte ich alle Gewichte auf 1 (in \verb|calc_w3dspecs)|). DONE
	\item Es läuft durch!! Ich kann das Spektrum erzeugen!! Jetzt mal mehr Daten einladen...
	\item Ständig Memory Error... \\ 200 Tage sind das Maximum.
	\item Überlegung, warum jedes PHA-Wort überhaupt 9 FoV-Punkte hat: Weil man nicht weiß, wo der Sektor getroffen wurde. Punkt 0 hat z.B. eine ganz andere w-Signatur als Punkt 5. Alle Möglichkeiten müssen betrachtet werden.\\
	Aber: Macht eine w-Auflösung von 0.2 überhaupt Sinn?\\
	Die größte Differenz im Betrag von w haben immer der erste und der letzte Eintrag. \\
	Differenzen werden kleiner für größere EpQ-Steps. Stimmt nicht ganz: Peaken bei einem mittleren EpQ-Step (abh. von vsw)\\
	WARUM verändern sich die Differenzen für verschiedene Sektoren bei keinem AA?? $\rightarrow$ Weil irgendwie der AA doch nicht Null ist. Was geht da schief?\\
	ToDo für morgen: \begin{itemize}
		\item Methode basteln, um schnell irgendwelche Sachen zu plotten, z.B. wSpace. Das ist ja nicht mehr wirklich eine Sache in SwicsCollimator, weil ich mir ja mehrere Kollimatoren angucke.
		\item Methode schreiben, mit der ich durch die pcolormesh-Dinger loopen kann, um mir ein besseres Bild zu machen.
		\item Variablen SP-Offset durchführen und das verstehen.
		\item Oben weiter machen: Wollte eig. nur sicher gehen, dass sich die Diff mit den Sektoren nicht ändern und mit den Detektoren schon! (Tut es das dann?)
	\end{itemize}
\end{itemize}


\DayInAug{Di}{26}
Habe jetzt nach langer Pause nochmal neu angefangen, Dist3D durchzugucken.
\begin{itemize}
	\item \verb|calc_w3dspecs()|: 
	\begin{itemize}
		\item Was ist mit \textit{d00}? Ich habe nur \textit{d90}. \todo[color=green!40]{d90, d00} Ist das egal? Hab das jetzt erstmal einfach auf \textit{d90} geändert. Ich frage mich, wie das vorher durchlief...? DONE: Wird weiter oben erzeugt
		
		\item Warum suche ich eigentlich nur eine Kombi pro Tag? Warum histogrammiere ich nicht alle vorkommenden Kombis? \\ $\Rightarrow$ Verstanden: Das sind nur die Bingrenzen. Warum die gerade so gewählt werden, ist aber irgendwie trotzdem random? (Anne, das stimmte nicht)\\
		AH! Alles falsch! Ich nehme die Uniquewerte, weil ich zum selben Zeitpunkt mehrere Messwerte habe. Ich will aber nur jeden Zeitpunkt einmal! Die Bingrenzen habe ich als Argument mitgegeben.
		
		\item \todo[color=green!40]{ivoffset} Wozu ivoffset? Done: Synchronisiert die Indizes, steht auf Blatt im Ordner)
	\end{itemize}
\item Ich verstehe immer noch nicht so ganz, was ich da oben genau verstehen wollte -- warum soll sich die w-Diff. wann ändern?\\
Aber kann es sein, dass ich die ersten Einträge beim AA genommen habe und das gar nicht 0 war, sondern eben der kleinste in diesem Zeitraum gemessene...?
\end{itemize}


\DayInAug{Mi}{27}
\begin{itemize}
	\item \textit{d00} wird oben berechnet! (in der \verb|init| von Dist3D)
	\item Verwirrung: Warum sind die Werte des wspace (Betrag) \textit{immer} unterschiedlich? Bei der Konstruktion werden die doch auf 1 normiert und dann mit \textit{einer} Akzeptanzgeschwindigkeit malgenommen...(alle Sektoren, alle Detektoren)? \\
	Gecheckt: FoV vom Collimator hat immer den Betrag 1 im Betrag. \\
	Gecheckt: Bleibt auch so für verschiedene AA (in Dist3D) \\
	Lösung gefunden: Die Unterschiede kommen rein, wenn man die Eigengeschwindigkeit betrachtet! \\
	...Und natürlich, wenn man beim Umwandeln in w die SW-Geschwindigkeit nur in x-Richtung abzieht. Das ist ja dasselbe Problem, die Beträge SIND dann halt nicht mehr gleich. (Und das ist auch der Fall, wenn keine Eigengeschwindigkeit mit reinkommt!)	
\end{itemize}
Abschließend habe ich festgestellt, haha, dass die w-Werte für Detektorpunkte innerhalb einer Det-Sek-Kombi in allen(?) Fällen eine maximale Differenz unter 0.5 haben (Details: Die max. Differenz liegt bei mittleren EpQ, rutscht mit größeren vsw etwas weiter zu kleineren EpQ-Steps (evtl. mal überlegen, warum...), ändert sich vom Wert aber kaum).\\
Damit schließe ich das Thema erstmal ab, wird bestimmt bei der Fehlerbetrachtung interessant... (Da muss man dann auch die Breite im EpQ-Step und die Variabilität ineinem einzigen Step betrachten)\\ Jetzt erst gesehen: Lars' w-Bins sind aber nur 0.2 breit... (\verb|nrs_sec|))\\ \\
Jetzt: Sunpulser-Angle variabel übergebbar einbauen. hatte ich schon gemacht. \\
Morgen: prüfen, warum das w-Spektrum nicht einfach gedreht ist, sondern komplett anders aussieht mit unterschiedlichen SP-Offset-Angles.

\DayInAug{Do}{29}
Kurze Funktion geschrieben, um das Plotten des w-Spektrums zu automatisieren. \\ \\
To Do: \\
\todo[color=green!40]{colorbar} Colorbar und passende Range. Wie beim Polarplot muss ich überlegen, ob ich auf einzelnen Steps oder auf alle Werte normieren möchte. \\
\todo[color=green!40]{Durchklicken} Animierte Funktion schreiben, mit der ich durch die Slices klicken kann. Duncan gefragt: Stichwort \textit{ClickEvent}, Figure damit verbinden. Minimalbeispiel suchen: \textit{mpl.canvas.connect}. Nur machen, wenn das einigermaßen schnell geht...
\\ \\
Fehlersuche, warum offsetSP das Spektrum nicht nur dreht, sondern insgesamt verändert (habe einheitliche viridis-colormap. Die Range ist auch ganz unterschiedlich...):
\begin{itemize}
	\item Test mit offset 135 Grad und 45 Grad (90 Grad Versatz)
	\item v-Space ist einfach gedreht um 2 Sektoren. W-Space auch.
	\item Die den PHA-Worten zugeordneten v- und w-Werte unterscheiden sich, auch wenn man ein Wort mit dem entsprechenden sektor sucht: Denn dann ist ja der EpQ-Step, Detektor etc. anders.
	\item Überlegung: Sollte sich das über viele Daten nicht trotzdem ausgleichen und in etwa ähnlich aussehen? (Ich glaube bei 200 Tagen sieht man es scho etwas!)
	\item Und wie beeinflussen die Anzahlen der verschiedenen Steps (para,perp,epq,sec) das ganze? Test:
	\begin{itemize}
		\item Nur wenige (20) Tage einladen, damit ich mit der Anzahl hochgehen kann
		\item Am meisten Einfluss haben nrs\_perp und nrs\_para, die \textit{weichen} das Spektrum etwas auf.
	\end{itemize}
\end{itemize}

Wollte mir überlegen, wie das Spekturm bei einem falschen Offset aussähe, keine Ahnung. Wollte mir das angucken für verschiedene Offsets. Dafür die Maske wegnehmen, die auf He+ einschränkt. Das funktioniert irgendwie nicht. Das Quadmesh aus der Plotfunkton sieht immer gleich aus. Morgen untersuchen. \\
Außerdem: Kann es sein, dass ich das falsche w\_He einschränke?


\DayInAug{Fr}{28}
\begin{itemize}
	\item w\_He1+2 ist ein Datenprodukt, das in Dist3D zugefügt wird. Das sollte gleich sein mit dem wHe, das sowieso schon in den Ulysses-Daten ist -- allerdings erst dann, wenn die richtigen EpQ-Umsetzungen da sind. D.h., man könnte die evtl. finden, wenn man guckt, womit wHe auf der uswipha-Ebene berechnet wurde.
	\item Habs gefunden, in uswiutils. \verb|getvelocity|-Funktion angepasst, Steps angepasst (64 bei Ulysses), aber EpQ-Filter muss trotzdem auf 58 Steps bleiben, \todo[color=green!40]{efficiencies} weil immer noch die Efficiencies und die Sektorgewichte fehlen. Delta v / self.vels auch angepasst. Alles DONE
	\item Jetzt: Loopfunktion schreiben
	\item Schon fertig, das hat super geklappt! Ich habe das Spektrum zum Plotten in eine Klasse (WSpec) ausgelagert. Man kann jetzt durchslicen und auch drehen (auf Tastendruck oder über Funktion). Als nächstes möchte ich eine gute Anzeige, die angibt, wo ich gerade bin -- vielleicht auch eine entsprechende Skizze...? Die Colorbar vielleicht auch noch anpassen, damit man mehr sieht und Funktion, auf einzelnen Slice zu normieren...?
\end{itemize}

\DayInSep{Mo}{2}
\todo[color=green!40]{Trafo w-Spec} Irgendwie scheinen mir die Schnitte komisch. Nochmal checken, wie ich transformieren muss.\\
DONE:
\begin{itemize}
	\item Wenn z mit in der Ebene: transformieren (weil die \textit{letzte} Dimension von pcolormesh standardmäßig auf die x-Achse geplottet wird. Das liegt einfach daran, in welchem Format der geslicte Arary vorliegt.)
	\item Wenn y mit in der Ebene: x-Achse umdrehen (damit wir in positiver x-Richtung gucken)
	\item Die Ebenen sind jetzt:
	\begin{itemize}
		\item x-Schnitt: oben pos. z, rechts neg. y, Blickrichtung von Sonne zu SC
		\item y-Schnitt: oben pos. z, rechts pos. x. Blickrichtung: rechts geht zum CS, links zur Sonne
		\item x-Schnitt: oben pos. x, rechts neg. y, Blick von oben auf die Ekliptik
	\end{itemize} 
\end{itemize}
Textfeld/Annotation unabhänhig von Axes (relevant, wenn man Axes z.B. umdreht): \verb|ax.text(..., transform = self.ax.transAxes)| \\
Colorbar-Range updaten: Mit \verb|update_bruteforce|.\\
Aha.haha. Habe in sämtlichen Funktionen vergessen, durch den norm-Array zu teilen.\\
Ändert das was? Sind da immer noch komische Signaturen? He ausschneiden, Offset testen, Lars dazu holen. SW rausfiltern, Unterschied min\_wHe angucken


\DayInSep{Di}{3}
Range weiter angepasst: Jetzt immer scientific Notation. \\ Color\_norm 'all' macht echt nur Sinn, wenn man gaaanz wenige Tage einlädt, sonst ist die Range zu groß und man sieht nichts.

\DayInSep{Mi}{4}
Hatte ein Problem, auf dbData ein Histogramm zu erstellen. Problem gelöst: Colormap \textit{spectral} wurde in meiner Matplotlib-Version abgeschafft. Ich glaube, \textit{nipy\_spectral} sieht ähnlich aus. \textit{Spectral} ist pastelliger und mit weniger Range. Sollte Lars davon berichten. Habe im Skript \verb|_dbData.py| in der Klasse \verb|plot_properties| die \textit{contourcolor} geändert. Jetzt läufts.
\\ \\
Besprechung Lars:
\begin{itemize}
	\item Problem Subset: Eigentlich arbeitet Dist3D ja nur auf d, d.h. die Masken sollte alle bleiben. Wird wahrscheinlich nur überschrieben/resettet in Dist3D. \\ \todo[color=green!40]{Masken anpassen} checken $\Rightarrow$ verstanden, s. nächster Tag. Ist erstmal egal.
	\item \todo[color=green!40]{efficiencies} Efficiencies: Gibt es nicht direkt für Ulysses. Da kann ich mit den ACE-Werten vergleichen und dazwischen interpolieren -- denn es geht nur um den groben Gang, wenn man EpQ-Steps an verschiedenen Enden vergleichen will
	\item \todo[color=green!40]{sector weights} Sektorgewichte: Gibt es wahrscheinlich nicht in den Ulysses-Daten. Base Rate Weights nehmen, die sind halt dasselbe, nur über einen gesamten Spin gemittelt. ($\Rightarrow$ Informationsverlust, denn es ist ja schon interessant zu wissen, ob in Sektor 1 20 Teilchen gemessen wurden oder über alle verteilt...(?)) \\ BRW sind wahrscheinlich bei meinem He-Subset immer 1, weil da eh nicht viel gemessen wurde... \\
	DONE: einfaches BRW als Sectorweight übergeben. \todo[color=green!40]{brw} Später aber nochmal gucken, wie oft das nicht 1 ist. Done: 1995 und 1996 nur ganz, ganz wenige (wenigr als 1 Prozent).
	\item \todo[color=green!40]{w statt Slice} Im 3D-Schnitt w in der Ecke angeben statt dem Slice\\DONE: vmin ist jetzt der kleinste Wert nach 0, sowohl für \textit{color\_norm = all} als auch \textit{color\_norm = sg} fürs gesamte H-Array.
	\item \todo[color=green!40]{Colormap Range} Wo kein Count ist weiß machen: \textit{v\_under}, white, vmin... DONE
	\item Sunpulse-Offset: \\ \\Zum Backward-Engineering: SW ausschneiden in 5-min-Intervallen und dann det-sec Histogramm erstellen. Da sollte man gut erkennen, was aufleuchtet.\\ \\ Robert Frage für Rudi (?) schicken.\\ \\
	Lars hat was im DPU gefunden. \todo{Testen Offset} 180 Grad $\pm$ 45 Grad...?
	\item \todo[color=green!40]{Eigengeschwindigkeit} Bestimmung, indem ich Ableitung zwischen zwei Koordinatenangaben bestimme ($\Delta V$ // $\Delta t$) $\Rightarrow$ Gibt dann vx,vy und vz grob an. Mit in die Trajektoriendateien schreiben. Done, ewig am Einarbeiten in die PHAs gebastelt.
	\item Leider läuft He schnell in den Threshold mit höheren ESA-Steps (dann nur noch als Doubles). Robert: Da wurden andere, ältere SSDs verwendet als bei ACE oder bei PLASTIC: Goldschicht mit ziemlich hoher Totschicht. \todo[color=green!40]{ECH-Grenze} Diesen Threshold nochmal prüfen! Denn He liegt weit unten, nicht versehentlich wichtige PHAs wegschneiden. \\	 
	D.h., dass wir uns nur die äußeren Schalen und nur den schnellen SW angucken können (bzw. die Schnitte, die mittig zu entsprechend großen ws gehören...?) $\Rightarrow$ Klar, denn kleinere Geschwindigkeit heißt kleinere Energie und He hat kleine Masse. \todo{warum?} Dafür haben wir da auch keinen störenden Hintergrund.
	\item He+ rausfiltern:
	\begin{itemize}
		\item erste Überlegung: Mit mpq-Algorithmus He sauber auf 4 abbilden (?). Dann liegen da noch ein paar andere drüber (oben rechts in EpQ vs ToF), die man über E vs ToF rausfiltern kann\\
		Drüber nachdenken, aber es geht viel einfacher:
		\\ \todo[color=green!40]{He ausschneiden und wegschreiben} (Wie schreibe ich PHA-Worte weg? Wie liegen die eigentlich vor...?) DONE: Einfache txt-Files...
		\item Range: In RNG0 sind He und Protonen, in RNG1 schwerere Ionen. Die Boxen sind einfache Rechtecke in m, mpq und dann in ToF vs EpQ Dreieck/Schlauch. D.h. als erstes nur RNG0 maskieren.
		\item Dann eine \textit{wandernde Box} in E-vs-ToF-Darstellung (animate) legen: Evtl. per Mouseclick-Tracker: Bei welcher ToF ist der He-Bulk beim jeweiligen EpQ-Step? Wenn das PHA in einer Box innerhalb $\pm$ Kanäle liegt: PHA wegschreiben, dann habe ich mein Set, auf dem ich arbeiten kann und man braucht keinen komplizierten mpq-Algorithmus. In der senkrechten kann ich das genauso mitfiltern, aber bei unseren 50 Tagen lag da bei rng0 eigentlich auch nichts. \\ Super, dass das so sauber ist!
	\end{itemize}
	\item Doubles sind für uns nicht interessant, weil es für die keine Detektorinfo gibt $\rightarrow$ keine 3D-Auflösung
	\item Geometriefaktor ist im Prinzip nur vom Instrument abhängig, soll ich also von ACE übernehmen
	\item Robert hat DPU geschickt. \todo[color=green!40]{DPU} Mal reingucken
\end{itemize}

\DayInSep{Do}{5}
Heute: Nach und nach die Todos von gestern abarbeiten:
\begin{itemize}
	\item Für die Effizienzen kurzes Skript geschrieben (\verb|guess_ul_eff.py|), das eine Funktion an die ACE-Effizienzen fittet und den Ulysses-EpQ-Werten passende Werte zuordnet, weggeschrieben in \verb|He1+.eff|, z.Zt. im Hauptskriptordner
	\item Subset-Mastermaskenproblem verstanden: An vielen Stellen werden die Daten aus d geholt ohne die Mastermaske aufzurufen. Das sind dann \textit{alle} Daten. Mit dem Subset bin ich das umgangen, weil \textit{alle} Daten dann das Subset waren. Vielleicht frage ich Lars nochmal. Ich ändere das jetzt erstmal nicht alles um, sodass die Daten der Mastermaske genommen werden, weil das ganz schön viel ist. Vielleicht brauche ich das eh nicht mehr, wenn ich mir mein He-Subset weggeschrieben habe. Bis dahin mache ich das weiter mit dem künstlichen Subset.
\end{itemize}

\DayInSep{Fr}{6}
Probleme beim BRW gelöst: Nuller wegmaskiert.\\Probleme bei den Efficiencies: angehängte 0 für ACE übersehen, jetzt passts. \\ \\
Eigengeschwindigkeit: Lars meinte, ich soll die Differenzenquotienten zwischen zwei Trajektorienpunkten bilden und das mit in die Trajektorienfiles schreiben. Ich brauche die Geschwindigkeit ja in RTN-Koordinaten. Die Trajektorienfiles liegen ja aber gar nicht in RTN vor. Könnte ich v in HG-Koord. berechnen und dann genauso transformieren?


\DayInSep{Mo}{9}
Ich wandele jetzt beide Positionen von HG sphärisch in RTN kartesisch um und subtrahiere 2-1. In die Liste schreibe ich dann vx, vy, vz und den Betrag. \\ \\Habe den Betrag mit v aus \textit{ulysses\_daily\_heliocentric...dat} verglichen: Immer leichte Abweichung. Lars meint, da soll ich mir keine Gedanken drüber machen -- Rundung etc... \\ Hauptsachen, das SC durchläuft dieselbe Geschwindigkeit wieder im nächsten Orbit. \\
Komische Werte Ende 2001 gefunden: Da stehen für ca. 20 Tage nur Nullen in \textit{helio.dat}. \todo[color=green!40]{Werte helio.dat} Die sollte ich mal interpolieren, vielleicht kann ich die auch exakt berechnen aus HC...? \\
Done: Dafür habe ich ja eine Funktion, klappt super. Habe jetzt \verb|fill_up_gap()| und \verb|calc_velocities()| in \verb|traj_pooled| geschrieben -- dort wird die neue kompakte Trajektorienliste geschrieben. Die tatsächlichen etwas komplexeren Funktionen dazu stehe jetzt alle in \verb|ul_calc_traj|.\\ \\
Jetzt muss ich \verb|Dist3D| damit verknüpfen.\\
Datenprodukte zugefügt und Ordnerstruktur etwas aufgeräumt. \\

\DayInSep{Di}{10}
Jetzt Riesenproblem: Wie soll ich das in das V-Space-registern integrieren? Ich kann doch nicht noch 3 Dimensionen mehr anlegen... Ich schaue mir den Verlauf der einzelnen Geschwindigkeiten jetzt erstmal an. Plotfunktion \verb|plot_eigen_velocities()| in \verb|pui_ulysses.pui|. \\
Warum wackeln die Geschwindigkeiten so? Das kommt durch Rundungen und dadurch, dass ich von AU auf km gehe. Ich versuche jetzt, den Radius in km einzuladen, das ist in einer der Files gegeben. Etwas nervig, aber gut... Einen Versuch ist es Wert.\\
Krass, das hat es voll gebracht. Ich sollte den Radius in km auch in die anderen Funktionen füttern, wo es geht.\\ Macht es irgendwie nicht:
\begin{itemize}
	\item von HG zu HC gibt es in beiden Fällen eine Abweichung zum HC-Wert, km und AU unterscheiden sich nicht.
	\item von HC zu HG dito. Ich bräcuhte einfach genauere Winkelwerte. Egal. Ich nehme R\_km jetzt wieder aus der Pooled-Liste.\\
\end{itemize}
Ich bin SO verwirrt. Morgen weiter machen. In \verb|calc_v| Zwischenwerte umrechnen oder sogar zwei verschiedene Funktionen schreiben.

\DayInSep{Mi}{11}
Heute mit klarem Kopf nochmal angeguckt:
Verwendung der Radiusangabe in km macht einen Unterschied für v\_R, aber nicht für die anderen v-Komponenten, weil die Winkelangaben sowohl in HC als auch in HG zu ungenau sind. Umrechnen mit dem genauen Radius bringt nichts. Damit muss ich so leben. \\
Jetzt weiter mit dem echten Problem. Lars fragen...?\\
Nee, ich erweitere das Register jetzt einfach. Geht glaub ich eh kein Weg dran vorbei, nicht so schlimm, trägt zu meinem eigenen Verständnis bei -- hoffentlich.\\
Wie groß sollen die Steps sein? Wenn ich abschätze, dass wir w auf 0.2 auflösen, entspricht das einer Geschwindigkeit von ca. $500\,\mathrm{\frac{km}{s}}$ ?!\\ \\
Lars sagt, dass Translationen additiv sind, deshalb kann man auch beim Mappen der PHA-Worte mit den Geschwindigkeiten die Eigengeschwindigkeit dazuaddieren (so wie das mit w // der SW-Geschw. passiert). Ich probiere das kurz aus, ob dasselbe rauskommt (Eigengeschwindigkeit im Grid abziehen oder händisch verschieben). \\ \\
Frage nach der Auflösung:
\begin{itemize}
	\item Beispielzeichnung w-Space mit 600 km/s: 30 km/s in y-Richtung verschoben (wie bei ACE): Teilchen auf Schale w = 1 (eig. 600) landet oben bei 630, w = 1.05 und unten bei 570, w = 0.95.
	\item Ich kann die Bins auch mal anpassen und schauen, was passiert. eigentlich wären Bins wie bei PLASTIC besser, also welche, die sich an den Phasenraum anpassen (rund). Die momentanen Rechtecke haben ja immer unterschiedlich viel des Kreises überdeckt (Frage to self: \todo{Bin-Grid} Ist das nicht irgendwie beim Phasenraum mit eingerechnet?). Das wäre ein weit entferntes ToDo...
\end{itemize}
Kommentare zum Phasenraum:
\begin{itemize}
	\item Eigengeschwindigkeit dafür nicht mit rein, denn das ist rein instrumentenspezifisch (??).
	\item Beispiel Autos: in meiner Richtung Autos mit 95, aus der Gegenrichtung auch (gleichverteilt). Ich fahre mit 100. Weiter weiß ich nicht, nochmal drüber nachdenken, fragen.
\end{itemize}
Meinen Plot zur zeitaufgelösten Geschwindigkeit könnte ich mit in die MA nehmen. Zeigen, dass der Verlauf so ist, man den Fast-Latitude-Scan sieht, besonders in einer Komponente (wir schauen uns aber eher den Bereich an, wo das nicht so eine große Rolle spielt, da sind die Komponenten alle nicht so groß)
\\
Morgen: weiter vergleichen.

\DayInSep{Do}{12}
Fazit: Es passt, macht also keinen Unterschied, ob ich den V-Raum im Grid anpasse oder das eigentliche Datenprodukt beim Adden zu den PHA-Worten (außer dass ich beim Grid gerundet habe ich z.B. nicht 9.5, 9.67 und 9.88 zufüge, sondern immer 10).\\
Jetzt: Schauen, ob die Richtungen im RTN richtig sind, yay... \\
Hab mir den Kopf zerdacht, s. S. 85 in Kladde. Hoffe die Richtung passt jetzt, ich bin zu blöd das zu prüfen. Muss morgen gucken, dass das auf mehrere Detektorpunkte auch klappt.

\DayInSep{Fr}{13}
Habe das gelöst mit der Funktion \verb|numpy.tile|, \verb|.T| \\und die Anzahl ist \verb|self.col_dim|. \\ \\
Jetzt Threshold Ech-Detektor checken. Wollte mal mehr Daten einladen, gab Problem mit \verb|sync_traj|. Die Maske, die da gesetzt wird, ist glaube ich ziemlich sinnlos. Die war nur für \verb|sync_swoops|, weil da ggf. durch 0 geteilt wird. Das passiert hier nicht, weil ich keinen Mittlwert bilde, weil d90 gleich ist.\\
Ergebnis: Stimmt wirklich. Ganz ohne Filter ist erst E-Channel 15 belegt. Manchmal gaaanz wenig in 12 oder 14 (?!).


\DayInSep{Di}{17}
Jetzt He+ filtern: \\
Brauchte lange, um \verb|animate2d| aus \verb|dbData| zu erweitern, um die Mouseclickfunktion einzupflegen. Muss immer noch manuell die Fkt. zum Setzen der Masken aufrufen, will gern wissen, wie ich das in die \textit{init} bekomme. Musste \verb|animate2d| außerdem um ein Returnen der Figure erweitern. Die Funktion selbst ging dann aber gut.
Morgen:
\begin{itemize}
	\item Headline in gefilterte PHAs schreiben
	\item Überlegen, ob ich Epq noch runterzählen muss
	\item Lars Diverses fragen (s. Liste)
	\item jahrweise duchlaufen lassen
\end{itemize}

\DayInSep{Mi}{18}
Headlines und EpQ geregelt.\\
Lars gefragt:
\begin{itemize}
	\item Komische Signatur in ET-Matrix rechts von He+: Lars weiß auch nicht, was das ist. Ganz komisch, er forscht nach. Man kann das einigermaßen gut von He+ trennen, aber es besteht die Gefahr, dass das He+ selbst ist, was zeitweise falsch zugewiesen wurde und was man dann wegschneiden würde. Zeitlich ist das auch nicht einchränkbar.\\ Es gibt zwei seltsame Peaks: Einr ist ein Doublepeak, der andere ein Treblepeak
	\item Lars hat 2D-Maske gesetzt und dann die Zeiträume angeguckt bzw. sich die Daten zu diesen Zeiträumen angeguckt (bzw. die zur inversen Maske!). Es gibt aber nicht immer Parallelen zu den anderen komischen Signaturen und das He+-Signal gibts auch immer noch.\\
	Könnte auch ein seltsamer Bitfehler sein...? Alle 64 Kanäle in Tch?
	\item Lars hat mir \textit{mpq-Algorithmus}'erklärt: Todo
	\item \todo[color=green!40]{mpq-Alg} Versuchen, das formelmäßig nachzuvollziehen und evtl. auch an H+, He2+ und He+ durchführen (gut zu erkennen in EpQ vs. ToF).\\
	MpQ-Algorithmus:
	\begin{itemize}
		\item Wenn wir in EpQ vs. ToF Spezies identifizieren können, kennen wir die MpQ.
		\item Bei fester EpQ kennen wir dann auch die v vor dem Analysator (Primärenergie)
		\item Über ToF kennen wir auch die v nach der Folie
		\item Was wir nicht kennen: Energieverlust in der Folie, der abhängig von der Geschwindigkeit (u.a.) ist (die Breite in Tch-Richtung entspricht dieser Verteilung des Energieverlustes)
		\item Aus dem Wissen, dass dieser Tch bei diesem EpQ-Step auf MpQ xy mappt, ergibt sich funktionaler Zusammenhang (Hyperbel?): Tch $\leftrightarrow$ MpQ (pro EpQ)
		\item Dann kann man über MpQ statt über Tch plotten (\textit{hochbiegen})
		\item Je mehr Spezies man mit rein nimmt, desto besser wird die Funktion. perfekt wird sie aber nie, weil der Energieverlust in der Folie sogar bei selber MpQ entartet ist (massenabhängig)
		\item Wenn man jetzt noch ET-Matrix (Ech vs. ToF) dazu nimmt, kann man zuordnen, welche Masse auf welcher E-Tch-Kombi landet. Dann kann man theoretisch PHA reingeben und m gegen mpq plotten und erhält solche Boxen wie in Glöcklers SWICS-Paper 
	\end{itemize}
	\item He+ ist in EpQvsToF fast noch besser zu tracken als in der EchvsToF über die \verb|animate2d|-Funktion. Ich kann da auch einfach die EpQs entlangklicken. Die Dreckbubble rechts weglassen.
	\item Erstmal genug Theorie. Jetzt Klickprogramm erweitern um Funktion, mit der ich einfach den Schlauch in EpQvsToF ausschneiden kann.
\end{itemize}
%
Habe ich fast fertig. Man kann jetzt auswählen, welches Datenprodukt man möchte. Achtung beim Klicken: in der unteren Hälfte des Bins klicken, damit abgerundet wird. Oder achnee, der Index wird ja angeben, welchen EpQ-Step ich habe. \\
Ich möchte morgen lieber zwei Grenzen angeben anstatt nur einen Tch-Wert, um den herum symmetrisch Kanäle genommen werden (weil die anderen Sachen teilweise sehr nah kommen un die Breite doch nicht so konstant ist)

\DayInSep{Mo}{23}
EpQ-Klicken läuft jetzt auf zwei Intervallgrenzen.\\
Momentan teste ich, ob es einen Gang zwischen den Jahren gibt.\\
Ergebnis: Nö, sieht immer ziemlich konstant aus. Aber ich bin beim Klicken manchmal sehr unsicher, ob ich was mit reinnehmen soll, oder ob das "'Rauschen"' ist. \\
Muss Rng0 und Doubles raus noch händisch machen, stört aber nicht. \\
Jetzt mache ich dasselbe auch noch für die Protonen, damit ich nur Sonnenwind habe und die Ausrichtung vom Kollimator prüfen kann.\\
Die Protonen maskiere ich jetzt über ESSD, He+ über EpQ. Der Code ist entsprechend angepasst.
\\ \\
Nochmal Besprechung Lars:
\begin{itemize}
	\item Frage: Soll ich Kanäle $\textgreater$ 16 mitnehmen, obwohl da ja theoretisch auch schwerere Ionen in die RNG0 gekommen sein können?\\ Ja, besser jetzt eine grobe Vorselektion und dann später, z.B. über $w$-Filter, weiter filtern. Kann auch ruhig erstmal die Doubles mitnehmen.
	\item Das Problem ist, dass man nicht weiß, welcher Anteil gerade unter den Threshold gewandert ist. Eine Möglichkeit wäre, sich Doubles und Trebles (bzw. alles und Trebles) nebeneinander anzugucken und zu schauen, welcher Anteil jeweils wo gelandet ist (pro EpQ-Slice). Das ergibt dann ein zusätzliches \textit{Gewicht}
	\item Es ist zu erwarten, dass Tof-Intervall breiter wird für größere ToF (wegen Folie)
	\item Die Protonen, die ich gerade versuche zu filtern, sind suprathermale! Denn die anderen sind nicht in den Trebles, sondern Doubles, weil auch unter Threshold. Bei den Suprathermalen ist nicht richtig bekannt, ob die wirklich im SW-Bulk sind. Wir brauchen was in den Doubles, weil wir ja an Sektor- und Detektorinfo wollen:
	\item Besser He2+ nehmen: Weil das 2-fach geladen ist, bekommt es durch die Nachbeschleunigung die doppelte Energie (vgl. zu He1+ und H+) und wandert nicht so schnell unter den Threshold (die SSD misst ja nur die komplette Energie nach der Nachbeschleunigung)!\\
	Sitzt schön im Bulk als schweres Ion; hat eine gute Statistik: auch wenn c6+ in die RNG0 rutscht, macht es nur ein Tausendstel oder so aus (sitzt außerdem wahrscheinlich auch im Bulk, allerdings weiß man nicht genau mit der Geschw...?)\\
	Mit dem He2+-Filter gucke ich mir dann den Kollimator an. Stelle AA ein, schaue, welcher Sektor/Detektor in Richtung Sonne steht. Passt das zu den Daten oder gibt es einen Versatz?
\end{itemize}

\DayInSep{Di}{24}
Habe gestern noch He2+ gefiltert, in EpQ-Matrix. \\
Jetzt mache ich He1+ nochmal. Ich soll nämlich doch in höhere Kanäle gehen, wenn es geht. (Der Rest wird dann später über w gefiltert)\\
Anzahl von einem Jahr (1995):
\begin{itemize}
	\item ungefiltert: 18861633 (ca. 18 Mio) Teilchen
	\item He1-Maske: 140500 (0.7\%)
	\item davon nur RNG0: 27291 (19\%)
	\item davon Doubles: fast nichts
\end{itemize}
Habe jetzt alle Jahre gefiltert. Probiere jetzt aus, ob das mit dem w-Spektrum noch geht. \\
Vielleicht sollte ich nochmal filtern, um die Doubles mitzubekommen (die sitzen in EpQ-Matrix in den höheren ESA-Kanälen, weil da die Energie so gering ist, dass sie unter den Threshold rutschen). Versucht, Systematik zu erkennen: Aber alle Jahre verschieden. Habe Halbjahresplots von 1993 bis 1997 in \verb|Ulysses/Plots/Halbjahre_EpQ_ToF|: Nur RNG0 und mit/ohne Maske auf Doubles.
\\
Habe jetzt nochmal großzügig Maske gesetzt: Kombi aus 93 und 96 ging weit hoch, aueßrdem alles etwas verbreitert. Jetzt lasse ich nochmal durchlaufen.\\
ACHTUNG: Die Doubles mit $mpq > 3.3$ (also auch He1+!) landen in RNG2.


\DayInSep{Do}{26}
Hab jetzt viel rumgebastelt und eine eine Auswahl mithilfe mask2D getroffen, das geht viel einfacher. Ist nicht perfekt, aber bleibt erstmal so, ich muss weiter machen. (Ich habe immer noch nicht viele Doubles, denn: die sind für He1+ ja im Allg. in RNG2 und nicht in RNG0. Für He2+ und H+ liegen die nicht im ausgeschnittenen Schlauch.)\\
Wollte das mit dem Subset-Wegschreiben reparieren, also in \verb|Dist3D| immer auf die Mastermaske zugreifen, aber das geht nicht: \verb|d.add_data| funktioniert nämlich nur auf dem gesamten d und z.B. \verb|d.vspace| hat nur die Größe des maskierten Datensatzes (aus (guten) Speichergründen). Was solls, ich behalte das mit dem Subset einfach bei. Dann ist der unmarkierte Datensatz genau gleich dem Master-Datensatz.

\DayInSep{So}{29}
Ich will rausfinden, welcher Offset-Winkel jetzt richtig ist.
\begin{itemize}
	\item Achtung, vx, wx, ... -Datenprodukte werden jedes Mal geändert, wenn ich eine neue Dist3D mit anderem Winkel instanziere.
	\item Falschzuordnung würde folgendermaßen aussehen: \\
	Weil der Winkel tatsächlich ca. 180 Grad ist, ist der angesprochene Sektor für den SW-Bulk fast immer 4, das steht in den PHA-Daten. Wenn ich jetzt denke, dass der Winkel nur 90 Grad ist, bin ich bei Sektor 4 schon 90 Grad über die SW-Richtung hinweg. Da gibt es dann einen recht großen Anteil in y- und z-Geschwindigkeitskomponente, wenn ein Teilchen von dort käme. Wenn der AA jetzt in die andere Richtung zeigt, zeigt dieser Winkel in einer ganz anderen Richtung am Bulk vorbei. Im W-Spektrum ordne ich die SW-Teilchen dann also auf ganz utnerschiedliche Richtungen aus, d.h. der Bulk wird verschmiert bzw. es ergibt sich ein Ring (abh. von der Variation des AA). Wenn der AA lange konstant ist, ist der Bulk zwar relativ scharf, aber verschoben.\\
	Ich muss das mit großem AA testen, denn:
	\begin{itemize}
		\item Bei kleinem AA ist jeder Sektor Sonnenrichtung (unabhängig von Rotation)
		\item Bei kleinem AA sind die Sektorgrenzen so nah beineinander, dass der Bulk eh irgendwie auf allen landet.
	\end{itemize}
	Gut wäre es also, Zeiten zu finden, in denen der mittlere Detektor angesprochen wird.
	
	\todo[color=green!40]{AA Plot} Ich bräuchte mal einen ordentlichen Plot für den Verlauf des AA. Done: Funktion in \verb|DataLoader/pui_ulysses.py|
\end{itemize}
\todo{w} W\_he in Dist3D checken: Das gibts auch für He2+, aber scheint etwa dasselbe zu sein...? \\
Ich gehe jetzt über die vz und vy- Geschwindigkeiten, histogrammiere die und schaue, wie sehr die von 0 abweichen. 180 Grad scheint am besten zu sein. Was in mit den fehlenden 22.5 Grad? Und warum verändert sich das wspec mit Schnitten in x-Richtung?


\DayInSep{Mo}{30}
Besprechung Lars.\\
Zum Offset:
\begin{itemize}
	\item DPU: Angeblich können die noch einen Versatz eingestellt haben. Nachgucken.
	\item Vielleicht kommt dieser Effekt auch dadurch zustande, dass bei 202.5 Grad vy = 0 zwar nicht im Zentrum des Sektors liegt, aber schon mit drin ist? Prüfen.
	\item Außerdem prüfen, wie das aussieht, wenn ich die Eigengeschwindigkeit ausstelle. So kann ich die auch verifizieren.
	\item Mit in die Arbeit: Irgendwie schön darstellen, dass die Überlegungen richtig sind: Für verschiedene AA Sektor- und Detektorinformationen (das Maximum / den Schwerpunkt) histogrammieren (He2+)
\end{itemize} 
Was sind die wiss. Fragestellungen, die ich als nächstes bearbeiten kann:
\begin{itemize}
	\item Schnitte durch w-Spektren, um Torusverteilung zu sehen
	\item Nicht nur Schnitte durch He+-w-Spektren, sondern auch entlang der Schalen. D.h. für jedes w eine Skymap erstellen über die Winkel (in RTN) -- so ähnlich wie im PLASTIC-Paper. Abhängig von w und B-Feld verändert sich die Torusverteilung ...? Sieht man das hier auch?
	\item Zurück auf 1D - Verteilung (jetzt aber im SW-frame). Inwiefern sieht das anders aus als im SC-frame?
	\item Erstmal Langzeitdaten um zu gucken, dass die Zählstatistik passt. Später dann z.B. nach B-Feld filtern. Oder nach Abstand zur Sonne
	\item Abstand Sonne: Da ist wichtig, dieselbe vsw anzugucken (warum?). Z.B. Scan von Mitte 1995 bis 1998 -- im schnellen SW. Das könnte man auch ganz simpel gut untersuchen mit 1D-reduziertem Spektrum. Sieht man da 'Kühlen' bei einem Abstandsscan? \\ Wenn es kein \textit{Kühlen} (Energieaustausch) gibt, müsste die Phasenraumdichte nach außen immer wachsen, weil immer nur mehr dazu kommt. (Außer natürlich dem Abfall mit r**2). Wenn es Kühlung gibt: Vielleicht sogar schnellerer Abfall.
	\item Man kann auch noch He2+ untersuchen! Sinnvoll wäre es auf jeden Fall, einmal unser Modell zu testen und zu schauen, ob die Schwerpunktsgeschwindigkeit in etwa der von SWOOPS gemessenen vsw entspricht (Lars erwartet sogar eine geringe Abweichung: Diff. Streaming? Versatz zwischen Protonen und He im Sektor.)\\ Was ist eigentlich die Bezugsgeschwindigkeit für die PUIs, die w bestimmt? Vielleicht gar nicht die Protonengeschwindigkeit, sondern die Hoffmann-Teller-Geschw. (schwerere Ionen?)
\end{itemize}

Winkel umgekehrt, um den der Sektor 0 gegen SunPulser gedreht wird, denn man muss ja \textit{zurück} drehen (gegen den normalen Drehsinn), s. DPU

\DayInOkt{Di}{1}
Oh! Die Detektoren sind andersrum angeordnet, als ich die ganze Zeit dachte: Det0 ist außen, wird also bei großen AA angesprochen, Det1 der in der Mitte und Det2 der ganz innen.

\DayInOkt{Mi}{2}
Ich habe jetzt das Histogramm Det/Sec polar umgebaut. Man sieht, dass das Maximum bei kleinen AA eher auf Sektor 3 rutscht und bei größeren AA auf Sektor 4:
\begin{itemize}
	\item Das spricht dafür, dass wir die richtige Krümmung haben
	\item Ob der Winkel 180 Grad sind oder 202.5 oder was dazwischen: Keine Ahnung. Mit dem Kollimatormodell kann man das auch nicht so richtig feststellen (wo geht die x-Achse durch?), weil auch nicht ganz klar ist, ob wir die rz-Achse richtig angebracht haben. Man könnte die Base-Points auch links mit negativem Sinus beginnen, dann verschiebt sich alles ein bisschen in Richtung der konvexen Sektorkante. \todo{Offset Angle Sunpulser} Ich behalte das jetzt einfach auf 180 Grad und mache weiter und frage Lars bzw. schaue, ob das mit He+ einen Unterschied macht.
\end{itemize}

\DayInOkt{Fr}{4}
Mache jetzt weiter mit der He2+-Bulk-Velocity-Berechnung, um sie mit der von SWOOPS gemessenen vsw zu vergleichen. \\ \todo{Gewichtung Bulk Velocity} Frage: Muss die Gewichtung auch hier mit rein? \\ Überlegung:
\begin{itemize}
	\item Die Guckrichtungshäufigkeit (Phasenraumabdeckung) ist vielleicht eher nicht so wichtig, weil die SW-Richtung ja immer drin ist?
	\item Wenn ich das Phasenraumvolumen richtig verstanden habe, sollte das mit rein, weil sonst schnellere Teilchen überhöht gemessen werden. Und SWOOPS' vsw-Messung ist ja unabhängig. 
	\\
	(Allerdings ist die berechnete Bulkgeschwindigkeit in einem ersten Test deutlich geringer als die vsw...) $\Leftarrow$ Fehler gefunden! Die charge-Angabe war noch nicht angepasst auf He2+! Die getvelocity-Funktion hat Geschwindigkeiten für He1+ berechnet, die natürlich kleiner sind...\\
	Habe gleich auch noch die Effizienzen für He2+ angepasst und weggeschrieben von den ACE-Effizienzen, falls ich die Gewichtung noch einbaue.
\end{itemize}
Jetzt passt es! (He2+-Verteilung ist nur etwas breiter)\\
Und supernice (ist leider falsch, s.u.): wenn ich die SC-Eigengeschwindigkeit rausnehme, passt es nicht mehr, d.h. das scheine ich richtig gemacht zu haben.
\\
Morgen: Überlegen, ob ich vielleicht auch noch was über den Winkel rausfinden kann. Überlegen: Verändert sich der Betrag...?


\DayInOkt{Sa}{5}
Das war Quatsch mit der Eigengeschwindigkeit, ich hatte nur wieder vergessen, die Ladung an He2+ anzupassen...\\
Fazit: Sowohl für Eigengeschwindigkeit als auch für SP-Angle ändert sich die Verteilung zwar, aber nur im Detail und nicht wirklich (von mir) beurteilbar.

\DayInOkt{Mo}{7}
Seit Samstag dabei, die 1D-Sachen zu bauen:
\\ \\
\todo{Frage Lars} Mit \textit{1D} meinte Lars den Betrag, oder? \\ Jedenfalls baue ich eine Funktion \verb|spec_1d|, die den Betrag im SC- und im SW-frame nimmt und histogrammiert. Dabei muss ich die gesamte Gewichtung für beide Fälles durchführen.\\
\todo[color=green!40]{Norm auslagern} Erstellung des Norm-Arrays auslagern? Das nimmt immer viel Platz weg und mit den entsprechenden Paramatern sollte das gut zu verallgemeinern sein.
\\ \\
Ich hatte richtig komische 1D-Spektren mit krass hohen Werten (w = 2 im SW-Frame, also quasi dreifache vsw). Der Grund war, dass die Detektorinformation noch falsch war. Angeblich sind jetzt immer viele Teilchen mit krass großer vx und vy-Komponente reingekommen, die eigentlich ganz moderate GEschwindigkeit hatten. Habe die Detektoren jetzt richtig getauscht (von innen nach außen 2 -- 1 --0)\\ \\
Anderes Problem mit der Normierung: 
Wie norm\_arr-w-Bins beziehen sich auf den SC-frame. Wenn ich die w-Werte der PHA-Worte in den SW-frame verschiebe, ordne ich falsche w-Normen zu. Bsp: Die Norm sieht für w = 1 den Wert 5 vor. Jetzt habe ich einen w-Wert, der im SC-frame 2 ist, im SW-frame aber 1. Dann wird derfälschlicherweise mit 5 normiert, obwohl er eigentlich den Wert von w=2 braucht.\\
Ich habe keine Ahnung, wie ich das lösen kann. Bins verschieben bringt nichts beim Betrag. Vielleicht noch einen neuen WSpace für den SW-frame?

\DayInOkt{Do}{10}
Habe ei Grid ins Kollimatormodell gebaut und den ersten Sektor zentriert (so muss das richtig sein).\\
Lars Besprechung:
\begin{itemize}
	\item Wichtig: BRW drauf gewichten, damit nicht einzelne suprathermale Teilchen überproportional gezählt werden
	\item Dass die nominelle (Richtung Sonne) radiale Richtung unseres Kollimatormodells nicht mit dem hist\_sec\_det-Maximum übereinstimmt, ist komisch. Das könnte man selbst sehr ausführlich untersuchen:
	\begin{itemize}
		\item Evtl. strömt der He2-Bulk also doch nicht immer radial
		\item Langzeitdaten angucken, damit man nicht einzelne Ausreißer trifft (CIRs etc.)
		\item Abweichung quantifizieren und in Abhängigkeit vom AA oder vom Sonnenzylus, von der Latitude untersuchen (Erwartung: über den Polen strömt der SW bsodners radial ab) 
	\end{itemize}
	\item Ich will aber PUIs machen: Es wäre schön eine Begründung zu haben aber naja, Zeit... in die Arbeit schreiben, dass es meistens passt, nachvollziehbar darstellen. Schreiben, dass wir das nach bestem Wissen bestimmt haben.
	\item Struktur der Arbeit: s. Blatt
	\item Weiter mit PUI:
	\begin{itemize}
		\item Skymaps, anfangen mit w=1, dann andere ws, dann auf B-Feld und Zeit und Sonnenabstand untersuchen
		\item Erwartung: bei kleineren ws erwartet man, dass der SW eher entlang des B-Feldes strömt, bei größeren eher senkrecht (Torus)
		\item zurück auf 1D, SW-frame und SC-frame vergleichen
		\item erstmal aber: Phasenraumvolumennormierung versuchen selbst zu bauen ohne Lars' Histogramme:
		\begin{itemize}
			\item v**3 kommt durch die Kollimatorakzeptanz zustande: Zwar immer derselbe Winkel, aber eine Aktezptanz von 3 Prozent sind bei 800 km/s was anderes als bei 400 km/s!
			\item Kollimatorpunkte im äußeren Detektor haben größeren Abstand zueinander: überstreichen in gleicher Zeit größere Flächen $\rightarrow$ größeres Phasenvolumen.
			\item Effekte müssen wir bedenken, weil das rein instrumentelle Sachen sind und nicht welche der Physik, die wir untersuchen wollen.
		\end{itemize}
	\end{itemize}
\end{itemize}

\DayInOkt{Mo}{14}
Dachte ich hätte eine gute Lösung gefunden, in beiden Frames (SC und SW) zu normieren: Indem ich einen zweiten w-Space im SC frame erstelle. Aber irgendwie komme ich trotzdem nicht auf dieselben Summen, wahrscheinlich wegen des Binnings. Ich lasse das erstmal und mache weiter mit der Skymap.
\\
Wollte erst einfach über die Datenprodukte \verb|wsw| bzw. \verb|w| Masken setzen, aber das geht nicht, weil die einzelnen Datenprodukte ja Arrays sind. Jetzt maskiere ich einfach das Ergebnis aus \verb|get_data()| immer einzeln

\DayInOkt{Di}{15}
Skymap funktioniert. \\
Ich wähle die w-Schalen im sw-frame aus. Wenn ich die Winkel im SC-frame nehme, wird die Winkelabdeckung natürlich kleiner, je weiter innen ich auf der Schale bin. Deshalb muss ich auch hier sw-Frame nehmen. \\ \\
\todo[color=green!40]{Normierung} Ich muss auch hier Normierung einbauen. \\
\todo{Skymap-Darstellung} Ich muss den Plot irgendwie weltkartenmäßig machen. \\
\todo[color=green!40]{Durchklicken} Ich will Klickprogramm auch hierauf anwenden.
\\ \\
Ich muss das einfach wie beim w3Dspec machen, vorher normieren. Baue das entsprechend um.\\
Überlegung: Heir muss ich aber zusätzlich noch die Größe der Bins mit reinrechnen, oder? Vielleicht einfach über eine Gewichtung beim Histogrammieren? \\
\todo[color=green!40]{aufräumen} Funktionen ordentlich benennen, Auswahl Countrate / Spektrum DONE, aber: neverending Story.. \\
Das mit dem SC-frame-space kommentiere ich erstmal wieder aus.
\\ \\
Konnte die Winkel doch den Datenprodukten zufügen. Habe aber keine Ahnung, wie ich das mit der Normierung machen soll...
\\ \\
Morgen: Einzelplotfunktionen weiter anpassen, dass die so schön werden wie in der Loop und allgemein verschönern


\DayInOkt{Mi}{16}
\todo{Normierung} Muss noch auf Phasenraumvolumen = 1 normieren beim WSpec. \\ \\
\todo[color=green!40]{Achsenbeschriftungen} Achsenbeschriftungen bei WSpec. \\ \\
\todo[color=green!40]{Auflösung} Testen, wie sich die Auflösungen der Bins und Steps auswirken. Fazit: Man muss schon einigermaßen hoch gegen vor allem mit den Sec-Steps (und den Steps\_para), sonst wird das spinnennetzig\\ \\
Nur Countrates auf WSpec und verglichen mit Phasenraumvolumen: Nur Counts sind in der Mitte immer stark erhöht, das passt. Normiert sieht man hingegen kaum irgendwas!\\
Problem: man sieht nichts, weil manche Bins krass überhöht sind. Grund ist, dass der Norm-Array dort den Eintrag 0 hat, auf 1 gesetzt wird und die Counts dort aber (normal) groß sind.\\ 
Mögliche Probleme:
\begin{itemize}
	\item w in den Datenprodukten wird nicht aus wspace genommen, sondern aus modifiziertem vspace. Der Normarray wird aber aus wspace genommen. Da ist ein Offset drin!
	\item Warum werden in der get\_norm vsw und die aspect angles so unterschiedlich behandelt?
	\item Eigengeschwindigkeit?
	\item Bins/Steps feinere Auflösung?
	\item Zur Not die Nuller im normarray erstmal nicht auf 1 sondern auf 100 oder so setzen...
\end{itemize}

\DayInOkt{Fr}{18}
Endlich hab ich die Indices gefixt!! Das Problem war, dass der norm array über den wspace erstellt wurde und H über den modifizierten vspace. Die sind dann nicht deckungsgleich (ging auch ein bisschen was mit den Histogrammgrenzen schief) Neues Binning ist in der Kladde S. 86 dokumentiert\\ \\
\todo[color=green!40]{+5} Überlegen, ob das mit den vsw-Steps jetzt einfacher ist: Japp! Denn beim Runden lande ich genau auf den vsw-Werten, mit denen ich auch den v-Space erstellt habe. Der Index 2, also mit gerundeten Werten, ist also "korrekter" \\ \\
\todo[color=green!40]{whe} Überlegen, wie ich jetzt whe einschränke: Ganz einfach, muss gar nichts komisch maskieren in norm und H: Einfach die Masken mit übergeben bei der Erstellung von norm, dann sind die ja zeingend gleich (Jetzt! Wo alles aus dem gleichen Space genommen wird!) \\ \\
\todo[color=green!40]{vsw} Überlegen, wie ich vsw einschränken kann: Das klappt einfach nicht, weil ich nicht nur einen Teil der PHA-Worte mit einem w versehen kann. Deshalb hat Lars das wahrscheinlich auch nicht über den w-Space gemacht sondern über den modifizierten v-Space. Ich nehme das Begrenzen einfach raus. Dann muss ich die Daten halt vorher auf d filtern. Morgen weiter mit Einschränkungen im WSpec...

\DayInOkt{So}{20}
\todo[color=green!40]{vspace} vspace entsprechend anpassen und \\ \\
\todo[color=green!40]{wspace} im wspace die anderen Datenprodukte erstellen, evtl. schauen wie sehr sich die Werte unterscheiden! Done: s.u.\\ \\

Oh! Das geht natürlich alles nicht mehr, wenn ich die Eigengeschwindigkeit mitnehme... Und da steckt auch das Problem: Auch wenn die Bins wirklich gleich sind, kann es sein, dass ich im letzten Histogrammierschritt durch die Eigengeschw. in einem anderen Bin lande als norm (das ja strikt aus dem Space ohne Eigengeschwindigkeit gebildet wird). \\
Allerdings scheinen sich die Werte echt nicht weit auseinander zu liegen. Es gibt auch eine kleine Differenz, wenn ich die Eigengeschwindigkeit ausstelle zwischen dem w aus dem vspace und dem wspace (wR\_s usw. Das ist genau das w, aus dem auch der Normarray gebildet wird). Die Differenz aus vspace mit Eigengeschw. ist ca. nochmal so groß. Man kann natürlich Pech haben, wenn die Differenz genau über eine Bingrenze geht. Solche Fälle müsste man dann hinnehmen? (Differenz ist ca. 0.01 w)\\
Getestet auf 1995, 200 Tage: Ab einer Bingröße (in den wSpecs) von 0.05 (normal war 0.2) kommt es zu Überschreitungen. \\
Unabhängig davon, wie sinnvoll dieses Binning ist, fange ich das jetzt mal an diesem Fall ab. Es war eine Zeile...


\DayInOkt{Di}{22}
Habe die Winkelberechnung nochmal umgeschrieben, jetzt ist es wirklich im SW-Frame. S. Kladde S. 88.

\DayInOkt{Mi}{23}
Da waren komische Lücken in der Skymap. Die sind jetzt beseitigt, ich hatte bei der Winkelberechnung was falsch gemacht. Die endgültigen Formeln sind in der Kladde. Sieht jetzt alles gut aus, auch die Normierung ist prima, glaube ich!\\
Ich kann jetzt auch eine w-Kugel in den w-Space zeichnen, um die Abdeckung zu zeigen. Und die passt gut zu dem, was man auf der Skymap sieht.\\
Weiter: \\
\todo{Basemap} Die Skymap soll vom eckigen Format auf eine richtige Map mit dem Basemap-Modul \\
\todo{EpQ-Plot} EpQ-Verlauf mit Akzeptanz plotten \\ 
\todo{Phasenraumvolumen} Lars fragen: Einheit, Normierung Phasenraumvolumen

\DayInOkt{Mo}{28}
Lars war verwundert über viele Cpunts bei $w=0$ im 1D-Spektrum. Eigentlich können wir doch gar nicht so weit runter messen, weil wir ja nicht auf so hohe ESA-Steps kommen. Da hatte er recht, ich habe mir die gefilterten Daten nochmal asl Tof vs ECH angeguckt und da war oben noch ein anderer Streifen mit drin von was Schwererem. D.h., ich filtere He jetzt nochmal.\\
Bei He2+ habe ich den Pile-Up mitgenommen. Ist vielleicht blöd, weil die Zuordnung dann auch nicht richtig ist...? kP. Ich filtere das auch nochmal als zweite Version.

\DayInOkt{Di}{29}
Gefilterte Daten gibt es jetzt jeweils in der Version \textit{...pileUp} und ohne (das ist die akutellere Version, wo ich den Filter im Tof vs EpQ noch ergänzt habe um einen Filter in Tof vs Ech).
\\
Dann habe ich angefangen, die B-Feld-Daten von Thies aufzubereiten. Die liegen in 2-Sekunden-Auflösung vor. Lars gefragt, ob ich einfach immer 13 Minuten mitteln kann oder man den genauen Ausschnitt braucht.\\
Antwort: Interessant ist die Zeitskala, gegen die sich die Pitchwinkelverteilung vom Ion ändern kann. Zeitskalen, die kleiner sind als die Gyrofrequenz, bringen nichts, weil das Teilchen dann nichtmal eine Gyration vollführen konnte. Zeitskalen die viel größer sind sorgen dafür, dass sich die Verteilung mitdreht. Lars' Gefühl: ca. eine Minute.\\
Verschiedene Ideen:
\begin{itemize}
	\item eine Minute mitteln, die jeweilige Minute nehmen
	\item eine Minute mitteln und anhand der EpQ-Steps die SWICS Zeitauflösung genauer unterteilen (das könnte man entweder per For-Schleife machen oder --viel schneller -- mit einem Histogramm, wobei man da überlapende Bins bräuchte und das ist nicht so einfach. Steine hat das schonmal gemacht...? Zweimal histogrammieren: Einmal ganz fein und dann...?)
	\item genauso, nur anhand der jeweiligen Magnetfeldstärke die Zeit anpassen, über die gemittelt wird (weil sich die Gyrofrequenz ändert)
\end{itemize}

Dann kann man noch überlegen, von wo man die z.B. Minute nimmt -- denn welches B-Feld ist überhaupt relevant für das Ion? Hängt auch davon ab, wie sich das Teilchen bewegt: entlang, quer, von oben...?\\ \\
Wie mittlere ich das B-Feld? Am besten einfach die Komponenten mitteln, dann hab ich eine Repräsentation des mittleren Vektors. (Das ist aber was anderes als die Winkel zu mitteln und auch der mittlere Betrag ist ein anderer...) \\ \\
Erstmal jetzt die Gyrogrößen ausrechnen:
\begin{align*}
Gyro- / Larmor-Radius: r &= \frac{m v_{\perp}}{q B} = \frac{4\cdot 1.6605\cdot10^{-27}\,\mathrm{kg} \cdot v_{sw}} {1.602\cdot10^{-19} \,\mathrm{C} \cdot 4\,\mathrm{nT}} \approx 4000\,\mathrm{km} \\
Gyroperiode: T &= \frac{2\pi \cdot r}{v_{\perp}} = \frac{2\pi\cdot m}{q \cdot B} = 65 \,\mathrm{s}
\end{align*}
$\Rightarrow$ passt mit einer Minute!


\DayInOkt{Mi}{30}
Magnetfeldkomponenten jetzt den PHA-Worten zugefügt: Gemittelt auf eine Minute und dann die PHA-Worte entsprechend ihrem Epq-Step einen refined Doy90 gegeben und einsortiert. Sollte passen.\\
Jetzt will ich noch den Phi- und Thetawinkel des B-Feldes zufügen. Netterweise hat Thies das schon in RTN-Koordinaten. Allerdings im SC-Frame, d.h. ich kann nicht dieselben Formeln nehmen wie für den v-Space. ...Doch! Kann ich natürlich, die Geometire ist ja dieselbe. Vspace hat den Ursprung nur woanders. \\
Fertig. \todo{NaNs} Achtung: Da sind noch NaNs drin. Macht wahrscheinlich mehr Sinn, als das auf 0 zu setzen. Vielleicht crasht das auch...? Dann muss das auch sowas wie 1000 Grad?
\\
\todo{PHA um B ergänzen?} Außerdem dauert das ganz schön lange. Vielleicht schreib ich das direkt einmal mit weg...? \\ \\
Das komische Spektrum in 1997 lag an den Baserateweights! \todo{brw 1997} Keine Ahnung, warum die in 1997 so oft über 1 hinaus gehen... Ein bisschen geguckt: BRW $\ge$ 1 verteilt sich vor allem bei kleinen vsw und geht dann sprunghaft nach unten. Es gibt dazu einen Plot: \verb|1997_brw_groesser_1.png|


\DayInOkt{Do}{31}
Trajektorie: Nochmal nachgeguckt: Der Orbit ist oben \textit{nach vorne} gekippt, d.h. taucht erst hinter die Knotenlinie Orbit--Ekliptik
\\ \\
Magnetfeld: Während des Minumums um 1996 (Ende Schwabezyklus 22, Anfang Zyklus 23): Unterhalb der Ekliptik negative Br-Werte, oberhalb positive -> passt zu dem Butterfly-Diagramm mit Polung (Wiki, NASA)

\DayInNov{Fr}{1}
Magnetfeld: Ich schreibe gerade neue PHA-Dateien für He+ weg, in denen die Magnetfelddaten mit dirn sind, damit das alles schneller geht. Man kann dann entweder den \verb|PHA_mag|-Pfad angeben, dann wird das automatisch mit eingeladen (aber nur für He+). Oder man lädt über einen anderen Pfad ein und wählt \verb|sync_mag()|, dann werden die Mag-Daten nachträglich eingeladen. Das geht für alle Daten, dauert aber länger.\\ \\
Sphärische Koordinaten: Ich habe gestern komische Entfüllungen bei Phi 90 und -90 gesehen über alle Thetas außer Theta 90 und -90 gesehen (da, \textit{oben und unten} war dafür besonders befüllt)).\\ 1. Fehler gefunden: Ich habe die Theta-Komponente verkackt! die ist natürlich nicht nur von N und R abhängig sondern auch von T. Formel wird jetzt angepasst.

\DayInNov{Mo}{4}
Mit Steini und Verena geschnackt:\\
\todo{FoV reinzeichnen} FoV in die daten reinzeichnen, damit man direkt weiß, wo man was sehen könnte und wo nicht
\todo{Bins verschieben} Bins so verschieben, dass man w=1 tatsächlich mittig mit drin hat\\
Um das Cooling zu analysieren bräuchte man mehr Zeit, dafür müsste man die Histogramme richtig auseinander nehmen
\begin{itemize}
	\item Radiale Abstände vergleichen: 
	\begin{itemize}
		\item Für alles: Ionisationsraten von Duncan holen! Die ist nämlich radius-/orbitabhängig. Ggf. zeigen dass die Simulation stimmt
		\item Verhältnis Inner Source, äußerer Ring. (Einfach aufsummieren jeweils). Das Verhältnis sollte auch unabhängig vom Radius sein. Bzw. wenn ich nur die IS nehme und um den Radius korrigiere und das konstant bleibt: Dann ist es wirklich IS. Wenn es mehr ist, sind das doch Prozesse die auf dem Weg stattfinden
		\item Wenn die Summe im Ring mit dem SW-Fluss geht: wahrscheinlich wurde der Ring instantan, lokal erzeugt und alles was vorher erzeugt wurde ist irgendwie weggedriftet
	\end{itemize}
	\item Falls mit Fluss zu blöd: Immer oben und unten vergleichen, also z.B. 1994 mit 1996 usw.
	\item Fast Latitude Scan: Vielleicht täglich gucken und nach Stream Interaction Regions gucken: Werden die PUIs beschleunigt?
	\item Schauen, wo Focusiong Cone liegt und ob Ulysses da durch geht, ob man das sieht
\end{itemize}

\DayInNov{Do}{7}
\todo[color=green!40]{Effizienz} Effizienzen mal nicht von ACE verwenden, sondern linear vom letzten EpQ-Step hochinterpolieren bis Step1. Done. Liegt als \verb|He1+_new-eff| im Data-Ordner. Hat nicht so viel gebracht
\\ \\
\todo[color=green!40]{W-Range} Nur die Schalen plotten, die auch bei der vsw erreicht werden können. Done. Als Argument \textit{wshellmax} übergeben, das ist ein Attribut von Dist3D.
\\ \\
\todo[color=green!40]{Focusing Cone} Focusing Cone Lage checken: Vielleicht ist das der Grund dafür, dass es 1995 nicht so wirklich langsamen SW gibt? (Weil Ulysses direkt \textit{hinter} der Sonne)\\
Gecheckt: FC liegt bei 74 Grad heliocentric longitude, d.h. ungefähr bei der x-Achse vom heliographic Koordianatensystem. Also fast im rechten Winkel zur Ulyssesbahn von oben gesehen. (Auf Zeichnung: nach vorne raus)
\\ \\
\todo[color=green!40]{1D} 1D Spektren: Nicht die mittlere Dichte nehmen, sondern die über die Kugelschale integrierte Dichte. Einheit: s/km**4?\\ Schalen integrieren und 1D histogrammieren
\\ \\
\todo{Pitchwinkel} PA-Verteilung ausrechnen durch Bfeldvektor und Teilchenvektor im SW-Frame. Das dann z.B. für verschiedene Jahre oder Radien.
\\ \\
\todo{Überhöhte Hits}Nochmal überlegen, wie ich die überhöhten Hits wegbekomme, ohne was wegzuschneiden


\DayInNov{Mo}{11}
Für \verb|ana_1d| Ekliptik wegschneiden, damit wir nur koronalen SW haben und keine CMEs oder so drin sind: Auf heliographischem System machts wahrcheinlich mehr Sinn, der Sonne ist die Ekliptik ja egal. Habe jetzt den Bereich zwischen -25 und +25 Grad ausgeschlossen.

\DayInOkt{Do}{22}
\todo[color=green!40]{Ausdehnung Sektor/Detektor zum Vergleich mit AA-Abweichung J2000, B1950}
\todo[color=green!40]{entsprechende Plots in Präsi einbauen}
\todo[color=green!40]{Funktionen dokumentieren}
\todo{weiter mit Review: virtueller Kollimator}
\todo{Code insgesamt mal strukturieren...:O}
\todo{bessere Funktion für Journal bauen: jetzt ist schon 2020!}
Fail...

\newpage

\DayInFeb{Mi}{03}
In /DataLoader dokumentiert. Weiter und SPICE integrieren als ulysses\_traj\_spice.py.\\ \\
Dann Filterung He anschauen (filter\_he.py) und plot\_et.py auschecken.
%
%
%
\end{document}