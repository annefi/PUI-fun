% Chapter Template

\chapter{Data Analysis and Methods} % Main chapter title

\label{Chapter:Data} 

%----------------------------------------------------------------------------------------

%----------------------------------------------------------------------------------------


von den Rohdaten zur 3D VDF
\\ \\
wohin damit? \\ \\
PHA pro Spin...
Ideal / mit Fehlern alpha, beta
\\ , Pile-up, random coincidences/ Schmutztail durch hohe Flüsse
\\
SWICS provides two types of data products from the analogue signals Tof, ESSD and the EPQ-Step.
24-bit



\section{Data products}
PHA words, data transmission

\subsection{Priority weighting}
SWICS performs an on-board mass and mass-per-charge-classification. For every ion with valid measurements the $m$ and $mpq$ are calculated based on the measurements of ESSD, Tof and the particle's EPQ-step using a look-up-table technique.\\
On the one hand these values are used for sorting the ions into predefined boxes in the m-mpq-space which yield in the so-called matrix rate, a second data product that is provided by SWICS.\\
Secondly, and more important for our analysis, the m and mpq information is used to sort every measured ion into one of three priority ranges.

Range, BRW\\ \\
\begin{tabular}{c|c|c}
	%\hline
	Range 0 & $m < 8.7$;  $m_0 : mpq < 3.3$ & $\mathrm{H}$, $\mathrm{He^+}$, $\mathrm{He^{2+}}$; Doubles\\ 
	\hline 
	Range 1 & $m > 8.7$ & Heavier ions \\ 
	\hline 
	Range 2 & $m_0 : mpq > 3.3$ & Doubles \\ 
	%\hline 
\end{tabular} 

\subsection{Detection efficiencies}
Threshold, Doubles...



%
%
%

\section{ET matrices, identification}
Fig. \ref{fig:et_matrix} shows longterm PHA data collected with Ulysses SWICS over two years for EPQ Step 25 (= Energy per charge TODO). For every particle with valid measurements the $\mathrm{E_{SSD}}$ channel is plotted over the ToF channel. As a particle's mass and mass-per-charge is connected to the measured values $EpQ$, $\tau$ and $E_{SSD}$ by equations \ref{eq:swics_set1} --  \ref{eq:swics_set3}, every ion species occupies a distinct position in the so-called \textit{ET-Matrix}. (Counts of different ion species sum up at distinct places in ... space.)


\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/et_matrix.pdf}
	\centering
	\caption{test}
	\label{fig:et_matrix}
\end{figure}


\section{Filter He+}
nominal w based on vsw -> solar wind ions rausfiltern
\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/epq_all.pdf}
	\centering
	\caption{test}
	\label{fig:epq_all}
\end{figure}


For extracting only the $\mathrm{He^+}$ events from the PHA data we plot the events' energy-per-charge over their measured ToF. 
Teilchen derselben mpq werden auf Kurven $todo$ geortet. Spezies höherer Mpq finden sich auf Kurven mit größeren ToF-Werten. Man kann so z.B. todo, todo und todo identifizieren. Unten ist He gut zu erkennen weil suprathermal. An die suprathermalen $He$-Teilchen schließen sich zu höheren ToF andere Teilchen mit derselben mpq auf der gleichen Kurve an. Weil die Kurven dort enger liegen, kann man He in dem Bereich auch nicht von anderen mit ähnlicher mpq unterscheiden.
We can take advantage of SWICS' on-board priority weighting. We only plot the Range0-events. This roughly cuts out events with $m>8.7$. Nur H, He2+, He+ bleiben übrig als prominente Ionen. Man sieht, dass auch einige schwerere in die Box reinlecken, aber das betrifft nicht die ESA-Steps, in denen Helium auftritt.\\
Man kann jetzt prima per Auge eine Maske legen. Zusätzlich w filtern um eventullen Hintergrund zu unterdrücken...?
Man sieht, dass wir nur Helium-PHAs bis EpQ-Step todo auswerten. Der Grund ist, dass He1+ aufgrund der geringen Masse nicht genug Energie hat, die Triggerschwelle des SSDs zu überschreiten. Somit liegen He1+-Ionen bei höheren ESA-Steps (kleineren Energien pro Ladung) als Double Coincidences vor und taugen nicht für unsere Analyse.
\\
Für alle Jahre. Anzahl: todo
\\ \\
Plots: Nur RNG0, He und He2 gefiltert. In einem (dann nochmal und Fabrsala synchron) oder einzeln?
\\
Irgendwo He+, He++ und Protonen markieren


\subsection{Filter He2+}
für die spätere Kalibrierung (todo: Verweis) brauchen wir eine Spezies, bei der wir davon ausgehen, dass sie sich mit dem SW-Bulk bewegt und die als Triple Coinzidences vorliegt (für die Richtungsinformation). We choose He2+ wegen guter Statistik und auch in Range0. Im Gegensatz zu He1+ auch bei höheren ESA-Steps anzutreffen, weil mehr Nachbeschleunigung durch die höhere Ladung. Dadurch nicht so schnell unter SSD-Threshold. Gleiches Verfahren, einfach ausschneiden. Hier ist es nicht so wichtig, alles mitzubekommen, weil wir anhand von He2+ keine Analyse der VDF durchführen wollen. 
\\
Für alle Jahre. Anzahl: todo
\\ \\
Weitere Daten: vsw von SWOOPS, B-Feld
\\ \\
wie viele Daten bleiben über, wie viele PHA-Worte ca. pro Spin?


%
%
%
\section{Collimator/Detector model}

\subsubsection{Motivation}
Kollimatormodell -- warum eigentlich -- wie umgesetzt?\\ \\
Das Ziel ist, einem gemessenen Teilchen einen v-Vektor zuzuordnen. Eine Sek-Det-Kombi ist aber nicht eindeutig. Ihre Bedeutung hängt davon ab, wohin das Instrument guckt (FoV), von der Eigengeschwindigkeit des SC und davon, wie das SC gerade gedreht ist. Zusätzlich hat der Kollimator eine komplizierte Geometrie, sodass eine analytische Lösung schwierig ist: Also numerische Lösung. \\
Was macht das Modell? -- Ich will das FoV zu jedem Zeitpunkt bestimmen. Ich nehme dafür einzelne Messpunkte auf der originalen Geometrie. Dann gebe ich noch ins Modell, wie das gerade ausgerichtet ist.\\
Berechnet anhand des AA, wohin Sun trigger schaut, wenn getriggert wird und rotiert coll. an entsprechende Position für Sek 0. Ordnet entsorechend andere Sektoren an.
Simuliert FoV durch Punkteraster \\
\subsubsection{Construction}
Originalgeometrie beschreiben\\
Konstruktion durch Detektorpunkte
\subsubsection{From FoV to Vspace}
Übergang FoV -> vSpace:
Richtungsinfo aus FoV
Betrag aus EpQ-Steps
außerdem: Eigengeschwindigkeit Ulysses
\subsubsection{EpQ Schalen}




wählbare Anzahlen nrs\_sec usw. Später schreiben, was verwendet wurde (?) ; Steps vsw, asp Winkel
\\ \\
Geometrie, Aspect Angle: Ausrichtung zu jedem Zeitpunkt bekannt
(FoV) (hierher die Kalibration! Nur damit funktioniert die Ausrichtung)
Wir füllen die einzelnen Bereiche mit verschiedenen möglichen Messpunkten\\ \\
Dann nehmen wir PHA-Worte und können jedem ein gemessenes Volumen im Phasenraum zuordnen (?).
\\
Übergang vspace: Dann weiß ich, welche v-Vektoren möglich gewesen sein können, damit dieses PHA-Wort entstanden ist.
\\ \\
Plots: einzelner Sektor -- einmal alles ohne AA -- einmal alles mit AA

%
\begin{figure}
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=1\linewidth]{Figures/col_single_new.pdf}
		\caption{A subfigure}
		\label{fig:sub1}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=1\linewidth]{Figures/col_vspace_normal.pdf}
		\caption{A subfigure}
		\label{fig:sub2}
	\end{subfigure}
	\caption{A figure with two subfigures}
	\label{fig:test}
\end{figure}
%
%
\begin{figure}[h]
	\includegraphics[width=0.5\textwidth]{Figures/col_shells.pdf}
	\centering
	\caption{TODO}
	\label{TODO}
\end{figure}
%%%
%%%
%%%
\subsubsection{Ulysses trajectory, HG system}
\begin{figure}[h]
	\includegraphics[width=1\textwidth]{Figures/HG_coord.pdf}
	\centering
	\caption{TODO}
	\label{TODO}
\end{figure}


\subsubsection{AA motivation}
\begin{figure}[h]
	\includegraphics[width=0.5\textwidth]{Figures/col_aa_marker.png}
	\centering
	\caption{TODO}
	\label{TODO}
\end{figure}
	

\subsubsection{Eigengeschwindigkeit}

\subsubsection{Sunpulse Trigger -- Rotation}


\subsubsection{Calibration Sector}

\subsection{Coordinates}
heliographic, heliocentric? 180 Grad Versatz beschreiben? Drehung mit Eulermatrix
\\ \\
trajectory. \\Orbitdaten gegeben in B.1950... Umrechnung?
\\ \\
verschiedene Koordinatensysteme
\\ \\
durch versch. AA wird unterschiedlicher Teil des v-Raums ausgeleuchtet;
\\ \\
Eigengeschwindigkeit Berechnung (s. Kladde S. 84, 85)
\\ \\ 
TODO:
The orbit itself is described in heliographic coordinates, so a cs that is constant (stable?) with respect to the sun. For describing positions and velocities in the frame of the spacecraft (e.g. AA) we need another cs...
\\ \\
Woher HG Daten und Umrechnung in RTN

\begin{figure}[h]
	\includegraphics[width=1\textwidth]{Figures/RTN_AA_angles.pdf}
	\centering
	\caption{Graphical representation of the RTN coordinate system (not to scale). Shown are the Sun (yellow), the Earth (blue) and the Ulysses spacecraft at a non-specific position on its orbit. $\vec{R}$ is defined as the unit vector along the line-of-sight Sun--Earth, $\vec{T}$ as the normalized cross product $\vec{\omega} x \vec{R}$ with $\vec{\omega}$ the angular velocity of the Sun (yellow vector). $\vec{N}$ completes the right-handed Cartesian system. Also shown is the definition of the aspect angle components $\varphi_{asp}$ and $\vartheta_{asp}$ as they are used in this work. The grey plane depicts the $\vec{R}$--$\vec{T}$ plane. $0 ^\circ < \varphi_{asp} < 90^\circ$ and $-90 ^\circ < \vartheta_{asp} < 0^\circ$ in the shown situation. \textbf{TODO: Zeichnung anpassen: Vektorpfeile, Indizes Winkel; Quelle Ulysses Dingsi}}
	\label{fig:rtn}
\end{figure}
\begin{figure}[h]
	\includegraphics[width=1\textwidth]{Figures/aa_new.pdf}
	\centering
	\caption{The evolution of Ulysses' aspect angle components $\varphi_{asp}$ and $\vartheta_{asp}$ from 1991 to the end of the mission are shown. The aspect angle is the angle between the line-of-sight Ulysses--Sun and the orientation of Ulysses' spin axis. A constantly changing aspect angle results from the fact that the spacecraft's antenna, that is nearly parallel with the spin-axis, has to point towards Earth all the time. Particularly large aspect angles occur during the three fast latitude scans around 1995, 2001 and 2007. Here, Ulysses' distance to Sun and Earth is at a minimum. \textbf{Also shown is the... (todo: raus aus der Zeichnung?)} }
	\label{fig:aa}
\end{figure}
%

%
\subsubsection{RTN Coordinate System}
For dealing with Ulysses' trajectory data it is useful to work with \textit{radial-tangential-normal} coordinates. The RTN coordinate system is defined relative to a moving object in the heliosphere -- in this case the spacecraft, Ulysses, and is centered at the sun. A graphical representation on the system can be found in fig. \ref{fig:rtn}. The unit vectors are $\vec{R}$, $\vec{T}$ and $\vec{N}$, where $\vec{R}$ points radially outward from the sun to the current position of the spacecraft. $\vec{T}$ is defined as the normalized cross product of the Sun's angular velocity $\vec{\omega}$ and $\vec{R}$. $\vec{N}$ completes the right-handed Cartesian coordinate system. Consequently, the RTN system is not defined for a spacecraft's position right above one of the Sun's poles as the cross product $\vec{\omega} x \vec{R}$ is zero here. Nevertheless we do not have to worry about this fact as not even Ulysses crosses the poles directly (todo: Verweis?).
\subsubsection{Calculation of the Aspect Angle}
The aspect angle is measured from the line-of-sight Ulysses--Sun (that is $\vec{R}$) to the line-of-sight Ulysses--Earth. To describe this angle uniquely for any moment, we need two spherical coordinates $\varphi_{asp}$ and $\vartheta_{asp}$ based on the RTN system. As shown in fig. \ref{fig:aa}, $\varphi_{asp}$ is measured in the $\vec{R}$--$\vec{T}$ plane between $-\vec{R}$ and the projection of the line-of-sight from Ulysses to the Earth into this plane. $\varphi_{asp}$  is $0^\circ$ for directions along $-\vec{R}$, that is the line-of-sight from Ulysses to the Sun and increases to positive values towards $-\vec{T}$. $\vartheta_{asp}$ is the angle between the projection of the line-of-sight from Ulysses to the Earth into the $\vec{R}$--$\vec{T}$ plane and the line-of-sight itself. It is defined as $0^\circ$ for directions that lie within the $\vec{R}$--$\vec{T}$ plane and $+90^\circ$ for directions along $\vec{N}$.\\
(Todo: Lars fragen, ob die genaue Rechnung hier rein muss, Kladde S. 79)
For the calculation of the aspect angle we used the Ulysses trajectory data (Verweis ... TODO) and Earth trajectory data in heliographic coordinates on a daily basis from \citet{nasa-earth-coord} and converted both to RTN coordinates. In fig. \ref{fig:aa} both components $\varphi_{asp}$ and $\vartheta_{asp}$ as well as the \textit{flat} aspect angle $\alpha$ with  $\alpha = \arccos(\cos{\varphi_{asp}}) + \arccos(\cos{\vartheta_{asp}}) -1$ are shown over the time of the mission. $\varphi_{asp}$ varies in the range from $\sim - 25^\circ$ to $\sim 42^\circ$ and $\vartheta_{asp}$ in a range from $\sim - 30^\circ$ to $\sim 17^\circ$. Large angles occur especially around the three fast latitude scans, i.e. when Ulysses is at its perihelion and has the smallest distance to Sun and Earth.\\
(Todo? Beschreiben, dass ich $\alpha$ mit dem Datenprodukt SPE verglichen habe?)














%
\subsection{Calibration}
\subsubsection{Calibration AA}
\begin{figure}[h]
	\includegraphics[width=0.5\textwidth]{Figures/hist_det_sec_aa_90days2001}
	\centering
	\caption{TODO}
	\label{TODO}
\end{figure}
Plots: \\ 
Verweis auf AA-Plot oben: Dazu Hist-Det -- dann Schemazeichnung SunPulser, dazu Problem irgendwie zeigen
\\ \\
zeigen, dass mit größeren AA vermehrt äußerer Detektor angesprochen wird; 
\\ \\
Problem: sectors are not triggered uniformly (?). Every spin sector 0 is triggered newly. koplanare Lage der drei Vektoren: Spinachse, Sensor, SC-Sun, \textit{when sun crosses the ...plane of the SC}\\
Allover Blick: Sector, der gegnüber liegt, sollte besonders prominent sein
\\ \\
Kalibrierung: He2+, Det-Sec-Histogramme -- Suche nach Sek 0
\\ Hiscale Paper: Sensoren sind umgebaute Albedo-Sensoren
\\ \\
(...) For verifying this angle we use a species for which we know the direction of velocity. That is He2+ that we assume to be flowing radially with the solar wind
\\ \\
Kalibration Detektoren: Für große AA zeigen, dass äußerer Det angesprochen wird
\\ \\
Kalibration Sektoren: Nur bei sehr großen AA möglich (äußerer od. mittlerer Detektor), weil beim inneren der Bulk auf allen landet.
\\ \\
Sektorgeschichte, Sunpulser...


%
%
%
\section{VDF}
Zweifache Beschränkung im w-Space: Bei kleinem w: keine hohen Steps (kleine Geschwindigkeiten) durch das unter-den-Threshold-Rutschen (deshalb können wir auch keinen langsamen SW untersuchen). Bei hohem w: Ende der Schalen (Step 0: 1708.5 km/s)
%
\subsection{Velocity Space Coverage}
vom FoV zum Vspace: Invertieren $\Rightarrow$ Akzeptanz im V-Raum

%
\subsection{Phasenraumnormierung}
Mittlere Phasenraumdichte in einem Bin, in den zwei Instrumentenbins A und B reingehen:
(differential PSD)
\begin{align}
\bar{\rho} = \frac{N_A + N_B}{\frac{N_A}{N_{A,ges}} V_A + \frac{N_B}{N_{B,ges}} V_B }
\end{align}
Dabei ist $N_i$ die Anzahl der Hits, die im Messbin gelandet sind und $N_{i,ges}$ die gesamte Anzahl an Bins. Hits heißt GEsamtcounts durch Detektoranzahl. Eigentlich gebe ich statt $N_i$ $N_i \cdot Detektoranzahl$ rein, aber das kürzt sich ja raus.\\ \\
Effizienz und Sektorgewichte dazu:\\
Allg.:
\begin{align*}
\rho = \frac{N \cdot brw}{V \cdot Eff}
\end{align*}
Und dann
\begin{align}
\bar{\rho} = \frac{N_A + N_B}{\frac{N_A}{N_{A,ges}} \frac{V_A \cdot eff_A}{brw_A} + \frac{N_B}{N_{B,ges}} \frac{V_B \cdot eff_B}{brw_B} }
\end{align}
Unsicherheit EpQ: Delta v. Rechnung fehlerfortpflanzung Kladde S. 84


%
%
%
\section{Und dann so}
Ich hab jetzt ein Set von v-Komponenten pro PHA-Event. Daraus kann ich berechnen:
(mit: In Komponenten aufgeteilt kann man jetzt Geschwindigkeit im SW-frame berechnen, indem man vsw in R-Richtugn abzieht)
\begin{itemize}
	\item Betrag im SW frame
	\item Winkel im w-space (SW frame)
\end{itemize}
B-Feld. Von welchem Instrument? auch RTN-System. Genauso Winkel berechnet.\\
1-min-Mittel (Gyroradius Zeit zeigen) und entsprechend EpQ-Steps den PHAs zugeordnet.


%
%
%
\section{Results}
\subsection{Slices}
\subsection{Skymaps}
\subsection{1D}



%
%
%
\section{Outlook}
\begin{itemize}
	\item Efficiency müsste genau bestimmt werden: Dabei berücksichtigen, welcher Anteil unter den Threshold wandert. Evtl. überschätzen wir die Eff., wenn wir die interpolierten Werte von ACE/SWICS nehmen.
	\item B-Feld-spezifische Untersuchung: Torus
	\item Radialabhängigkeit: adiabatic Cooling, PA-Scattering

\end{itemize}







\subsection{Loose Ends}
\begin{itemize}
	\item andere Daten: B, vsw (Swoops: als vsw wird Protonengeschw. genommen. Ist das überhaupt richtig, ist das der Referenzframe? Und Annahme, dass vsw rein radial ist)
	\item Die Sache mit dem BRW ab 2003
\end{itemize}
