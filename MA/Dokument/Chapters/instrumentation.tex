% Chapter Template

\chapter{Instrumentation} % Main chapter title

\label{ChapterInstrumentation} 

%----------------------------------------------------------------------------------------

%----------------------------------------------------------------------------------------

\section{Ulysses}
\label{sec:ulysses}
The Ulysses spacecraft \citep{wenzel_ulysses} was launched in 1990 and orbited the sun for nearly 20 years as a joint ESA/NASA project.
Ulysses' most remarkable feature is its out-of-ecliptic orbit with an maximum heliographic latitude of $80.1\,^\circ$.
As the first spacecraft it was hence capable of taking in situ measurements from above the poles of the sun.\\
The primary goal of the mission was to study the heliosphere in three dimensions. Some of the original main objectives were:
\begin{itemize}
	\item to study the interplanetary magnetic field and the solar wind, especially its composition, the origin and waves and shocks within the solar wind plasma
	\item to investigate galactic cosmic rays and energetic particles
	\item to improve the knowledge about interplanetary dust
	\item to explore the neutral component of interstellar gas
\end{itemize}
Some secondary objectives included e.g. the investigation of Jupiter's magnetosphere during the Jupiter flyby and the search for gravitational waves and for gamma-ray burst sources \citep{wenzel_ulysses}.
\\
For these aims Ulysses was equipped with a wide range of different instruments and antennas. One of the in situ instruments is the Solar Wind Ion Composition Spectrometer (SWICS), that will be described in the next section.\\
A sketch of Ulysses' unique orbit is shown in figure \ref{fig:trajectory}.
Ulysses was launched in October 1990 and left earth's gravitational field with $15.4\,\mathrm{km/s}$. Starting with a flyby manoeuvrer around Jupiter Ulysses was sent onto its highly elliptical orbit.
With an orbital period of 6.2 years Ulysses completed nearly three orbits around the sun until communication was shut down in June 2009 due to the expiring of the radioisotope thermal generators.
Within the mission's long lifetime the Sun's behaviour over its activity cycle of 22 years could be studied.\\
Ulysses is a spin-stabilized spacecraft that spins at $5\,\mathrm{rpm}$. The spin axis is aligned with the high-gain antenna's electrical axis, that provides a communication link from the spacecraft to Earth. The downlink bitrate was variable with up to $1024\,\mathrm{bit/s}$ during real-time connection.
\begin{figure}[h]
	\includegraphics[width=0.8\textwidth]{Figures/ulysses_trajectory.pdf}
	\centering
	\caption{A sketch of Ulysses' first orbit. After the launch from earth in 1990 the spacecraft was sent to Jupiter from where it left the ecliptic on an elliptical orbit around the sun with perihelion at $1.3\,\mathrm{AU}$ and aphelion at $5.4\,\mathrm{AU}$. Due to the orbit's high latitude of $\sim 80 \, ^\circ$ Ulysses crosses the Sun's pole regions two times between 1994 and 1996. Figure after \citet{esa_orbit}.}
	\label{fig:trajectory}
\end{figure}
.
\\ \\ 
TODO: Importance PUIs: ref to PUI-Kapitel und zu objectives; Tempus
%
%
%
%
%
\section{SWICS}

\subsection{Introduction and Objectives}
The Solar Wind Ion Composition Spectrometer (SWICS, \citet{gloeckler_1992}) is a time-of-flight mass spectrometer mounted on the spacecraft Ulysses (s. sec. \ref{sec:ulysses}). The instrument is designed to determine the elemental and charge-state composition and the velocity distribution of solar wind ions. With an energy-per-charge range from $0.16 \, \mathrm{kV}$ to $59.6 \, \mathrm{kV}$ SWICS is in principle able to measure every solar wind ion species from protons to iron with any typical charge state. Depending on the individual ion, particle energies from $1 \,\mathrm{keV}$ up to $1 \, \mathrm{MeV}$ are covered.
\\ \\
Additionally, the flight spare of SWICS has been mounted on the spacecraft ACE (TODO: ref Stone 1998)
\\ \\ 
Also capable of measuring PUIs! Erstmals gesehen...?
\\ \\
SWICS measures the mass $m$, the charge $q$ and the energy $E_{SSD}$ of entering ions by a combination of three separate measurements: The \textit{electrostatic deflection analyzer} within SWICS entrance systems is used for determining the energy per charge of a particle. Within the time-of-flight/energy section the particle's time-of-flight ($ToF$) and energy ($E_{SSD}$) are measured. \\ 
Todo: Bild von SWICS, neben den beiden sieht man noch die Elektronik...
\\ \\
mounted on the sun-facing side of Ulysses
\\ \\
Opening angles: $\pm\, 2$ deg perp, $90$ deg parallel  
\\ \\
Richtungsauflösung Detektoren
\\ \\ 
In the following section the measurement is described in more detail.
\subsection{Principle of Measurement / Identification of Particles}
\label{subsec:measurement}
\begin{figure}[h]
	\includegraphics[width=0.8\textwidth]{Figures/Lars_Swics.png}
	\centering
	\caption{test}
	\label{fig:lars_swics}
\end{figure}


\begin{figure}[h]
	\includegraphics[width=0.8\textwidth]{Figures/swics_sensor.pdf}
	\centering
	\caption{test}
	\label{fig:sensor_swics}
\end{figure}
\subsubsection{Collimator and Electrostatic Analyzer}
\label{sec:EpQ}
Particles enter the instrument through the entrance collimator. It restricts particles to the ones with a trajectory that is parallel to the collimator slits. The geometry of the collimator is curved "fan-shaped"...TODO: Kollimatorgeometrie beschreiben \\
Within the TODO: Two sections
After the collimator particles have to pass the electrostatic analyzer. It is split up into two sections -- energies from $0.16$ to $14\,\mathrm{keV/e}$ are covered by the proton/helium channel. Particles within this range of energy will be filtered by their EpQ and after an post-acceleration will be counted by a solid-state detector. 
As this simple measurement principle is very limiting for our analysis we will focus on the main channel that is suitable for a full $m$-vs.-$mpq$ analysis.
The main channel covers an EpQ range of $0.65$ to $60\,\mathrm{keV/e}$. A particle can only pass through the pair of curved deflection plates if its kinetic energy per charge equals a certain ratio that is given by the voltage between the two plates. To measure particles of different EpQ the deflection voltage is stepped through 64 logarithmically spaced values from TODO to TODO. As the voltage steps once per spin of Ulysses (every 12 seconds), a complete voltage cycle lasts $\sim$ 12.8 minutes. 
Every step has a relative uncertainty of $\Delta E/q \approx 5\%$ that is due to the finite space between the plates. TODO: Plot
\begin{figure}[h]
		\centering
		\includegraphics[scale = 0.7]{Figures/epq_err.pdf}
		\caption{Energy-per-Charge steps of Ulysses SWICS. A voltage cycle starts with step 0 that is the highest voltage $EpQ = 60.51\, \mathrm{kV}$. Voltage is then swept down 64 logarithmically spaced steps up to $EpQ = 0.66\, \mathrm{kV}$. The uncertainty of the single steps is $\frac{\Delta EpQ}{EpQ} = 5\%$ and drawn in lighter color.
		} \label{fig:epq}
\end{figure}
  
\subsubsection{Time-of-flight measurement}
After passing the electrostatic analyzer ions are post-accelerated by an constant potential drop of ~$30\,\mathrm{kV}$. They enter the ToF chamber with penetrating through a thin ($\sim 3\,\mu \mathrm{g / cm^2}$) carbon foil where secondary electrons are emitted. These electrons are guided to a microchannel plate detector where a start signal is triggered. The stop signal is triggered after the particles have traversed a distance of $10\,\mathrm{cm}$ and hit one of the solid state detectors, where secondary electrons are emitted again. By combining the time stamps of the start and the stop signal the particle's ToF has been measured.
\subsubsection{Energy measurement}
Furthermore, the particle's energy is measured when they hit one of the three solid state detectors (SSD). The detectors have each an active area of $1.5 x 1.3 \,\mathrm{cm^2}$ and their orientation of the detectors can be seen in TODO. While the central detector is aligned perpendicular to the symmetry axis of SWICS, the other two detectors are slightly tilted with respect to this axis. Particles with different angles of incidence along the width of the collimator can be detected this way.
\\ \\
Thus, a wide field-of-view is provided, allowing measurements of particles, die schief reinkommen. Das passt zur Begrenzung vom Kollimator. Man kann auch unterscheiden, welcher getroffen wurde.\\
Verfälschungen? Folie etc? \\ 
The measured energy $E_{SSD}$ is often referred to as \textit{residual energy} in literature. This is potentially misleading as the particles might have more energy due to the post-acceleration 
%%%
\\ \\ \\
One of SWICS' main objectives is the measurement of the composition of incident particles. An ion and its charge state can be fully identified with the knowledge of its mass $m$ and its mass-per-charge $mpq$. 
With the measurement of the ToF, the energy $E_{SSD}$ and the knowledge of the EpQ-step we can calculate the mass, mpq and velocity of an ion $i$ with the following set of equations:
\begin{align}
m_i &= 2\,E_{SSD} \left( \frac{Tof}{d}\right)^2 \label{eq:swics_set1}\\
\frac{m_i}{q_i} &= 2 \left(EpQ + V_{PAC}\right) * \left(\frac{Tof}{d}\right)^2 \label{eq:swics_set2} \\
v_i &= \sqrt{2\,EpQ\,\frac{q_i}{m_i}},
\label{eq:swics_set3}
\end{align}
where $d$ is the length of the time-of-flight section and $V_{PAC}$ is the post-acceleration voltage. $v$ denotes the ion's initial velocity when entering the instrument and is not to be confused with its velocity during the time-of-flight measurement, that is altered particularly by the post-acceleration.
\\ \\ \\HISCALE: "The experiment provides information about the spatial origin of events by treating each spin as eight sectors of approximately equal duration."





\section{Data products}
Direct Pulse-Height Analysis data (PHA data) is one of SWICS' data products and the one that is most relevant for the analysis in this work.\\
SWICS steps through the 64 energy-per-charge steps of the electrostatic analyzer (s. sec \ref{sec:EpQ}) over one so-called voltage cycle. At normal spacecraft telemetry rates SWICS steps once per spin, which is once every $12\,\mathrm{s}$. During these times 30 PHA words per spin are selected based on a priority scheme (s.b.) and transmitted.\\
Every 24-bit PHA word contains following information on an incident particle that triggered a valid measurement:
\begin{itemize}
	\item $E_{SSD}$: Energy deposition in the solid state detector \\
	measured through 256 channels in a range $40 - 600\,\mathrm{keV}$
	\item $ToF$: Time-of-Flight\\
	measured through 1024 channels in a range $10 - 200\,\mathrm{ns}$
	\item Sector information:\\
	SWICS divides up one spin of Ulysses into 8 sectors of $45^\circ$.
	\item Detector information: \\
	Which of the three solid state detector elements has been triggered?
	\item Priority category: \\
	Due to limited telemetry an assorted sample of all measured particles can be transmitted. This selection is based on different priorities. For details s. sec \ref{subsec:prio}.
\end{itemize}
The interpretation of a set of PHA words that have been collected over time is discussed in sec. \ref{sec:etmatrices}. 
%
\subsection{Detection Efficiency}
(Frage Lars: Welche Wahrscheinlichkeit genau gibt die E. an? Ausgehend von einem Teilchen vor dem Instrument mit der richtigen Epq? Von einem Teilchen, das den EpQ Filter durchlaufen hat?)\\ \\
The detector efficiency is the probability to measure a particle that has entered the instrument(?). 
When working with SWICS -- like for any physical measurement -- one has to consider several effects that impede the ideal measurement as it is described in sec. \ref{subsec:measurement}. 
These effects are highly dependent on the ion species and deflection step and include for example that secondary electrons for the time of flight measurement may not be emitted properly from carbon foil and SSD. Also, ions could pass through the time of flight section on divergent trajectories due to scattering processes (in the carbon foil??). Possibly, the ion then does not hit the sensitive area of the solid state detector and does neither trigger a stop signal for the time of flight measurement nor a valid energy measurement in the solid state detector.\\
Another reason for a missing valid energy measurement in the solid state detector can be that the ion's energy is smaller than the threshold of the solid state detector. In this case, only energy-per-charge and time-of-flight information for the ion are available. Such events without a corresponding energy measurement are called double coincidences, while events with triggered start and stop signal and a energy measurement are called triple coincidences.\\
The reason for choosing a non-zero threshold is to limit the influence of the solid state detector's natural noise. For SWICS this noise level is quite high, at around $12\,\mathrm{keV}$ \citep{gloeckler_1992} (todo: ?), so that the threshold is chosen to be $\sim 30 \, \mathrm{keV}$. Ions with a small mass and charge are most likely to not overcome this threshold at low energy-per-charge values. For the bulk of $\mathrm{He^{+}}$ this is already the case for deflection step number 17 ($EpQ = 17.86\,\mathrm{kV}$), which corresponds to a $\mathrm{He^{+}}$ velocity of $v = 900\,\mathrm{km\,s^{-1}}$ (s. eq. TODO).\\
Unfortunately, $\mathrm{He^{+}}$ detection efficiencies are not known to us for Ulysses SWICS. Instead, we make use of the efficiencies from ACE SWICS, that have been calculated by \citet{koeten}. As ACE SWICS uses different energy-per-charge ranges we had to extrapolate the values for Ulysses SWICS.
For the highest energy-per-charge value $EpQ = 60.51\,\mathrm{keV}$ we interpolated the efficiency from the ACE $\mathrm{He^{+}}$ triple efficiencies and then extrapolated linearly to an efficiency of 0 at energy-per-charge step 17. By this, we accommodate for the above mentioned fact that $\mathrm{He^{+}}$ does not have enough energy to deposit energy above the solid state detector's threshold at deflection step 17 and thus, the probability for a triple coincidence is zero (Todo: Verweis auf anderes Kapitel: Coverage). $\mathrm{He^{+}}$ efficiencies from ACE SWICS and the resulting efficiencies used for Ulysses SWICS are shown in fig. \ref{fig:guess_eff}. For sure, these values are not realistic but represent the overall trend of a decreasing efficiency for higher energy-per-charge steps.
\begin{figure}[h]
	\includegraphics[width=1.\textwidth]{Figures/guess_eff.pdf}
	\centering
	\caption{$\mathrm{He^{+}}$ detection efficiencies for ACE SWICS over all energy-per-charge steps from $0.66\,\mathrm{kV}$ to $86.64\,\mathrm{kV}$. For Ulysses SWICS the efficiencies have been extrapolated between 0 for $EpQ$ step 17 ($17.86\,\mathrm{kV}$) and the highest efficiency for $EpQ$ step 0 ($60.51\,\mathrm{kV}$). The latter value has been interpolated from the ACE efficiencies.}
	\label{fig:guess_eff}
\end{figure}


\subsection{Priority Weighting}
\label{subsec:prio}
SWICS' data processing unit performs an on-board mass and mass-per-charge-classification. For every ion with valid measurements the $m$ and $mpq$ are calculated based on the measurements of ESSD, Tof and the particle's EPQ-step using a look-up-table technique.\\
On the one hand these values are used for sorting the ions into predefined boxes in the m-mpq-space which yield in the so-called matrix rate, a second data product that is provided benath the PHA words.\\
Secondly, and more important for our analysis, the m and mpq information is used to sort every measured ion into one of three priority ranges. Due to a limited telemetry possibly not every measured particle can be transmitted as a PHA word. 
30 PHA words per spin are chosen from these ranges in way that the ratio of low and high priority PHA words is balanced. By this selection less abundant heavier ions are artificially enhanced which is necessary to recreate the measured composition from the transmitted PHA words. Table \ref{tab} shows summarized the priority scheme. Details about this can be found in \citet{gloeckler_1992}.\\
To account for the priority biased selection of PHA words it is necessary to weight the transmitted data with the so-called base-rate weight $brw = \frac{D_{\mathrm{PHA}}}{T_{\mathrm{PHA}}}$, where $T_{\mathrm{PHA}}$ is the number transmitted PHA words and $D_{\mathrm{PHA}}$ the number of detected particles on which this PHA word is based. The measured composition can be restored in this way.
\begin{table}[h]
	\caption{SWICS' priority categorization scheme} 
	\centering
	\begin{tabular}{c|c|c}
		%\hline
		Range 0 & $m < 8.7$;  $m_0 : mpq < 3.3$ & $\mathrm{H}$, $\mathrm{He^+}$, $\mathrm{He^{2+}}$; Doubles\\ 
		\hline 
		Range 1 & $m > 8.7$ & Heavier ions \\ 
		\hline 
		Range 2 & $m_0 : mpq > 3.3$ & Doubles \\ 
		%\hline 
	\end{tabular} 
	\label{tab}
\end{table}
%
%
%
\section{ET matrices, identification}
\label{sec:etmatrices}
Fig. \ref{fig:et_matrix} shows longterm PHA data collected with Ulysses SWICS over two years for energy-per-charge step 25 (which is $10.05\,\mathrm{kV}$). For every particle with valid measurements the $\mathrm{E_{SSD}}$ channel is plotted over the ToF channel. As a particle's mass and mass-per-charge is connected to the measured values $EpQ$, $\tau$ and $E_{SSD}$ by equations \ref{eq:swics_set1} --  \ref{eq:swics_set3}, every ion species occupies a distinct position in the so-called \textit{ET-Matrix}. (Counts of different ion species sum up at distinct places in ... space.)


\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/et_matrix.pdf}
	\centering
	\caption{test}
	\label{fig:et_matrix}
\end{figure}


\subsection{Filter He+}
nominal w based on vsw -> solar wind ions rausfiltern
\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/epq_all.pdf}
	\centering
	\caption{test}
	\label{fig:epq_all}
\end{figure}


For extracting only the $\mathrm{He^{+}}$ events from the PHA data we plot the events' energy-per-charge over their measured ToF. 
Teilchen derselben mpq werden auf Kurven $todo$ geortet. Spezies höherer Mpq finden sich auf Kurven mit größeren ToF-Werten. Man kann so z.B. todo, todo und todo identifizieren. Unten ist He gut zu erkennen weil suprathermal. An die suprathermalen $\mathrm{He^{+}}$-Teilchen schließen sich zu höheren ToF andere Teilchen mit derselben mpq auf der gleichen Kurve an. Weil die Kurven dort enger liegen, kann man He in dem Bereich auch nicht von anderen mit ähnlicher mpq unterscheiden.
We can take advantage of SWICS' on-board priority weighting. We only plot the Range0-events. This roughly cuts out events with $m>8.7$. Nur H, He2+, He+ bleiben übrig als prominente Ionen. Man sieht, dass auch einige schwerere in die Box reinlecken, aber das betrifft nicht die ESA-Steps, in denen Helium auftritt.\\
Man kann jetzt prima per Auge eine Maske legen. Zusätzlich w filtern um eventullen Hintergrund zu unterdrücken...?
Man sieht, dass wir nur Helium-PHAs bis EpQ-Step todo auswerten. Der Grund ist, dass He1+ aufgrund der geringen Masse nicht genug Energie hat, die Triggerschwelle des SSDs zu überschreiten. Somit liegen He1+-Ionen bei höheren ESA-Steps (kleineren Energien pro Ladung) als Double Coincidences vor und taugen nicht für unsere Analyse.
\\
Für alle Jahre. Anzahl: todo
\\ \\
Plots: Nur RNG0, He und He2 gefiltert. In einem (dann nochmal und Fabrsala synchron) oder einzeln?
\\
Irgendwo He+, He++ und Protonen markieren


\subsection{Filter He2+}
für die spätere Kalibrierung (todo: Verweis) brauchen wir eine Spezies, bei der wir davon ausgehen, dass sie sich mit dem SW-Bulk bewegt und die als Triple Coinzidences vorliegt (für die Richtungsinformation). We choose He2+ wegen guter Statistik und auch in Range0. Im Gegensatz zu He1+ auch bei höheren ESA-Steps anzutreffen, weil mehr Nachbeschleunigung durch die höhere Ladung. Dadurch nicht so schnell unter SSD-Threshold. Gleiches Verfahren, einfach ausschneiden. Hier ist es nicht so wichtig, alles mitzubekommen, weil wir anhand von He2+ keine Analyse der VDF durchführen wollen. 
\\
Für alle Jahre. Anzahl: todo
\\ \\
Weitere Daten: vsw von SWOOPS, B-Feld
\\ \\
wie viele Daten bleiben über, wie viele PHA-Worte ca. pro Spin?
\\ \\
woher sind die Daten?
\\ \\
wohin damit? \\ \\
PHA pro Spin...
Ideal / mit Fehlern alpha, beta
\\ , Pile-up, random coincidences/ Schmutztail durch hohe Flüsse
\\
SWICS provides two types of data products from the analogue signals Tof, ESSD and the EPQ-Step.
24-bit
%
%
%

