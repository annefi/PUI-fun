% Chapter Template

\chapter{Instrumentation} % Main chapter title

\label{chapter:instrumentation} 

%----------------------------------------------------------------------------------------

%----------------------------------------------------------------------------------------

\section{Ulysses}
\label{sec:ulysses}
The Ulysses spacecraft \citep{wenzel_ulysses} was launched in 1990 and orbited the sun for nearly 20 years as a joint ESA/NASA project.
Ulysses' most remarkable feature is its out-of-ecliptic orbit with a maximum heliographic latitude of $80.1\,^\circ$.
As the first spacecraft it was hence capable of taking in situ measurements from above the poles of the sun.\\
The primary goal of the mission was to study the heliosphere in three dimensions. Some of the original main objectives were:
\begin{itemize}
	\item to study the interplanetary magnetic field and the solar wind, especially its composition, the origin and waves and shocks within the solar wind plasma
	\item to investigate galactic cosmic rays and energetic particles
	\item to improve the knowledge about interplanetary dust
	\item to explore the neutral component of interstellar gas
\end{itemize}
Some secondary objectives included e.g. the investigation of Jupiter's magnetosphere during the Jupiter flyby and the search for gravitational waves and for gamma-ray burst sources \citep{wenzel_ulysses}.
\\
For these aims Ulysses was equipped with a wide range of different instruments and antennas. One of the in situ instruments is the Solar Wind Ion Composition Spectrometer (SWICS), that will be described in the next section.\\
A sketch of Ulysses' unique orbit is shown in figure \ref{fig:trajectory}.
Ulysses was launched in October 1990 and left earth's gravitational field with $15.4\,\mathrm{km/s}$. Starting with a flyby manoeuvrer around Jupiter Ulysses was sent onto its highly elliptical orbit.
With an orbital period of 6.2 years Ulysses completed nearly three orbits around the sun until communication was shut down in June 2009 due to the expiring of the radioisotope thermal generators.
Within the mission's long lifetime the Sun's behaviour over its activity cycle of 22 years could be studied.\\
Ulysses is a spin-stabilized spacecraft that spun at $5\,\mathrm{rpm}$. The spin axis is aligned with the high-gain antenna's electrical axis, that provided a communication link from the spacecraft to Earth. The downlink bitrate was variable with up to $1024\,\mathrm{bit/s}$ during real-time connection.
\\ \\ 
TODO: Importance PUIs?
\begin{figure}[h]
	\includegraphics[width=0.8\textwidth]{Figures/ulysses_trajectory.pdf}
	\centering
	\caption{A sketch of Ulysses' first orbit. After the launch from earth in 1990 the spacecraft was sent to Jupiter from where it left the ecliptic on an elliptical orbit around the sun with perihelion at $1.3\,\mathrm{AU}$ and aphelion at $5.4\,\mathrm{AU}$. Due to the orbit's high latitude of $\sim 80 \, ^\circ$ Ulysses crossed the Sun's pole regions two times between 1994 and 1996. Figure after \citet{esa_orbit}.}
	\label{fig:trajectory}
\end{figure}
%
%
%
%
%
\section{SWICS}
\label{sec:swics}


\begin{figure}
	\centering
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=0.9\linewidth]{Figures/ULYSSES-SWICS.jpg}
	\end{subfigure}%
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=1.1\linewidth]{Figures/swics_sensor.pdf}
	\end{subfigure}
	\caption{\\ \textit{Left:} Photograph of the SWICS instrument. The fan-shaped collimator on top of the electrostatic deflection analyzer can bee seen on the right. It is followed by the cylindrically shaped and silvery coloured \textit{high-voltage bubble}, that contains the time-of-flight system, analog electronics and and the sensor power supply. The gold-plated cylinder houses a $-30\,\mathrm{kV}$ voltage supply. The opening angles of the collimator are $69^\circ$ in width and $4^\circ$ in height. OPT: Ausschneiden und beschriften \\ \textit{Right:} Schematic cut through the sensor. In this view the orientation of the three solid state detectors is visualized. OPT: farbig markieren\\ Both figures are from from \citet{gloeckler_1992}.}
	\label{fig:swics}
\end{figure}

The Solar Wind Ion Composition Spectrometer (SWICS, \citet{gloeckler_1992}) is a time-of-flight mass spectrometer mounted on the spacecraft Ulysses (s. sec. \ref{sec:ulysses}). The instrument is designed to determine the elemental and charge-state composition and the velocity distribution of solar wind ions. With an energy-per-charge range from $0.16 \, \mathrm{kV}$ to $59.6 \, \mathrm{kV}$ SWICS is able to measure every solar wind ion species from protons to iron with any typical charge state. Depending on the individual ion, particle energies from $1 \,\mathrm{keV}$ up to $1 \, \mathrm{MeV}$ are covered.\\
SWICS is mounted on the sun-facing side of Ulysses and revolves around the spacecraft's spin axis with the spacecraft spinning. A photograph of the instrument is shown in fig. \ref{fig:swics}, left.\\
Ulysses SWICS also has a twin instrument that is the SWICS spare model, which has been mounted on the ACE spacecraft \citep{stone_ace}.
\\ \\ 
TODO: Super für measuring PUIs! viele wichtige Messungen... \\ \\
%
%
%
SWICS measures the mass $m$, the charge $q$ and the energy $E$ of entering ions by a combination of three separate measurements: The electrostatic deflection analyzer within the entrance systems is used for determining the energy-per-charge of a particle. Within the time-of-flight/energy section the particle's time-of-flight and residual energy are measured. A more detailed description of the measurement is given in the next sections. A particle's trajectory through the instrument can be tracked in the schematic in fig. \ref{fig:lars_swics}.
%
\subsection{Collimator and Electrostatic Analyzer}
\label{sec:EpQ}
Particles enter the instrument through the entrance collimator. It restricts particles to the ones with a trajectory that is parallel to the collimator slits.  The collimator follows an intricate geometry that is fan-shaped with an opening angle of $69^\circ$ in width and $4^\circ$ in height and that is at the same time curved along its width. Fig. \ref{fig:swics}, left,  gives an idea of the shape.\\
After having entered through the collimator a particle has to pass the electrostatic analyzer. It is split up into two sections -- energies-per-charge from $0.16$ to $14\,\mathrm{kV}$ are covered by the proton/helium channel. Particles within this range of energy will be filtered by their energy-per-charge and after an post-acceleration will be counted by a solid-state detector. As this simple measurement principle is very limiting for our analysis we will focus on the main channel that is suitable for a full \textit{mass/mass-per-charge} analysis.\\
The main channel covers an energy-per-charge range of $0.66$ to $60.51\,\mathrm{kV}$. A particle can only pass through the pair of curved deflection plates if its kinetic energy-per-charge equals a certain ratio that is given by the voltage between the two plates. To measure particles of different energy-per-charge the deflection voltage is stepped through 64 logarithmically spaced values, s. fig \ref{fig:epq}. As the voltage steps once per spin of Ulysses (every $12\,\mathrm{s}$), a complete voltage cycle lasts $\sim$ 12.8 minutes. 
Every step has a relative uncertainty in energy-per-charge of $\Delta \mathrm{EpQ / EpQ = 5\%}$  that is due to the finite space between the plates.
%
%
%
\begin{figure}[h]
	\includegraphics[width=0.8\textwidth]{Figures/Lars_Swics.png}
	\centering
	\caption{Schematic view of the SWICS detector. See text for reference. This figure is taken from \citet{lars-phd}.}
	\label{fig:lars_swics}
\end{figure}

%
\begin{figure}[h]
		\centering
		\includegraphics[scale = 0.7]{Figures/epq_err.pdf}
		\caption{Energy-per-Charge steps of Ulysses SWICS. A voltage cycle starts with step 0 that is the highest voltage $EpQ = 60.51\, \mathrm{kV}$. Voltage is then swept down 64 logarithmically spaced steps up to $EpQ = 0.66\, \mathrm{kV}$. The uncertainty of the single steps is $\frac{\Delta EpQ}{EpQ} = 5\%$ and drawn in lighter color.
		} \label{fig:epq}
\end{figure}
%
%
%
\subsection{Time-of-flight measurement}
After having passed the electrostatic analyzer the ion is post-accelerated by an constant potential drop of ~$30\,\mathrm{kV}$. It enters the time-of-flight chamber with penetrating through a thin ($\sim 3\,\mu \mathrm{g / cm^2}$) carbon foil from which secondary electrons are emitted. These electrons are guided to a microchannel plate detector where a start signal is triggered (s. fig \ref{fig:lars_swics}). The stop signal is triggered after the ion has traversed nearly force free a distance of $10\,\mathrm{cm}$ through the vacuumized time-of-flight section. Here it hits one of the solid-state detectors, where secondary electrons are emitted again. By combining the times of the start and the stop signal the particle's time-of-flight has been measured.
\subsection{Energy measurement}
Additionally, the ion's energy is measured when they hit one of the three solid state detectors. \\
A solid-state detector is realized by applying an inverse bias voltage to a semiconductor material. When ionized particles hit the material, they set free charge carriers from the resulting depletion zone. These charge carriers can be measured as a pulse of current which is proportional to the deposited energy of the ion. \\
Each of the three detectors has an active area of $1.5 x 1.3 \,\mathrm{cm^2}$. Their alignment with each other can be seen in fig \ref{fig:swics}, right: While the central detector is oriented perpendicular to the symmetry axis of SWICS, the other two detectors are slightly tilted with respect to this axis. This way particles with different angles of incidence along the width of the collimator can be detected. The information on which of the three detectors has been hit will be utilized in chapter \ref{chapter:data} for a coarse directional resolution of incident particles.
\\ \\
One of SWICS' main objectives is the measurement of the composition of incident particles. An ion and its charge state can be fully identified with the knowledge of its mass $m$ and its mass-per-charge $mpq$. 
With the measurement of the time-of-flight $ToF$, the energy $E_{SSD}$ and the knowledge of the energy-per-charge $EpQ$ we can calculate the mass $m$, the mass-per-charge $mpq$ and velocity $v$ of an ion $i$ with the following set of equations:
\begin{align}
m_i &= 2\,E_{SSD} \left( \frac{Tof}{d}\right)^2 \label{eq:swics_set1}\\
mpq_i &= 2 \left(EpQ + V_{PAC}\right) \cdot \left(\frac{Tof}{d}\right)^2 \label{eq:swics_set2} \\
v_i &= \sqrt{2\,EpQ\,\frac{1}{mpq_i}},
\label{eq:swics_set3}
\end{align}
where $d$ is the length of the time-of-flight section and $V_{\mathrm{PAC}}$ is the post-acceleration voltage. $v$ denotes the ion's initial velocity when entering the instrument and is not to be confused with its velocity during the time-of-flight measurement, that is altered particularly by the post-acceleration.
%
%
%
\section{Data products}
\label{sec_dataprod}
Direct Pulse-Height Analysis data (PHA data) are one of SWICS' data products and the ones that are most relevant for the analysis in this work.\\
Over one voltage cycle SWICS steps through the 64 energy-per-charge steps of the electrostatic analyzer (s. sec \ref{sec:EpQ}), which we call ESA steps. At normal spacecraft telemetry rates SWICS steps once per spin, which is once every $12\,\mathrm{s}$. During these times 30 PHA words per spin are selected and transmitted. The selection is based on a priority scheme that is described below in sec. \ref{subsec:prio}.\\
Every 24-bit PHA word contains following information on an incident particle that triggered a valid measurement:
\begin{itemize}
	\item $E_{SSD}$: Energy deposition in the solid state detector \\
	measured through 256 channels in a range $40 - 600\,\mathrm{keV}$
	\item $ToF$: Time-of-Flight\\
	measured through 1024 channels in a range $10 - 200\,\mathrm{ns}$
	\item Sector information:\\
	SWICS divides one spin of Ulysses up into 8 sectors of approximately equal duration. This yields in information on the spatial origin of particles.
	\item Detector information: \\
	Which of the three solid state detector elements has been triggered?
	\item Priority category: \\
	Due to limited telemetry only an assorted sample of all measured particles can be transmitted. This selection is based on different priorities. For details s. sec \ref{subsec:prio}.
\end{itemize}
The interpretation of a set of PHA words that have been collected over time is discussed in sec. \ref{sec:etmatrices}. 
%
\subsection{Detection Efficiency}
\label{subsec:det_eff}
When working with SWICS -- like for any physical measurement -- one has to consider several constraints that impede the ideal measurement as it is described in sec. \ref{sec:swics}. \\
One of these constraints is the detector efficiency, which describes the probability to measure a particle that has entered the instrument (Todo: ?). 
With an ion passing through the time-of-flight section there is the likelihood that secondary electrons may not be emitted properly from the carbon foil and solid state detector which then leads to an invalid time-of-flight measurement. Also, ions could pass through the time-of-flight section on divergent trajectories due to scattering processes (TODO: in the carbon foil??). Subsequently, the ion possibly does not hit the sensitive area of the solid state detector and would neither trigger a stop signal for the time-of-flight measurement nor a valid energy measurement in the solid-state detector.\\
Another reason for an invalid energy measurement in the solid-state detector can be that the ion's energy is smaller than the threshold of the solid-state detector. In this case, only energy-per-charge and time-of-flight information for the ion are available. Such events without a corresponding energy measurement are called double coincidences, while events with triggered start and stop signal and an energy measurement are called triple coincidences.\\
The reason for choosing a non-zero threshold is to limit the influence of the solid-state detector's natural noise. For SWICS this noise level is quite high, at around $12\,\mathrm{keV}$ \citep{gloeckler_1992} (todo: ?), so that the threshold is chosen to be $\sim 30 \, \mathrm{keV}$. 
The detection efficiency is highly dependent on the ion species and deflection step.
Ions with a small mass and charge are most likely to not overcome the threshold at low energy-per-charge values. For the bulk of $\mathrm{He^{+}}$ this is already the case for ESA step 17 ($EpQ = 17.86\,\mathrm{kV}$), which corresponds to a $\mathrm{He^{+}}$ velocity of $v = 900\,\mathrm{km\,s^{-1}}$ (s. eq. \ref{eq:swics_set3}).\\
Unfortunately, $\mathrm{He^{+}}$ detection efficiencies are not known to us for Ulysses SWICS. Instead, we make use of the efficiencies from ACE SWICS, that have been calculated by \citet{koeten}. As ACE SWICS uses different energy-per-charge ranges we had to extrapolate the values for Ulysses SWICS.
For the highest energy-per-charge value $EpQ = 60.51\,\mathrm{keV}$ we interpolated the efficiency from the ACE $\mathrm{He^{+}}$ triple efficiencies and then extrapolated linearly to an efficiency of 0 at ESA step 17. By this, we accommodate for the above mentioned fact that $\mathrm{He^{+}}$ does not have enough energy to deposit energy above the solid state detector's threshold at ESA step 17 and thus, the probability for a triple coincidence is zero. $\mathrm{He^{+}}$ efficiencies from ACE SWICS and the resulting efficiencies used for Ulysses SWICS are shown in fig. \ref{fig:guess_eff}. For sure, these values are not realistic but represent the overall trend of a decreasing efficiency for higher ESA steps.
\begin{figure}[h]
	\includegraphics[width=1.\textwidth]{Figures/guess_eff.pdf}
	\centering
	\caption{$\mathrm{He^{+}}$ detection efficiencies for ACE SWICS over all ESA steps from $0.66\,\mathrm{kV}$ to $86.64\,\mathrm{kV}$. For Ulysses SWICS the efficiencies have been extrapolated between 0 for ESA step 17 ($EpQ = 17.86\,\mathrm{kV}$) and the highest efficiency for ESA step 0 ($EpQ =60.51\,\mathrm{kV}$). The latter value has been interpolated from the ACE efficiencies.}
	\label{fig:guess_eff}
\end{figure}


\subsection{Priority Weighting}
\label{subsec:prio}
SWICS' data processing unit performs an on-board mass and mass-per\--charge-clas\-sification. For every ion with valid measurements the mass $m$ and mass-per-charge $mpq$ are calculated based on the measurements of $E_{\mathrm{SSD}}$, $ToF$ and the particle's ESA step using a look-up-table technique.\\
On the one hand these values are used for sorting the ions into predefined boxes in the $m$-$mpq$-space which yield in the so-called matrix rate, a second data product that is provided benath the PHA words.\\
Secondly, and more important for our analysis, the m and mpq information is used to sort every measured ion into one of three priority ranges. Due to a limited telemetry possibly not every measured particle can be transmitted as a PHA word. 
30 PHA words per spin are chosen from these ranges in way that the ratio of low and high priority PHA words is balanced. By this selection less abundant heavier ions are artificially enhanced which is necessary to recreate the measured composition from the transmitted PHA words. Table \ref{tab} shows a summary of this priority scheme. Details about this can be found in \citet{gloeckler_1992}.\\
To account for the priority biased selection of PHA words it is necessary to weight the transmitted data with the so-called base-rate weight $brw = \frac{D_{\mathrm{PHA}}}{T_{\mathrm{PHA}}}$, where $T_{\mathrm{PHA}}$ is the number transmitted PHA words and $D_{\mathrm{PHA}}$ the number of detected particles on which this PHA word is based. The measured composition can be restored in this way.
\begin{table}[h]
	\caption{SWICS' priority categorization scheme} 
	\centering
	\begin{tabular}{c|c|c}
		%\hline
		Range 0 & $m < 8.7$;  $m_0 : mpq < 3.3$ & $\mathrm{H}$, $\mathrm{He^+}$, $\mathrm{He^{2+}}$; Doubles\\ 
		\hline 
		Range 1 & $m > 8.7$ & Heavier ions \\ 
		\hline 
		Range 2 & $m_0 : mpq > 3.3$ & Doubles \\ 
		%\hline 
	\end{tabular} 
	\label{tab}
\end{table}
%
%
%
\section{ET matrices, identification}
\label{sec:etmatrices}
Fig. \ref{fig:et_matrix} shows longterm PHA data collected over two years with Ulysses SWICS for ESA step 24 ($EpQ = 10.8\,\mathrm{kV}$). For every particle with valid time-of-flight and energy measurements the $E_{\mathrm{SSD}}$ channel is plotted over the time-of-flight channel. As a particle's mass and mass-per-charge are connected to the measured values $EpQ$, $ToF$ and $E_{\mathrm{SSD}}$ by equations \ref{eq:swics_set1} --  \ref{eq:swics_set3}, every ion species occupies a distinct position in this histogram, which we call ET-matrix. 
However, due to uncertainties in the measurements of $EpQ$, $ToF$ and $E_{\mathrm{SSD}}$ an event may be displaced around its ideal position. 
For multiple events of the same species this results in broadened distributions. A detailed discussion on these uncertainties can be found for example in \citet{lars-phd}.
We can identify several ion species in the shown ET-matrix: A selection of those is labelled in \ref{fig:et_matrix}.



\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/et_matrix_labels.png}
	\centering
	\caption{ET-matrix from Ulysses SWICS PHA data of years 1993-1994. All plotted events were measured during ESA step 24 ($EpQ = 10.8\,\mathrm{kV}$). Only triple coincidences are shown. Besides accumulated counts in ion-specific positions, there are a few horizontal and vertical stripes apparent in the shown ET-matrix -- for example in $E_{SSD}$ channel 65 and time-of-flight channel 409, 377 or 505. These are imprints of irregularities within SWICS' Analog-Digital-Converters which can be noticed as a saturation of one bin while the adjacent bin is depleted. However, these signatures are not expected to have a significant effect on the following analysis.}
	\label{fig:et_matrix}
\end{figure}


\subsection{Selection of $\mathrm{He^{+}}$}

\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/epq_all.png}
	\centering
	\caption{Histogram over time-of-flight and ESA channels of two years (1993-1994) of Ulysses SWICS Triple Coincidence PHA data. Note, that the ESA channel numbers are inversely proportional to the energy-per-charge values. Ion species with the same mass-per-charge ratio can be detected on curves $ESA \sim ToF^2$.}
	\label{fig:epq_all}
\end{figure}

\begin{figure}[h]
	\includegraphics[width=0.9\textwidth]{Figures/epq_rng0.png}
	\centering
	\caption{The same histogram as in fig. \ref{fig:epq_all}, but this time only events with Range-0 priority are plotted. This basically removes ions with $m>8.7\,\mathrm{u}$.}
	\label{fig:epq_rng0}
\end{figure}


For extracting only the $\mathrm{He^{+}}$ events from the PHA data we histogram the events' energy-per-charge against their measured time-of-flight in fig. \ref{fig:epq_all}. 
Ions with the same mass-per-charge can be tracked on curves with $\mathrm{ESA} \sim ToF^2$, while species with higher masses-per-charge can be found on curves at higher $ToF$ channels. This way one can identify for example $\mathrm{H^{+}}$ and $\mathrm{He^{2+}}$. \\
At the bottom of fig. \ref{fig:epq_all} suprathermal $\mathrm{He^{+}}$ clearly stands out. For time-of-flight channels above $\sim 375$ heavier solar wind ions with similar mass-per-charge ratios (e.g. $\mathrm{Si^{7+}}$) mix into the $\mathrm{He^{+}}$ population.
We can take advantage of SWICS' on-board priority weighting, that has been described in sec. \ref{subsec:prio}. By selecting Triple Coincidences with Range-0 priority only we separate out events with $m>8.7\,\mathrm{u}$. This leaves us mainly with $\mathrm{H^+}$, $\mathrm{He^{2+}}$ and $\mathrm{He^{+}}$ as the prominent ions in the Range-0 mass range. The result is shown in fig. \ref{fig:epq_rng0}. One can also see traces of heavier ions seeping into the Range-0 regime but this does not affect those ESA steps in which $\mathrm{He^{+}}$ is present.
For a final selection we define a box around the $\mathrm{He^{+}}$ population and extract all events within this box. The result is shown in fig. \ref{fig:cutouts}, above.
%Additionally, we check for that the particle's nominal $w$ for $\mathrm{He^{+}}$, based on the current solar wind speed, is clearly above $ w = 1$. By that, we assure to have excluded heavier ions, todo...
\\
As explained in sec. \ref{subsec:det_eff}, with $\mathrm{He^{+}}$ we are limited to ESA steps 0 to 19 when only considering Triple Coincidences. For higher ESA steps $\mathrm{He^{+}}$ only occurs as a double coincidence. Double coincidences are not sufficient for us, as we need the information about which solid-state detector has been triggered for a directional analysis.
\\
The presented selection procedure has been performed on the complete data set from 1991 to 2009 resulting in a total of $\sim 1.6\cdot10^{5}$ $\mathrm{He^{+}}$ PHA words and an average of $\sim 8.5\cdot10^{3}$ $\mathrm{He^{+}}$ PHA events per year. This corresponds in average to one measured $\mathrm{He^{+}}$ event every five voltage cycles. Note, that there is a wide variation between different periods of time. PHA numbers per year are listed in fig. \ref{fig:vsw_years}.
%
%
%
\subsection{Selection of $\mathrm{He^{2+}}$}
For testing the virtual detector in chapter \ref{chapter:data} we need a species of which we know that it mainly moves with the solar wind bulk and that occurs within the Triple Coincidences, so that we have directional information. We choose for $\mathrm{He^{2+}}$, the most abundant ion in the solar wind \citep[][,ch. 6.1]{prlss_2004} as it also occurs in Range 0 and is easily recognizable in fig. \ref{fig:epq_rng0}.
Unlike $\mathrm{He^{+}}$, $\mathrm{He^{2+}}$ can also be found at ESA steps higher than step 19, as it gains more energy when being post-accelerated due to the twice as high charge. Thus, $\mathrm{He^{2+}}$ deposits more likely energies above the threshold of the solid-state detector. 
We selected $\mathrm{He^{2+}}$ with the same procedure as for $\mathrm{He^{+}}$. However, in this case it is not so crucial to include exactly every $\mathrm{He^{2+}}$ event, as we do not want to perform a full analysis with $\mathrm{He^{2+}}$. The resulting selection is shown in \ref{fig:cutouts}, below.
\\ \\
TODO: woher sind überhaupt die PHA Daten?\\
%
%
%
\begin{figure}
	\centering
\begin{subfigure}{.9\linewidth}
	\centering
	\includegraphics[width=1\linewidth]{Figures/epq_He1.pdf}
	\centering
\end{subfigure}
\begin{subfigure}{.9\linewidth}
	\centering
	\includegraphics[width=1\linewidth]{Figures/epq_He2.pdf}
	\centering
\end{subfigure}
	\caption{$\mathrm{He^{+}}$ (above) and $\mathrm{He^{2+}}$ (below) selections that have been cut out from fig. \ref{fig:epq_rng0}.}
\label{fig:cutouts}
\end{figure}